
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Ψ-sites Identification &#8212; psiFinder v1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Ψ-sites Annotation" href="%CE%A8-sites%20Annotation.html" />
    <link rel="prev" title="Transcripts Alignment" href="Transcripts%20Alignment.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>psiFinder v1.0 documentation</span></a></h1>
        <h2 class="heading"><span>Ψ-sites Identification</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="Transcripts%20Alignment.html">Transcripts Alignment</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="%CE%A8-sites%20Annotation.html">Ψ-sites Annotation</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="sites-identification">
<h1>Ψ-sites Identification<a class="headerlink" href="#sites-identification" title="Permalink to this heading">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#input" id="id1">Input</a></p></li>
<li><p><a class="reference internal" href="#optional" id="id2">Optional</a></p>
<ul>
<li><p><a class="reference internal" href="#customize-rtsseeker-argument" id="id3">customize rtsSeeker argument</a></p></li>
<li><p><a class="reference internal" href="#get-all-psi-information" id="id4">get all psi information</a></p></li>
<li><p><a class="reference internal" href="#plot-roc" id="id5">plot ROC</a></p></li>
<li><p><a class="reference internal" href="#search-psi-sites" id="id6">search psi sites</a></p></li>
<li><p><a class="reference internal" href="#skip-read-with-soft-clip" id="id7">skip read with soft clip</a></p></li>
<li><p><a class="reference internal" href="#normalized-reads-to-the-locus-number" id="id8">normalized reads to the locus number</a></p></li>
<li><p><a class="reference internal" href="#keep-duplication" id="id9">keep duplication</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#detail" id="id10">Detail</a></p></li>
<li><p><a class="reference internal" href="#identify-sites-using-different-approaches" id="id11">Identify Ψ-sites using different approaches</a></p>
<ul>
<li><p><a class="reference internal" href="#svm-support-vector-machine" id="id12">(1) SVM: Support Vector Machine</a></p></li>
<li><p><a class="reference internal" href="#ann-artificial-neural-network" id="id13">(2) ANN: Artificial Neural Network</a></p></li>
<li><p><a class="reference internal" href="#roc-receiver-operating-characteristic" id="id14">(3) ROC: Receiver Operating Characteristic</a></p></li>
<li><p><a class="reference internal" href="#user-defined-customize-key-thresholds" id="id15">(4) User-defined: Customize key thresholds</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#output" id="id16">Output</a></p>
<ul>
<li><p><a class="reference internal" href="#rtsseeker-result" id="id17">rtsSeeker result</a></p></li>
<li><p><a class="reference internal" href="#roc-evaluation" id="id18">ROC evaluation</a></p></li>
<li><p><a class="reference internal" href="#model-building" id="id19">Model Building</a></p></li>
<li><p><a class="reference internal" href="#model-prediction" id="id20">Model Prediction</a></p></li>
</ul>
</li>
</ul>
</div>
<p>psiFinder <code class="docutils literal notranslate"><span class="pre">Ψ-sites</span> <span class="pre">Identification</span></code> was developed with a core C program–<code class="docutils literal notranslate"><span class="pre">rtsSeeker</span></code> (as the core of psiFinder), for seeking the reverse transcriptase stop sites (RTS) and output the overall RTS information.</p>
<img alt="../_images/Identification.png" src="../_images/Identification.png" />
<p>To build rRNA datasets for overall Ψ identification, we first download files from three databases: Modomics, snOPY, and snoRNABase. Since human 5.8s rRNA (chr21:8212571-8212727), 18s rRNA (chr21:8209631-8211499), and 28s rRNA (chr21:8213888-8218941) have multiple copies in the genome, we extracted one of the copies for subsequent analyses. We calculate and gain the relative position of Ψ sites on each rRNA. Centering on these sites and extending 10 nt of upstream and downstream, we then extract 21 nt sequences in bulk and map them to human genome (-v 0 -a -m 1000 –best –strata) using bowtie. A total of 96 Ψ sites were obtained in the above copy and used as a positive subset of the dataset to perform ROC evaluation or SVM modeling. Meanwhile, using bedtools (v2.30.0) intersect tools (-v -s), the sites that were identified as not Ψ sites were extracted from the above copy and used as a negative subset of the dataset.</p>
<img alt="../_images/identification_rtsSeeker_workflow.svg" src="../_images/identification_rtsSeeker_workflow.svg" /><section id="input">
<h2><a class="toc-backref" href="#id1">Input</a><a class="headerlink" href="#input" title="Permalink to this heading">¶</a></h2>
<p>Users should choose to upload files in bam format for both CMC-input and CMC-treated groups. Upload reference genome file in fasta format and set the output path of directory. Input the file name for the output information (i.e. file name with <code class="docutils literal notranslate"><span class="pre">.bed</span></code> suffix).</p>
<p>To set the output path of directory, users can right click in the pop up file chooser (click <code class="docutils literal notranslate"><span class="pre">browse</span></code>) of <code class="docutils literal notranslate"><span class="pre">Out</span> <span class="pre">file</span> <span class="pre">dir&lt;path&gt;</span></code></p>
<img alt="../_images/newfolder.png" src="../_images/newfolder.png" />
</section>
<section id="optional">
<h2><a class="toc-backref" href="#id2">Optional</a><a class="headerlink" href="#optional" title="Permalink to this heading">¶</a></h2>
<p>Multiple option are provided for rtsSeeker argument control.</p>
<section id="customize-rtsseeker-argument">
<h3><a class="toc-backref" href="#id3">customize rtsSeeker argument</a><a class="headerlink" href="#customize-rtsseeker-argument" title="Permalink to this heading">¶</a></h3>
<p>if your want to customize the rtsSeeker argument, do not check <span class="red">get all psi information</span> or check <span class="red">plot ROC</span> option. Once <code class="docutils literal notranslate"><span class="pre">START</span></code>, psiFinder will run <code class="docutils literal notranslate"><span class="pre">3.0_rtsSeeker.sh</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">3.0_rtsSeeker.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
Help<span class="o">()</span> <span class="o">{</span>
<span class="nb">echo</span>
<span class="s2">&quot;rtsSeeker_wrap.sh example:</span>
<span class="s2"> bash rtsSeeker_wrap.sh -c rtsSeeker command -g genome</span>
<span class="s2">&quot;</span>
<span class="o">}</span>


usage<span class="o">()</span> <span class="o">{</span>                                      <span class="c1"># Function: Print a help message.</span>
  <span class="nb">echo</span> <span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> [ -h help] [ -c cmd ] [ -g genome]&quot;</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="o">}</span>
exit_abnormal<span class="o">()</span> <span class="o">{</span>                              <span class="c1"># Function: Exit with error.</span>
  usage
  <span class="nb">exit</span> <span class="m">1</span>
<span class="o">}</span>


<span class="k">while</span> <span class="nb">getopts</span> <span class="s2">&quot;:h:c:g:&quot;</span> options<span class="p">;</span> <span class="k">do</span>

  <span class="k">case</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">options</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">in</span>
    h<span class="p">|</span>:<span class="o">)</span>
      usage
      Help
      <span class="nb">exit</span> <span class="m">0</span>
      <span class="p">;;</span>
    c<span class="o">)</span>
      <span class="nv">cmd</span><span class="o">=</span><span class="si">${</span><span class="nv">OPTARG</span><span class="si">}</span>
      <span class="k">if</span> ! <span class="o">[[</span> -n <span class="nv">$cmd</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;You didn&#39;t input the cmd&quot;</span>
      <span class="k">fi</span>
      <span class="p">;;</span>
    g<span class="o">)</span>
      <span class="nv">genome</span><span class="o">=</span><span class="si">${</span><span class="nv">OPTARG</span><span class="si">}</span>
      <span class="k">if</span> ! <span class="o">[[</span> -n <span class="nv">$genome</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;You didn&#39;t input the genome&quot;</span>
      <span class="k">fi</span>
      <span class="p">;;</span>
    <span class="se">\?</span><span class="o">)</span> <span class="c1"># incorrect option</span>
      <span class="nb">echo</span> <span class="s2">&quot;Error: -</span><span class="si">${</span><span class="nv">OPTARG</span><span class="si">}</span><span class="s2"> Invalid option&quot;</span>
      exit_abnormal
      <span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>

<span class="nb">shift</span> <span class="k">$((</span><span class="nv">$OPTIND</span> <span class="o">-</span> <span class="m">1</span><span class="k">))</span>
date  <span class="c1">## echo the date at start</span>
<span class="nb">echo</span> <span class="s2">&quot;Starting: one rtsSeeker job is starting...&quot;</span>

<span class="nb">echo</span> <span class="s2">&quot;Normal rtsSeeker mode: rtsSeeker start...&quot;</span> &gt; rtsSeeker_wrap.log

<span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&quot;</span><span class="si">${</span><span class="nv">genome</span><span class="si">}</span><span class="s2">.fai&quot;</span>  <span class="o">]</span>
<span class="k">then</span>
<span class="nb">echo</span> <span class="s2">&quot;generate fai file&quot;</span> &gt;&gt; rtsSeeker_wrap.log
samtools faidx <span class="nv">$genome</span>
<span class="k">else</span>
<span class="nb">echo</span> <span class="s2">&quot;fai file exist&quot;</span> &gt;&gt; rtsSeeker_wrap.log
<span class="k">fi</span>

<span class="nb">eval</span> <span class="nv">$cmd</span> &gt;&gt; rtsSeeker_wrap.log <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
<span class="nb">wait</span>
<span class="nb">echo</span> <span class="s1">&#39;Genome-wise pseudouridylated sites identification is done by rtsSeeker!&#39;</span> &gt;&gt; rtsSeeker_wrap.log

<span class="nb">echo</span> <span class="s2">&quot;rtsSeeker_wrap.sh running is done!&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;\n </span><span class="k">$(</span>tput setaf <span class="m">3</span><span class="k">)</span><span class="s2">Succeed: one rtsSeeker job is finished!</span><span class="k">$(</span>tput sgr <span class="m">0</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">exit</span> <span class="m">0</span>  <span class="c1"># Exit normally.</span>
</pre></div>
</div>
</section>
<section id="get-all-psi-information">
<h3><a class="toc-backref" href="#id4">get all psi information</a><a class="headerlink" href="#get-all-psi-information" title="Permalink to this heading">¶</a></h3>
<p>If this option is checked, <code class="docutils literal notranslate"><span class="pre">Detail</span></code> argument input will be blocked and psiFinder will run <code class="docutils literal notranslate"><span class="pre">get_all.sh</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">get_all.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$#</span> -ne <span class="m">4</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s1">&#39;Usage: ./&#39;</span><span class="nv">$0</span> <span class="s1">&#39; genome.fa treatment.bam input.bam out.bed&#39;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nv">genome</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">treatment</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">input</span><span class="o">=</span><span class="nv">$3</span>
<span class="nv">out</span><span class="o">=</span><span class="nv">$4</span>
<span class="nv">outFileName</span><span class="o">=</span><span class="si">${</span><span class="nv">out</span><span class="p">%.bed</span><span class="si">}</span>

<span class="nb">echo</span> <span class="s2">&quot;rtsSeeker get All mode: rtsSeeker start...&quot;</span>
<span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&quot;</span><span class="si">${</span><span class="nv">genome</span><span class="si">}</span><span class="s2">.fai&quot;</span>  <span class="o">]</span>
<span class="k">then</span>
<span class="nb">echo</span> <span class="s2">&quot;generate faifile&quot;</span>
samtools faidx <span class="nv">$genome</span>
<span class="k">else</span>
<span class="nb">echo</span> <span class="s2">&quot;faifile exist&quot;</span>
<span class="k">fi</span>

<span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/rtsSeeker --fa <span class="nv">$genome</span> --fai <span class="si">${</span><span class="nv">genome</span><span class="si">}</span>.fai --treat <span class="nv">$treatment</span> --input <span class="nv">$input</span> -p <span class="m">1</span>.5 -t <span class="m">0</span> -r <span class="m">0</span> -M <span class="m">1</span> --gene <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38.gencode.v30.tRNA.refseqNcRNA.geneAnno.bed12 -f <span class="m">0</span> -m <span class="m">0</span> -s -w <span class="m">20</span> -o <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_all.bed <span class="m">2</span>&gt;<span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_all_rtsSeeker.log
awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {if($1~/^chr[0-9|a-z|A-Z]*$/ &amp;&amp; $10==&quot;T&quot; &amp;&amp; $14&gt;5){print $0}}&#39;</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_all.bed &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_filt.bed
awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {$25=sprintf(&quot;%.2f&quot;,$25);$27=sprintf(&quot;%.2f&quot;,$27);$28=sprintf(&quot;%.2f&quot;,$28);$30=sprintf(&quot;%.2f&quot;,$30);$31=sprintf(&quot;%.2f&quot;,$31);$33=sprintf(&quot;%.2f&quot;,$33)}1&#39;</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_filt.bed &gt; tmp <span class="o">&amp;&amp;</span> mv tmp <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_filt.bed
<span class="nb">echo</span> -e <span class="s2">&quot;All rtsSeeker result in </span><span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span><span class="s2">_all.bed&quot;</span>
</pre></div>
</div>
</section>
<section id="plot-roc">
<h3><a class="toc-backref" href="#id5">plot ROC</a><a class="headerlink" href="#plot-roc" title="Permalink to this heading">¶</a></h3>
<p>If this option is checked, <code class="docutils literal notranslate"><span class="pre">Detail</span></code> argument input will be blocked and psiFinder will run <code class="docutils literal notranslate"><span class="pre">3.1_rtsSeeker_roc.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">roc.r</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">3.1_rtsSeeker_roc.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$#</span> -ne <span class="m">4</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s1">&#39;Usage: &#39;</span><span class="nv">$0</span> <span class="s1">&#39; genome.fa treatment.bam input.bam out.bed&#39;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nv">genome</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">treatment</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">input</span><span class="o">=</span><span class="nv">$3</span>
<span class="nv">out</span><span class="o">=</span><span class="nv">$4</span>
<span class="nv">outFileName</span><span class="o">=</span><span class="si">${</span><span class="nv">out</span><span class="p">%.bed</span><span class="si">}</span>

<span class="nb">echo</span> <span class="s2">&quot;rtsSeeker ROC mode: rtsSeeker start...&quot;</span>
<span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&quot;</span><span class="si">${</span><span class="nv">genome</span><span class="si">}</span><span class="s2">.fai&quot;</span>  <span class="o">]</span>
<span class="k">then</span>
<span class="nb">echo</span> <span class="s2">&quot;generate faifile&quot;</span>
samtools faidx <span class="nv">$genome</span>
<span class="k">else</span>
<span class="nb">echo</span> <span class="s2">&quot;faifile exist&quot;</span>
<span class="k">fi</span>

<span class="c1"># ROC</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">/rtsSeeker --fa </span><span class="nv">$genome</span><span class="s2"> --fai </span><span class="si">${</span><span class="nv">genome</span><span class="si">}</span><span class="s2">.fai --treat </span><span class="nv">$treatment</span><span class="s2"> --input </span><span class="nv">$input</span><span class="s2"> -p 1.5 -t 5 -r 0.05 -M 1 --gene </span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">/hg38.gencode.v30.tRNA.refseqNcRNA.geneAnno.bed12 -f 1 -m 0 -s -n -w 20 -o </span><span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span><span class="s2">_roc_all.bed 2&gt;</span><span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span><span class="s2">_roc_all_rtsSeeker.log&quot;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_rtsSeeker_cmd.log
<span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/rtsSeeker --fa <span class="nv">$genome</span> --fai <span class="si">${</span><span class="nv">genome</span><span class="si">}</span>.fai --treat <span class="nv">$treatment</span> --input <span class="nv">$input</span> -p <span class="m">1</span>.5 -t <span class="m">5</span> -r <span class="m">0</span>.05 -M <span class="m">1</span> --gene <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38.gencode.v30.tRNA.refseqNcRNA.geneAnno.bed12 -f <span class="m">1</span> -m <span class="m">0</span> -s -n -w <span class="m">20</span> -o <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_all.bed <span class="m">2</span>&gt;<span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_all_rtsSeeker.log <span class="c1"># no -c remove duplicate change model to 1 and add gene annotation add -p 1.5</span>
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_all.bed &gt; <span class="nv">$out</span>

awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {if($1~/^chr[0-9|a-z|A-Z]*$/ &amp;&amp; $10==&quot;T&quot; &amp;&amp; $14&gt;10){print $0}}&#39;</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_all.bed &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_filt.bed
bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_filt.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.bed
bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_filt.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/rrna_chr21.bed -s &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_rrna.bed
bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_rrna.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s -v &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.bed
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.bed <span class="p">|</span>awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {print $0,&quot;1&quot;}&#39;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.txt
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.bed <span class="p">|</span>awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {print $0,&quot;0&quot;}&#39;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.txt
<span class="nb">echo</span> <span class="s2">&quot;getting roc_plot.txt&quot;</span>
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.txt <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.txt &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_plot.txt

<span class="nb">echo</span> <span class="s2">&quot;generate ROC plot...&quot;</span>
nohup Rscript <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/roc.r -f <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_plot.txt -t <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_filt.bed -r <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38.psiU.SingleSites.bed -o <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_bestthres.log <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
<span class="nb">wait</span>
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_bestthres.log

mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_six_variables_rRNA_violinplot.pdf <span class="p">&amp;</span>&gt; /dev/null
mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_summary.pdf <span class="p">&amp;</span>&gt; /dev/null
mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_best_evaluation.pdf <span class="p">&amp;</span>&gt; /dev/null

<span class="nb">echo</span> <span class="s2">&quot;rtsSeeker ROC end&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;rtsSeeker ROC result in </span><span class="k">$(</span>dirname <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_psi_prediction.bed<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">roc.r</span></code></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;optparse&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;pROC&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggplot2&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggpubr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;cowplot&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;gridExtra&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;reshape2&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;stringr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;RColorBrewer&quot;</span><span class="p">))</span>

<span class="n">option_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-f&quot;</span><span class="p">,</span> <span class="s">&quot;--rocfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;ROC of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-r&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-s&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile2&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;hg38.psiU.SingleSites.bed [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-t&quot;</span><span class="p">,</span> <span class="s">&quot;--filtfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;filt file [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="s">&quot;--outfile_prefix&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;output file name [default= %default]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">)</span>
<span class="p">);</span>
<span class="n">opt_parser</span> <span class="o">=</span> <span class="nf">OptionParser</span><span class="p">(</span><span class="n">option_list</span><span class="o">=</span><span class="n">option_list</span><span class="p">);</span>
<span class="n">opt</span> <span class="o">=</span> <span class="nf">parse_args</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>

<span class="nf">if </span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rocfile</span><span class="p">)</span><span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile2</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span><span class="p">)</span> <span class="p">){</span>
  <span class="nf">print_help</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>
  <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;Please provide -f rocfile, -r rRNAfile, -s rRNAfile2, -t filtfile  and -o outfile_prefix option&quot;</span><span class="p">,</span> <span class="n">call.</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ROCfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rocfile</span>
<span class="n">rRNAfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span>
<span class="n">rRNAfile2</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile2</span>
<span class="n">filtfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span>
<span class="n">outFile_prefix</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span>

<span class="nf">print</span><span class="p">(</span><span class="n">ROCfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile2</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">filtfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">)</span>

<span class="c1"># roc_plot.txt</span>
<span class="n">ROC_data</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">ROCfile</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="c1">#1</span>
    <span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="c1">#2</span>
    <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="c1">#3</span>
    <span class="s">&quot;name&quot;</span><span class="p">,</span><span class="c1">#4</span>
    <span class="s">&quot;foldChange&quot;</span><span class="p">,</span><span class="c1">#5</span>
    <span class="s">&quot;strand&quot;</span><span class="p">,</span><span class="c1">#6</span>
    <span class="s">&quot;geneName&quot;</span><span class="p">,</span><span class="c1">#7</span>
    <span class="s">&quot;geneStart&quot;</span><span class="p">,</span><span class="c1">#8</span>
    <span class="s">&quot;geneEnd&quot;</span><span class="p">,</span><span class="c1">#9</span>
    <span class="s">&quot;base&quot;</span><span class="p">,</span><span class="c1">#10</span>
    <span class="s">&quot;treatPval&quot;</span><span class="p">,</span><span class="c1">#11</span>
    <span class="s">&quot;ctrlPval&quot;</span><span class="p">,</span><span class="c1">#12</span>
    <span class="s">&quot;minusPval&quot;</span><span class="p">,</span><span class="c1">#13</span>
    <span class="s">&quot;treatStopNum&quot;</span><span class="p">,</span><span class="c1">#14</span>
    <span class="s">&quot;treatStopRPM&quot;</span><span class="p">,</span><span class="c1">#15</span>
    <span class="s">&quot;treatPreStopNum&quot;</span><span class="p">,</span><span class="c1">#16</span>
    <span class="s">&quot;treatAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#17</span>
    <span class="s">&quot;treatReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#18</span>
    <span class="s">&quot;ctrlStopNum&quot;</span><span class="p">,</span><span class="c1">#19</span>
    <span class="s">&quot;ctrlStopRPM&quot;</span><span class="p">,</span><span class="c1">#20</span>
    <span class="s">&quot;ctrlPreStopNum&quot;</span><span class="p">,</span><span class="c1">#21</span>
    <span class="s">&quot;ctrlAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#22</span>
    <span class="s">&quot;ctrlReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#23</span>
    <span class="s">&quot;stopRpmFC&quot;</span><span class="p">,</span><span class="c1">#24</span>
    <span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#25</span>
    <span class="s">&quot;ctrlPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#26</span>
    <span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#27</span>
    <span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#28</span>
    <span class="s">&quot;ctrlAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#29</span>
    <span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#30</span>
    <span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="c1">#31</span>
    <span class="s">&quot;ctrlStopRatio&quot;</span><span class="p">,</span><span class="c1">#32</span>
    <span class="s">&quot;stopRatioFC&quot;</span><span class="p">,</span><span class="c1">#33</span>
    <span class="s">&quot;treatStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#34</span>
    <span class="s">&quot;treatStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#35</span>
    <span class="s">&quot;ctrlStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#36</span>
    <span class="s">&quot;ctrlStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#37</span>
    <span class="s">&quot;treatStopMeanFoldRatio&quot;</span><span class="p">,</span><span class="c1">#38</span>
    <span class="s">&quot;extendSeq&quot;</span><span class="p">,</span><span class="c1">#39</span>
    <span class="s">&quot;class&quot;</span><span class="p">)</span><span class="c1">#40</span>
<span class="n">ROC_data</span><span class="o">$</span><span class="n">base</span><span class="o">&lt;-</span><span class="s">&quot;T&quot;</span>
<span class="n">ROC_data_sel</span><span class="o">&lt;-</span><span class="n">ROC_data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span><span class="n">treatAfterRpmFold</span><span class="p">,</span><span class="n">treatStopMeanFold</span><span class="p">,</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="n">afterRpmFoldRatio</span><span class="p">,</span> <span class="n">stopRatioFC</span><span class="p">,</span><span class="n">treatStopMeanFoldRatio</span><span class="p">,</span><span class="n">class</span><span class="p">)</span>


<span class="c1">#rRNA-psi-non-psi visualization</span>
<span class="n">ROC_data_melt</span><span class="o">&lt;-</span><span class="nf">melt</span><span class="p">(</span><span class="n">ROC_data</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="o">:</span><span class="m">38</span><span class="p">,</span><span class="m">40</span><span class="p">)],</span><span class="n">id.vars</span> <span class="o">=</span> <span class="s">&quot;class&quot;</span><span class="p">)</span>
<span class="n">ROC_data_melt</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">ROC_data_melt</span><span class="o">$</span><span class="n">class</span><span class="p">),</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">ROC_data_melt</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">ROC_data_melt</span><span class="o">$</span><span class="n">class</span><span class="p">),</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">)</span>

<span class="n">data_summary</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">m</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">ymin</span> <span class="o">&lt;-</span> <span class="n">m</span><span class="o">-</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">ymax</span> <span class="o">&lt;-</span> <span class="n">m</span><span class="o">+</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="nf">return</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">m</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">my_comparisons</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;non-psi&quot;</span><span class="p">,</span> <span class="s">&quot;psi&quot;</span><span class="p">)</span> <span class="p">)</span>

<span class="c1">#treatPreRpmFold</span>
<span class="n">treatPreRpmFold</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatPreRpmFold$&quot;</span><span class="p">))</span>
<span class="n">treatPreRpmFold_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatPreRpmFold)&quot;</span><span class="p">)</span>
<span class="n">treatPreRpmFold_bp</span><span class="o">&lt;-</span><span class="n">treatPreRpmFold_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#treatAfterRpmFold</span>
<span class="n">treatAfterRpmFold</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatAfterRpmFold$&quot;</span><span class="p">))</span>
<span class="n">treatAfterRpmFold_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatAfterRpmFold)&quot;</span><span class="p">)</span>
<span class="n">treatAfterRpmFold_bp</span><span class="o">&lt;-</span><span class="n">treatAfterRpmFold_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#preRpmFoldRatio</span>
<span class="n">preRpmFoldRatio</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^preRpmFoldRatio$&quot;</span><span class="p">))</span>
<span class="n">preRpmFoldRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(preRpmFoldRatio)&quot;</span><span class="p">)</span>
<span class="n">preRpmFoldRatio_bp</span><span class="o">&lt;-</span><span class="n">preRpmFoldRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#afterRpmFoldRatio</span>
<span class="n">afterRpmFoldRatio</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^afterRpmFoldRatio$&quot;</span><span class="p">))</span>
<span class="n">afterRpmFoldRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(afterRpmFoldRatio)&quot;</span><span class="p">)</span>
<span class="n">afterRpmFoldRatio_bp</span><span class="o">&lt;-</span><span class="n">afterRpmFoldRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#treatStopRatio</span>
<span class="n">treatStopRatio</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatStopRatio$&quot;</span><span class="p">))</span>
<span class="n">treatStopRatio</span><span class="o">&lt;-</span><span class="n">treatStopRatio</span><span class="p">[</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="o">!=</span><span class="m">0</span><span class="p">,]</span>
<span class="n">treatStopRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatStopRatio)&quot;</span><span class="p">)</span>
<span class="n">treatStopRatio_bp</span><span class="o">&lt;-</span><span class="n">treatStopRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="n">stopRatioFC</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^stopRatioFC$&quot;</span><span class="p">))</span>
<span class="n">stopRatioFC_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(stopRatioFC)&quot;</span><span class="p">)</span>
<span class="n">stopRatioFC_bp</span><span class="o">&lt;-</span><span class="n">stopRatioFC_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>


<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_six_variables_rRNA_violinplot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">6</span><span class="p">)</span>
<span class="nf">plot_grid</span><span class="p">(</span>
  <span class="n">treatPreRpmFold_bp</span><span class="p">,</span>
  <span class="n">preRpmFoldRatio_bp</span><span class="p">,</span>
  <span class="n">treatAfterRpmFold_bp</span><span class="p">,</span>
  <span class="n">afterRpmFoldRatio_bp</span><span class="p">,</span>
  <span class="n">treatStopRatio_bp</span><span class="p">,</span>
  <span class="n">stopRatioFC_bp</span><span class="p">,</span>
  <span class="n">align</span> <span class="o">=</span> <span class="s">&quot;hv&quot;</span><span class="p">,</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">,</span><span class="s">&#39;E&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>


<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================treatPreRpmFold/controlPreRpmFold=========================\n&quot;</span><span class="p">)</span>
<span class="c1">#treatPreRpmFold controlPreRpmFold</span>
<span class="n">pre_input</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">ctrlPreRpmFold</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_treatPreRpmFold.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">pre_CMC</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">treatPreRpmFold</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="n">pre_input_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;controlPreRpmFold AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">pre_input</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">pre_CMC_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;treatPreRpmFold AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">pre_CMC</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">preList</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">CMC</span><span class="o">=</span><span class="n">pre_CMC</span><span class="p">,</span> <span class="n">Input</span><span class="o">=</span><span class="n">pre_input</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">preList</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">pre_CMC_label</span><span class="p">,</span><span class="n">pre_input_label</span><span class="p">)</span>
<span class="n">pre_plot</span><span class="o">&lt;-</span><span class="nf">ggroc</span><span class="p">(</span><span class="n">preList</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="n">pre_plot</span><span class="o">&lt;-</span><span class="n">pre_plot</span><span class="o">+</span><span class="nf">geom_abline</span><span class="p">(</span><span class="n">intercept</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">slope</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">legend.title</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">(),</span><span class="n">panel.background</span><span class="o">=</span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">))</span>
<span class="n">pre_plot</span><span class="o">&lt;-</span><span class="n">pre_plot</span><span class="o">+</span> <span class="nf">guides</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">nrow</span> <span class="o">=</span> <span class="m">2</span><span class="p">))</span>
<span class="n">pre_plot</span><span class="o">&lt;-</span><span class="n">pre_plot</span><span class="o">+</span> <span class="nf">annotate</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">.</span><span class="m">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">.</span><span class="m">5</span><span class="p">,</span>
                          <span class="n">label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;Method: &quot;</span><span class="p">,</span><span class="nf">roc.test</span><span class="p">(</span><span class="n">pre_input</span><span class="p">,</span> <span class="n">pre_CMC</span><span class="p">)</span><span class="o">$</span><span class="n">method</span><span class="p">,</span><span class="s">&quot;\np.value: &quot;</span><span class="p">,</span><span class="nf">signif</span><span class="p">(</span><span class="nf">roc.test</span><span class="p">(</span><span class="n">pre_input</span><span class="p">,</span> <span class="n">pre_CMC</span><span class="p">)</span><span class="o">$</span><span class="n">p.value</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
                          <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_pre_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_pre_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span> <span class="o">=</span><span class="m">4</span> <span class="p">,</span><span class="n">height</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="n">pre_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_pre_plot.png&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">png</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_pre_plot.png&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">pre_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="nf">roc.test</span><span class="p">(</span><span class="n">pre_input</span><span class="p">,</span> <span class="n">pre_CMC</span><span class="p">)</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================treatAfterRpmFold/controlAfterRpmFold=========================\n&quot;</span><span class="p">)</span>
<span class="c1">#treatAfterRpmFold controlAfterRpmFold</span>
<span class="n">aft_input</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">ctrlAfterRpmFold</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_treatAfterRpmFold.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">aft_CMC</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">treatAfterRpmFold</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="n">aft_input_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;controlAfterRpmFold AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">aft_input</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">aft_CMC_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;treatAfterRpmFold AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">aft_CMC</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">aftList</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">CMC</span><span class="o">=</span><span class="n">aft_CMC</span><span class="p">,</span> <span class="n">Input</span><span class="o">=</span><span class="n">aft_input</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">aftList</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">aft_CMC_label</span><span class="p">,</span><span class="n">aft_input_label</span><span class="p">)</span>
<span class="n">aft_plot</span><span class="o">&lt;-</span><span class="nf">ggroc</span><span class="p">(</span><span class="n">aftList</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="n">aft_plot</span><span class="o">&lt;-</span><span class="n">aft_plot</span><span class="o">+</span><span class="nf">geom_abline</span><span class="p">(</span><span class="n">intercept</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">slope</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">legend.title</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">(),</span><span class="n">panel.background</span><span class="o">=</span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">))</span>
<span class="n">aft_plot</span><span class="o">&lt;-</span><span class="n">aft_plot</span><span class="o">+</span> <span class="nf">guides</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">nrow</span> <span class="o">=</span> <span class="m">2</span><span class="p">))</span>
<span class="n">aft_plot</span><span class="o">&lt;-</span><span class="n">aft_plot</span><span class="o">+</span> <span class="nf">annotate</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">.</span><span class="m">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">.</span><span class="m">5</span><span class="p">,</span>
                          <span class="n">label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;Method: &quot;</span><span class="p">,</span><span class="nf">roc.test</span><span class="p">(</span><span class="n">aft_input</span><span class="p">,</span> <span class="n">aft_CMC</span><span class="p">)</span><span class="o">$</span><span class="n">method</span><span class="p">,</span><span class="s">&quot;\np.value: &quot;</span><span class="p">,</span><span class="nf">signif</span><span class="p">(</span><span class="nf">roc.test</span><span class="p">(</span><span class="n">aft_input</span><span class="p">,</span> <span class="n">aft_CMC</span><span class="p">)</span><span class="o">$</span><span class="n">p.value</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
                          <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_aft_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_aft_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span> <span class="o">=</span><span class="m">4</span> <span class="p">,</span><span class="n">height</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="n">aft_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_aft_plot.png&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">png</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_aft_plot.png&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">aft_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="nf">roc.test</span><span class="p">(</span><span class="n">aft_input</span><span class="p">,</span> <span class="n">aft_CMC</span><span class="p">)</span>


<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================treatStopMeanFold/controlStopMeanFold=========================\n&quot;</span><span class="p">)</span>
<span class="c1">#treatStopMeanFold controlStopMeanFold</span>
<span class="n">controlStopMeanFold_input</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">ctrlStopMeanFold</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_treatStopMeanFold.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">treatStopMeanFold_CMC</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">treatStopMeanFold</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="n">controlStopMeanFold_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;controlStopMeanFold AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">controlStopMeanFold_input</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">treatStopMeanFold_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;treatStopMeanFold AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">treatStopMeanFold_CMC</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">StopMeanFoldList</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">CMC</span><span class="o">=</span><span class="n">treatStopMeanFold_CMC</span><span class="p">,</span> <span class="n">Input</span><span class="o">=</span><span class="n">controlStopMeanFold_input</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">StopMeanFoldList</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">treatStopMeanFold_label</span><span class="p">,</span><span class="n">controlStopMeanFold_label</span><span class="p">)</span>
<span class="n">StopMeanFold_plot</span><span class="o">&lt;-</span><span class="nf">ggroc</span><span class="p">(</span><span class="n">StopMeanFoldList</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="n">StopMeanFold_plot</span><span class="o">&lt;-</span><span class="n">StopMeanFold_plot</span><span class="o">+</span><span class="nf">geom_abline</span><span class="p">(</span><span class="n">intercept</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">slope</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">legend.title</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">(),</span><span class="n">panel.background</span><span class="o">=</span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">))</span>
<span class="n">StopMeanFold_plot</span><span class="o">&lt;-</span><span class="n">StopMeanFold_plot</span><span class="o">+</span> <span class="nf">guides</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">nrow</span> <span class="o">=</span> <span class="m">2</span><span class="p">))</span>
<span class="n">StopMeanFold_plot</span><span class="o">&lt;-</span><span class="n">StopMeanFold_plot</span><span class="o">+</span> <span class="nf">annotate</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">.</span><span class="m">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">.</span><span class="m">5</span><span class="p">,</span>
                          <span class="n">label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;Method: &quot;</span><span class="p">,</span><span class="nf">roc.test</span><span class="p">(</span><span class="n">controlStopMeanFold_input</span><span class="p">,</span> <span class="n">treatStopMeanFold_CMC</span><span class="p">)</span><span class="o">$</span><span class="n">method</span><span class="p">,</span><span class="s">&quot;\np.value: &quot;</span><span class="p">,</span><span class="nf">signif</span><span class="p">(</span><span class="nf">roc.test</span><span class="p">(</span><span class="n">controlStopMeanFold_input</span><span class="p">,</span> <span class="n">treatStopMeanFold_CMC</span><span class="p">)</span><span class="o">$</span><span class="n">p.value</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
                          <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_StopMeanFold_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_StopMeanFold_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span> <span class="o">=</span><span class="m">4</span> <span class="p">,</span><span class="n">height</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="n">StopMeanFold_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_StopMeanFold_plot.png&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">png</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_StopMeanFold_plot.png&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">StopMeanFold_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="nf">roc.test</span><span class="p">(</span><span class="n">controlStopMeanFold_input</span><span class="p">,</span> <span class="n">treatStopMeanFold_CMC</span><span class="p">)</span>


<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================treatStopRatio/controlStopRatio=========================\n&quot;</span><span class="p">)</span>
<span class="c1">#treatStopRatio controlStopRatio</span>
<span class="n">stopratio_input</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">ctrlStopRatio</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_treatStopRatio.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">stopratio_CMC</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="n">stopratio_input_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;controlStopRatio AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">stopratio_input</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">stopratio_CMC_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;treatStopRatio AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">stopratio_CMC</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">stopratioList</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">CMC</span><span class="o">=</span><span class="n">stopratio_CMC</span><span class="p">,</span> <span class="n">Input</span><span class="o">=</span><span class="n">stopratio_input</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">stopratioList</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">stopratio_CMC_label</span><span class="p">,</span><span class="n">stopratio_input_label</span><span class="p">)</span>
<span class="n">stopratio_plot</span><span class="o">&lt;-</span><span class="nf">ggroc</span><span class="p">(</span><span class="n">stopratioList</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="n">stopratio_plot</span><span class="o">&lt;-</span><span class="n">stopratio_plot</span><span class="o">+</span><span class="nf">geom_abline</span><span class="p">(</span><span class="n">intercept</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">slope</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">legend.title</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">(),</span><span class="n">panel.background</span><span class="o">=</span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">))</span>
<span class="n">stopratio_plot</span><span class="o">&lt;-</span><span class="n">stopratio_plot</span><span class="o">+</span> <span class="nf">guides</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">nrow</span> <span class="o">=</span> <span class="m">2</span><span class="p">))</span>
<span class="n">stopratio_plot</span><span class="o">&lt;-</span><span class="n">stopratio_plot</span><span class="o">+</span> <span class="nf">annotate</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">.</span><span class="m">5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">.</span><span class="m">5</span><span class="p">,</span>
                          <span class="n">label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;Method: &quot;</span><span class="p">,</span><span class="nf">roc.test</span><span class="p">(</span><span class="n">stopratio_input</span><span class="p">,</span> <span class="n">stopratio_CMC</span><span class="p">)</span><span class="o">$</span><span class="n">method</span><span class="p">,</span><span class="s">&quot;\np.value: &quot;</span><span class="p">,</span><span class="nf">signif</span><span class="p">(</span><span class="nf">roc.test</span><span class="p">(</span><span class="n">stopratio_input</span><span class="p">,</span> <span class="n">stopratio_CMC</span><span class="p">)</span><span class="o">$</span><span class="n">p.value</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
                          <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_stopratio_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_stopratio_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span> <span class="o">=</span><span class="m">4</span> <span class="p">,</span><span class="n">height</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="n">stopratio_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_stopratio_plot.png&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">png</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_stopratio_plot.png&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">stopratio_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="nf">roc.test</span><span class="p">(</span><span class="n">stopratio_input</span><span class="p">,</span> <span class="n">stopratio_CMC</span><span class="p">)</span>


<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================Ratio: preRpmFoldRatio, afterRpmFoldRatio, stopRatioFC,treatStopMeanFoldRatio=========================\n&quot;</span><span class="p">)</span>

<span class="n">mycol</span> <span class="o">=</span> <span class="nf">brewer.pal</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="s">&quot;Set2&quot;</span><span class="p">)[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)]</span>

<span class="c1">#ratio: preRpmFoldRatio, afterRpmFoldRatio, stopRatioFC,treatStopMeanFoldRatio</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_preRpmFoldRatio.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">preRpmFoldRatio</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">preRpmFoldRatio</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_afterRpmFoldRatio.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">afterRpmFoldRatio</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_stopRatioFC.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">stopRatioFC</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">stopRatioFC</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_treatStopMeanFoldRatio.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">treatStopMeanFoldRatio</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">treatStopMeanFoldRatio</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="n">preRpmFoldRatio_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;preRpmFoldRatio AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">preRpmFoldRatio</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">afterRpmFoldRatio_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;afterRpmFoldRatio AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">afterRpmFoldRatio</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">stopRatioFC_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;stopRatioFC AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">stopRatioFC</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">treatStopMeanFoldRatio_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;treatStopMeanFoldRatio AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">treatStopMeanFoldRatio</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">ratioList</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">preRpmFoldRatio</span> <span class="o">=</span> <span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="n">afterRpmFoldRatio</span> <span class="o">=</span> <span class="n">afterRpmFoldRatio</span><span class="p">,</span>  <span class="n">stopRatioFC</span> <span class="o">=</span> <span class="n">stopRatioFC</span><span class="p">,</span> <span class="n">treatStopMeanFoldRatio</span> <span class="o">=</span> <span class="n">treatStopMeanFoldRatio</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">ratioList</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">preRpmFoldRatio_label</span><span class="p">,</span> <span class="n">afterRpmFoldRatio_label</span><span class="p">,</span> <span class="n">stopRatioFC_label</span><span class="p">,</span> <span class="n">treatStopMeanFoldRatio_label</span><span class="p">)</span>
<span class="n">ratio_plot</span><span class="o">&lt;-</span><span class="nf">ggroc</span><span class="p">(</span><span class="n">ratioList</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="n">ratio_plot</span><span class="o">&lt;-</span><span class="n">ratio_plot</span><span class="o">+</span><span class="nf">geom_abline</span><span class="p">(</span><span class="n">intercept</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">slope</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">legend.title</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">(),</span><span class="n">panel.background</span><span class="o">=</span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">))</span>
<span class="n">ratio_plot</span><span class="o">&lt;-</span><span class="n">ratio_plot</span><span class="o">+</span> <span class="nf">guides</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">nrow</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="m">2</span><span class="p">))</span><span class="o">+</span><span class="nf">scale_color_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="n">mycol</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_ratio_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_ratio_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span> <span class="o">=</span><span class="m">9</span> <span class="p">,</span><span class="n">height</span> <span class="o">=</span> <span class="m">9</span><span class="p">)</span>
<span class="n">ratio_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_ratio_plot.png&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">png</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_ratio_plot.png&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">ratio_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>


<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================six variables: treatPreRpmFold, preRpmFoldRatio, treatAfterRpmFold, afterRpmFoldRatio, stopRatioFC,treatStopRatio=========================\n&quot;</span><span class="p">)</span>

<span class="n">mycol</span> <span class="o">=</span> <span class="nf">brewer.pal</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="s">&quot;Dark2&quot;</span><span class="p">)[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">)]</span>

<span class="c1">#ratio: preRpmFoldRatio, afterRpmFoldRatio, stopRatioFC,treatStopRatio</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_preRpmFoldRatio.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">preRpmFoldRatio</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">preRpmFoldRatio</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_afterRpmFoldRatio.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">afterRpmFoldRatio</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_stopRatioFC.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">stopRatioFC</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">stopRatioFC</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_treatStopRatio.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">treatStopRatio</span><span class="o">=</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="n">preRpmFoldRatio_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;preRpmFoldRatio AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">preRpmFoldRatio</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">afterRpmFoldRatio_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;afterRpmFoldRatio AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">afterRpmFoldRatio</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">stopRatioFC_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;stopRatioFC AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">stopRatioFC</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">treatStopRatio_label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&quot;treatStopRatio AUC:&quot;</span><span class="p">,</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%.3f&quot;</span><span class="p">,</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">auc</span><span class="p">))</span>
<span class="n">ratioList</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">treatPreRpmFold</span> <span class="o">=</span> <span class="n">pre_CMC</span><span class="p">,</span> <span class="n">preRpmFoldRatio</span> <span class="o">=</span> <span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="n">treatAfterRpmFold</span><span class="o">=</span> <span class="n">aft_CMC</span><span class="p">,</span> <span class="n">afterRpmFoldRatio</span> <span class="o">=</span> <span class="n">afterRpmFoldRatio</span><span class="p">,</span>  <span class="n">stopRatioFC</span> <span class="o">=</span> <span class="n">stopRatioFC</span><span class="p">,</span> <span class="n">treatStopRatio</span> <span class="o">=</span> <span class="n">treatStopRatio</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">ratioList</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">pre_CMC_label</span><span class="p">,</span> <span class="n">preRpmFoldRatio_label</span><span class="p">,</span> <span class="n">aft_CMC_label</span><span class="p">,</span> <span class="n">afterRpmFoldRatio_label</span><span class="p">,</span> <span class="n">stopRatioFC_label</span><span class="p">,</span> <span class="n">treatStopRatio_label</span><span class="p">)</span>
<span class="n">six_variables_ratio_plot</span><span class="o">&lt;-</span><span class="nf">ggroc</span><span class="p">(</span><span class="n">ratioList</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="n">six_variables_ratio_plot</span><span class="o">&lt;-</span><span class="n">six_variables_ratio_plot</span><span class="o">+</span><span class="nf">geom_abline</span><span class="p">(</span><span class="n">intercept</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">slope</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span>
<span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span>
  <span class="n">legend.key.width</span><span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">0.3</span><span class="p">,</span> <span class="s">&#39;cm&#39;</span><span class="p">),</span>
  <span class="n">legend.text</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">7</span><span class="p">),</span>
  <span class="n">legend.title</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">(),</span>
  <span class="n">panel.background</span><span class="o">=</span><span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">))</span>
<span class="n">six_variables_ratio_plot</span><span class="o">&lt;-</span><span class="n">six_variables_ratio_plot</span><span class="o">+</span> <span class="nf">guides</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">nrow</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="m">3</span><span class="p">))</span><span class="o">+</span><span class="nf">scale_color_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="n">mycol</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_six_variables_ratio_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_six_variables_plot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span> <span class="o">=</span><span class="m">6</span> <span class="p">,</span><span class="n">height</span> <span class="o">=</span> <span class="m">6</span><span class="p">)</span>
<span class="n">six_variables_ratio_plot</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_roc_summary.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span><span class="o">=</span><span class="m">16</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">8</span><span class="p">)</span>
<span class="nf">plot_grid</span><span class="p">(</span><span class="n">pre_plot</span><span class="p">,</span> <span class="n">aft_plot</span><span class="p">,</span> <span class="n">StopMeanFold_plot</span><span class="p">,</span> <span class="n">stopratio_plot</span><span class="p">,</span> <span class="n">ratio_plot</span><span class="p">,</span><span class="n">six_variables_ratio_plot</span><span class="p">,</span> <span class="n">align</span> <span class="o">=</span> <span class="s">&quot;hv&quot;</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">,</span><span class="s">&#39;E&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">))</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="nf">invisible</span><span class="p">(</span><span class="nf">lapply</span><span class="p">(</span><span class="nf">seq_along</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">[,</span><span class="o">-</span><span class="nf">length</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)]),</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="nf">roc</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">ROC_data_sel</span><span class="p">[,</span><span class="n">x</span><span class="p">],</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">),</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_thres&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">coords</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">]),</span> <span class="s">&quot;best&quot;</span><span class="p">,</span><span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span>
<span class="p">}))</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================pre_CMC=========================\n&quot;</span><span class="p">)</span>
<span class="c1"># treatPreRpmFold_thres&lt;-coords(pre_CMC, &quot;best&quot;,transpose = TRUE)[1]</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">pre_CMC</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================aft_CMC=========================\n&quot;</span><span class="p">)</span>
<span class="c1"># treatAfterRpmFold_thres&lt;-coords(aft_CMC, &quot;best&quot;,transpose = TRUE)[1]</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">aft_CMC</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================treatStopMeanFold_CMC=========================\n&quot;</span><span class="p">)</span>
<span class="c1"># treatStopMeanFold_thres&lt;-coords(treatStopMeanFold_CMC, &quot;best&quot;,transpose = TRUE)[1]</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">treatStopMeanFold_CMC</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================preRpmFoldRatio=========================\n&quot;</span><span class="p">)</span>
<span class="c1"># preRpmFoldRatio_thres&lt;-coords(preRpmFoldRatio, &quot;best&quot;,transpose = TRUE)[1]</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================afterRpmFoldRatio=========================\n&quot;</span><span class="p">)</span>
<span class="c1"># afterRpmFoldRatio_thres&lt;-coords(afterRpmFoldRatio, &quot;best&quot;,transpose = TRUE)[1]</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================treatStopRatio=========================\n&quot;</span><span class="p">)</span>
<span class="c1"># treatStopRatio_thres&lt;-coords(treatStopRatio, &quot;best&quot;,transpose = TRUE)[1]</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================stopRatioFC=========================\n&quot;</span><span class="p">)</span>
<span class="c1"># stopRatioFC_thres&lt;-coords(stopRatioFC, &quot;best&quot;,transpose = TRUE)[1]</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;=====================treatStopMeanFoldRatio=========================\n&quot;</span><span class="p">)</span>
<span class="c1"># treatStopMeanFoldRatio_thres&lt;-coords(treatStopMeanFoldRatio, &quot;best&quot;,transpose = TRUE)[1]</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">treatStopMeanFoldRatio</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>


<span class="n">thres</span><span class="o">&lt;-</span><span class="nf">cbind</span><span class="p">(</span><span class="n">treatPreRpmFold_thres</span><span class="p">,</span><span class="n">treatAfterRpmFold_thres</span><span class="p">,</span><span class="n">treatStopMeanFold_thres</span><span class="p">,</span><span class="n">treatStopRatio_thres</span><span class="p">,</span><span class="n">preRpmFoldRatio_thres</span><span class="p">,</span> <span class="n">afterRpmFoldRatio_thres</span><span class="p">,</span> <span class="n">stopRatioFC_thres</span><span class="p">,</span><span class="n">treatStopMeanFoldRatio_thres</span><span class="p">)</span>
<span class="n">thres</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">thres</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_bestthres.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">thres</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_bestthres_colname.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="c1"># Values of all the confusion matrix terms were calculated at the optimal threshold</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">lapply</span><span class="p">(</span><span class="nf">seq_along</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">[,</span><span class="o">-</span><span class="nf">length</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)]),</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">dim</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">[</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">)</span><span class="o">==</span><span class="m">1</span> <span class="o">&amp;</span> <span class="n">ROC_data_sel</span><span class="p">[,</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_thres&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span> <span class="p">])[</span><span class="m">1</span><span class="p">],</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#True Positives (TP)</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">dim</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">[</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">)</span><span class="o">==</span><span class="m">0</span> <span class="o">&amp;</span> <span class="n">ROC_data_sel</span><span class="p">[,</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_thres&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span> <span class="p">])[</span><span class="m">1</span><span class="p">],</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#False Positives (FP)</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">dim</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">[</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">)</span><span class="o">==</span><span class="m">0</span> <span class="o">&amp;</span> <span class="n">ROC_data_sel</span><span class="p">[,</span><span class="n">x</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_thres&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span> <span class="p">])[</span><span class="m">1</span><span class="p">],</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#True Negatives (TN)</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">dim</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">[</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">)</span><span class="o">==</span><span class="m">1</span> <span class="o">&amp;</span> <span class="n">ROC_data_sel</span><span class="p">[,</span><span class="n">x</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_thres&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span> <span class="p">])[</span><span class="m">1</span><span class="p">],</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#False Negatives (FN)</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TPR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">round</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">+</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))),</span><span class="m">3</span><span class="p">),</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#sensitivity (true positive rate, TPR)</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TNR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">round</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">+</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))),</span><span class="m">3</span><span class="p">),</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#specifity (selectivity or true negative rate, TNR)</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FPR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">round</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TNR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="m">3</span><span class="p">),</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#False Positive Rate (FPR) (1 - specificit = FP/​N = FP/(TN + FP), FPR)</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FNR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">round</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TPR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="m">3</span><span class="p">),</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#False Negative Rate, FNR)</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_Prec&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">round</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">+</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))),</span><span class="m">3</span><span class="p">),</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#Precision</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_Recall&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">round</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">+</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))),</span><span class="m">3</span><span class="p">),</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#Recall</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_ACC&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">round</span><span class="p">((</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">+</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">+</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">+</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">+</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))),</span><span class="m">3</span><span class="p">),</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#accuracy</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_F1_score&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">round</span><span class="p">((</span><span class="m">2</span><span class="o">*</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_Recall&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">*</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_Prec&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_Recall&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">+</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_Prec&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))),</span><span class="m">3</span><span class="p">),</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span><span class="c1">#F1_score</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_eval&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="nf">cbind</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TPR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TNR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FPR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FNR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_Prec&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_Recall&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_ACC&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)),</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_F1_score&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))),</span><span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_eval&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)))</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FP&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FN&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TPR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_TNR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FPR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_FNR&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_Prec&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_Recall&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_ACC&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
      <span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_F1_score&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="nf">assign</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)[</span><span class="n">x</span><span class="p">],</span><span class="s">&quot;_eval&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">envir</span> <span class="o">=</span> <span class="n">.GlobalEnv</span><span class="p">)</span>
    <span class="p">}))</span>


<span class="n">confusion_matrix_and_indicators</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">rbind</span><span class="p">(</span>
    <span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">treatPreRpmFold_eval</span><span class="p">)),</span>
    <span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">treatAfterRpmFold_eval</span><span class="p">)),</span>
    <span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">treatStopMeanFold_eval</span><span class="p">)),</span>
    <span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">preRpmFoldRatio_eval</span><span class="p">)),</span>
    <span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">afterRpmFoldRatio_eval</span><span class="p">)),</span>
    <span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">treatStopRatio_eval</span><span class="p">)),</span>
    <span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">stopRatioFC_eval</span><span class="p">)),</span>
    <span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">treatStopMeanFoldRatio_eval</span><span class="p">))))</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">confusion_matrix_and_indicators</span><span class="p">)</span><span class="o">&lt;-</span><span class="s">&quot;value_or_percentage&quot;</span>
<span class="n">confusion_matrix_and_indicators_arrange</span><span class="o">&lt;-</span><span class="nf">arrange</span><span class="p">(</span><span class="n">confusion_matrix_and_indicators</span><span class="p">,</span><span class="nf">desc</span><span class="p">(</span><span class="n">value_or_percentage</span><span class="p">))</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">confusion_matrix_and_indicators</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_confusion_matrix_and_indicators.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">confusion_matrix_and_indicators_arrange</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_confusion_matrix_and_indicators_arrange.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>


<span class="n">best_eval</span><span class="o">&lt;-</span><span class="nf">rownames</span><span class="p">(</span><span class="n">confusion_matrix_and_indicators_arrange</span><span class="p">)[</span><span class="nf">str_detect</span><span class="p">(</span><span class="nf">rownames</span><span class="p">(</span><span class="n">confusion_matrix_and_indicators_arrange</span><span class="p">),</span><span class="s">&quot;_F1_score&quot;</span><span class="p">)][</span><span class="m">1</span><span class="p">]</span>
<span class="nf">assign</span><span class="p">(</span><span class="s">&quot;best_eval_t_df&quot;</span><span class="p">,</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">get</span><span class="p">(</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">best_eval</span><span class="p">,</span><span class="s">&quot;_F1_score&quot;</span><span class="p">,</span><span class="s">&quot;_eval&quot;</span><span class="p">))))))</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">best_eval_t_df</span><span class="p">)</span><span class="o">&lt;-</span><span class="s">&quot;value_or_percentage&quot;</span>

<span class="c1">#show afterRpmFoldRatio_eval_t_df as pdf table</span>
<span class="n">tt3</span> <span class="o">&lt;-</span> <span class="nf">ttheme_minimal</span><span class="p">(</span>
  <span class="n">core</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">bg_params</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">blues9</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="kc">NA</span><span class="p">),</span>
            <span class="n">fg_params</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">fontface</span><span class="o">=</span><span class="m">3</span><span class="p">)),</span>
  <span class="n">colhead</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">fg_params</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;navyblue&quot;</span><span class="p">,</span> <span class="n">fontface</span><span class="o">=</span><span class="m">4L</span><span class="p">)),</span>
  <span class="n">rowhead</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">fg_params</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="n">fontface</span><span class="o">=</span><span class="m">3L</span><span class="p">)))</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_best_evaluation.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">7</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">7</span><span class="p">)</span> <span class="c1"># Open a new pdf file</span>
<span class="nf">grid.arrange</span><span class="p">(</span>
  <span class="nf">tableGrob</span><span class="p">(</span><span class="n">best_eval_t_df</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="n">tt3</span><span class="p">),</span>
  <span class="n">nrow</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span> <span class="c1"># Close the file</span>

<span class="c1">#read hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed evidence</span>
<span class="n">evidence</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span><span class="c1">#&quot;hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed&quot;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="s">&quot;rRNA_anno&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">,</span><span class="s">&quot;strand&quot;</span><span class="p">)</span>
<span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>

<span class="c1">#read hg38.psiU.SingleSites.bed</span>
<span class="n">evidence2</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">rRNAfile2</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span><span class="c1">#&quot;hg38.psiU.SingleSites.bed&quot;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">evidence2</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="s">&quot;rRNA_anno&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">,</span><span class="s">&quot;strand&quot;</span><span class="p">)</span>
<span class="n">evidence2</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>

<span class="c1">#filt by stopRatioFC_thres</span>
<span class="n">to_filt</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">filtfile</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">to_filt</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="c1">#1</span>
    <span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="c1">#2</span>
    <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="c1">#3</span>
    <span class="s">&quot;name&quot;</span><span class="p">,</span><span class="c1">#4</span>
    <span class="s">&quot;foldChange&quot;</span><span class="p">,</span><span class="c1">#5</span>
    <span class="s">&quot;strand&quot;</span><span class="p">,</span><span class="c1">#6</span>
    <span class="s">&quot;geneName&quot;</span><span class="p">,</span><span class="c1">#7</span>
    <span class="s">&quot;geneStart&quot;</span><span class="p">,</span><span class="c1">#8</span>
    <span class="s">&quot;geneEnd&quot;</span><span class="p">,</span><span class="c1">#9</span>
    <span class="s">&quot;base&quot;</span><span class="p">,</span><span class="c1">#10</span>
    <span class="s">&quot;treatPval&quot;</span><span class="p">,</span><span class="c1">#11</span>
    <span class="s">&quot;ctrlPval&quot;</span><span class="p">,</span><span class="c1">#12</span>
    <span class="s">&quot;minusPval&quot;</span><span class="p">,</span><span class="c1">#13</span>
    <span class="s">&quot;treatStopNum&quot;</span><span class="p">,</span><span class="c1">#14</span>
    <span class="s">&quot;treatStopRPM&quot;</span><span class="p">,</span><span class="c1">#15</span>
    <span class="s">&quot;treatPreStopNum&quot;</span><span class="p">,</span><span class="c1">#16</span>
    <span class="s">&quot;treatAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#17</span>
    <span class="s">&quot;treatReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#18</span>
    <span class="s">&quot;ctrlStopNum&quot;</span><span class="p">,</span><span class="c1">#19</span>
    <span class="s">&quot;ctrlStopRPM&quot;</span><span class="p">,</span><span class="c1">#20</span>
    <span class="s">&quot;ctrlPreStopNum&quot;</span><span class="p">,</span><span class="c1">#21</span>
    <span class="s">&quot;ctrlAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#22</span>
    <span class="s">&quot;ctrlReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#23</span>
    <span class="s">&quot;stopRpmFC&quot;</span><span class="p">,</span><span class="c1">#24</span>
    <span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#25</span>
    <span class="s">&quot;ctrlPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#26</span>
    <span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#27</span>
    <span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#28</span>
    <span class="s">&quot;ctrlAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#29</span>
    <span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#30</span>
    <span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="c1">#31</span>
    <span class="s">&quot;ctrlStopRatio&quot;</span><span class="p">,</span><span class="c1">#32</span>
    <span class="s">&quot;stopRatioFC&quot;</span><span class="p">,</span><span class="c1">#33</span>
    <span class="s">&quot;treatStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#34</span>
    <span class="s">&quot;treatStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#35</span>
    <span class="s">&quot;ctrlStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#36</span>
    <span class="s">&quot;ctrlStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#37</span>
    <span class="s">&quot;treatStopMeanFoldRatio&quot;</span><span class="p">,</span><span class="c1">#38</span>
    <span class="s">&quot;extendSeq&quot;</span><span class="p">)</span><span class="c1">#39</span>
<span class="n">to_filt</span><span class="o">$</span><span class="n">base</span><span class="o">&lt;-</span><span class="s">&quot;T&quot;</span>

<span class="n">to_filt</span><span class="o">$</span><span class="n">roc_class</span><span class="o">&lt;-</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">to_filt</span><span class="p">[,</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">best_eval</span><span class="p">,</span><span class="s">&quot;_F1_score&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)]</span><span class="o">&gt;</span><span class="nf">get</span><span class="p">(</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">best_eval</span><span class="p">,</span><span class="s">&quot;_F1_score&quot;</span><span class="p">,</span><span class="s">&quot;_thres&quot;</span><span class="p">)))</span>
<span class="n">to_filt</span><span class="o">$</span><span class="n">roc_class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">to_filt</span><span class="o">$</span><span class="n">roc_class</span><span class="p">),</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">to_filt</span><span class="o">$</span><span class="n">roc_class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">to_filt</span><span class="o">$</span><span class="n">roc_class</span><span class="p">),</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">to_filt</span><span class="o">$</span><span class="n">roc_class</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">to_filt</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_total_prediction.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="n">final_pred</span><span class="o">&lt;-</span><span class="n">to_filt</span><span class="p">[</span><span class="n">to_filt</span><span class="p">[,</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">best_eval</span><span class="p">,</span><span class="s">&quot;_F1_score&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)]</span><span class="o">&gt;</span><span class="nf">get</span><span class="p">(</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">best_eval</span><span class="p">,</span><span class="s">&quot;_F1_score&quot;</span><span class="p">,</span><span class="s">&quot;_thres&quot;</span><span class="p">)),]</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_psi_prediction.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_roc_psi_prediction.bed&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="c1">#known_data miss/hit hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed</span>
<span class="n">ROC_data</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">ROC_data_evidence</span><span class="o">&lt;-</span><span class="n">ROC_data</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">ROC_data_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">ROC_data_no_evidence</span><span class="o">&lt;-</span><span class="n">evidence</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">ROC_data</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">class</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">ROC_data_no_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">ROC_data_evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;rtsSeeker recover (hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>

<span class="c1">#known_data miss/hit hg38.psiU.SingleSites.bed</span>
<span class="n">ROC_data</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">ROC_data_evidence2</span><span class="o">&lt;-</span><span class="n">ROC_data</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence2</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">ROC_data_evidence2</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38.psiU.SingleSites.bed_rtsSeeker_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">ROC_data_no_evidence2</span><span class="o">&lt;-</span><span class="n">evidence2</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">ROC_data</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">class</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">ROC_data_no_evidence2</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38.psiU.SingleSites.bed_rtsSeeker_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">ROC_data_evidence2</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence2</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;rtsSeeker recover (hg38.psiU.SingleSites.bed.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>

<span class="c1">#final_pred miss/hit</span>
<span class="n">final_pred</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">final_pred_evidence</span><span class="o">&lt;-</span><span class="n">final_pred</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_roc_stopRatioFC_thres_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">final_pred_no_evidence</span><span class="o">&lt;-</span><span class="n">evidence</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_no_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_roc_stopRatioFC_thres_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;rtsSeeker+ROC recover (hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="search-psi-sites">
<h3><a class="toc-backref" href="#id6">search psi sites</a><a class="headerlink" href="#search-psi-sites" title="Permalink to this heading">¶</a></h3>
<p>Correspond to rtsSeeker <code class="docutils literal notranslate"><span class="pre">-U/--psi</span></code> argument.</p>
</section>
<section id="skip-read-with-soft-clip">
<h3><a class="toc-backref" href="#id7">skip read with soft clip</a><a class="headerlink" href="#skip-read-with-soft-clip" title="Permalink to this heading">¶</a></h3>
<p>Default is false, correspond to rtsSeeker <code class="docutils literal notranslate"><span class="pre">-S/--soft</span></code> argument.</p>
</section>
<section id="normalized-reads-to-the-locus-number">
<h3><a class="toc-backref" href="#id8">normalized reads to the locus number</a><a class="headerlink" href="#normalized-reads-to-the-locus-number" title="Permalink to this heading">¶</a></h3>
<p>Correspond to rtsSeeker <code class="docutils literal notranslate"><span class="pre">-n/--norm</span></code> argument.</p>
</section>
<section id="keep-duplication">
<h3><a class="toc-backref" href="#id9">keep duplication</a><a class="headerlink" href="#keep-duplication" title="Permalink to this heading">¶</a></h3>
<p>Default is false, correspond to rtsSeeker <code class="docutils literal notranslate"><span class="pre">-c/--collapser</span></code> argument.</p>
</section>
</section>
<section id="detail">
<h2><a class="toc-backref" href="#id10">Detail</a><a class="headerlink" href="#detail" title="Permalink to this heading">¶</a></h2>
<p>Detailed argume
nt for <code class="docutils literal notranslate"><span class="pre">rtsSeeker</span></code> output information control.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Usage:  rtsSeeker <span class="o">[</span>options<span class="o">]</span> --fa &lt;genome seq&gt; --fai &lt;fai file&gt; --gene &lt;bed12 gene file&gt; --treat &lt;treat alignments&gt; --input &lt;input alignments&gt;
rtsSeeker: <span class="k">for</span> seeking the reverse transcriptase stop sites
<span class="o">[</span>options<span class="o">]</span>
-v/--verbose                   : verbose information
-V/--version                   : rtsSeeker version
-h/--help                      : <span class="nb">help</span> informations
-U/--psi                       : search psi sites
-s/--strand                    : strand-specific<span class="o">[</span><span class="nv">default</span><span class="o">=</span>false<span class="o">]</span>
-S/--soft                      : skip <span class="nb">read</span> with soft-clip<span class="o">[</span><span class="nv">default</span><span class="o">=</span>false<span class="o">]</span>
-n/--norm                      : normalized reads to the locus number
-p/--pval                      : p-value<span class="o">[</span><span class="nv">default</span><span class="o">=</span><span class="m">1</span>.5<span class="o">]</span>
-c/--collapser                 : keep duplication, deault is <span class="nb">false</span>
-M/--model &lt;int&gt;               : model<span class="o">[</span><span class="m">0</span> <span class="k">for</span> genome, <span class="m">1</span> <span class="k">for</span> gene, <span class="m">2</span> <span class="k">for</span> both, <span class="nv">default</span><span class="o">=</span><span class="m">1</span><span class="o">]</span>
--treat &lt;string&gt;               : treatment file&lt;BAM format&gt;
--input &lt;string&gt;               : input file&lt;BAM format&gt;
--gene &lt;string&gt;                : gene file &lt;BED12 format&gt;
-o/--outfile &lt;string&gt;          : output file
-t/--min-tag &lt;double&gt;          : minimum tag number <span class="k">for</span> each psi, default&gt;<span class="o">=</span><span class="m">5</span>.0 <span class="nb">read</span>
-r/--rpm &lt;double&gt;              : minimum rpm value <span class="k">for</span> each psi, default&gt;<span class="o">=</span><span class="m">0</span>.05
-f/--fold &lt;int&gt;                : minimum fold-change<span class="o">[</span>default&gt;<span class="o">=</span><span class="m">1</span>.0<span class="o">]</span>
-m/--mfold &lt;int&gt;               : minimum fold-change <span class="k">for</span> stop-tag/mean-tag
-w/--window &lt;int&gt;              : window size around the rts position<span class="o">[</span><span class="nv">default</span><span class="o">=</span><span class="m">50</span><span class="o">]</span>
-l/--min-len &lt;int&gt;             : minimum length of reads, <span class="nv">default</span><span class="o">=</span><span class="m">15</span>
-L/--max-len &lt;int&gt;             : maximum length of reads, <span class="nv">default</span><span class="o">=</span><span class="m">1000</span>
</pre></div>
</div>
</section>
<section id="identify-sites-using-different-approaches">
<h2><a class="toc-backref" href="#id11">Identify Ψ-sites using different approaches</a><a class="headerlink" href="#identify-sites-using-different-approaches" title="Permalink to this heading">¶</a></h2>
<section id="svm-support-vector-machine">
<h3><a class="toc-backref" href="#id12">(1) SVM: Support Vector Machine</a><a class="headerlink" href="#svm-support-vector-machine" title="Permalink to this heading">¶</a></h3>
<p>If <code class="docutils literal notranslate"><span class="pre">SVM</span></code> QT wideget is clicked and popouped:</p>
<ul class="simple">
<li><p>press <code class="docutils literal notranslate"><span class="pre">BUILD</span></code> buttor will run <code class="docutils literal notranslate"><span class="pre">svm.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">svm_build_totalRNA.r</span></code> to generate file with <code class="docutils literal notranslate"><span class="pre">_SVM_model.RData</span></code> suffix, which is the support vector model built by SVM algorithm.</p></li>
<li><p>press <code class="docutils literal notranslate"><span class="pre">PREDICT</span></code> buttor will run <code class="docutils literal notranslate"><span class="pre">svm_predict_totalRNA.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">svm_predict_totalRNA.r</span></code> to generate file with <code class="docutils literal notranslate"><span class="pre">_svm_psi_prediction.bed</span></code> suffix, which is the candidate Ψ-sites predicted by SVM algorithm.</p></li>
</ul>
<img alt="../_images/SVM.png" src="../_images/SVM.png" />
<p><code class="docutils literal notranslate"><span class="pre">svm.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$#</span> -ne <span class="m">4</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s1">&#39;Usage: &#39;</span><span class="nv">$0</span> <span class="s1">&#39; input.bam treatment.bam genome.fa out.bed&#39;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nv">input</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">treatment</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">genome</span><span class="o">=</span><span class="nv">$3</span>
<span class="nv">out</span><span class="o">=</span><span class="nv">$4</span>
<span class="nv">outFileName</span><span class="o">=</span><span class="si">${</span><span class="nv">out</span><span class="p">%.bed</span><span class="si">}</span>

<span class="nb">echo</span> <span class="s2">&quot;rtsSeeker SVM mode: rtsSeeker start...&quot;</span>
<span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&quot;</span><span class="si">${</span><span class="nv">genome</span><span class="si">}</span><span class="s2">.fai&quot;</span>  <span class="o">]</span>
<span class="k">then</span>
<span class="nb">echo</span> <span class="s2">&quot;generate faifile&quot;</span>
samtools faidx <span class="nv">$genome</span>
<span class="k">else</span>
<span class="nb">echo</span> <span class="s2">&quot;faifile exist&quot;</span>
<span class="k">fi</span>

<span class="nb">echo</span> <span class="s2">&quot;</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">/rtsSeeker --fa </span><span class="nv">$genome</span><span class="s2"> --fai </span><span class="si">${</span><span class="nv">genome</span><span class="si">}</span><span class="s2">.fai --treat </span><span class="nv">$treatment</span><span class="s2"> --input </span><span class="nv">$input</span><span class="s2"> -p 1.5 -t 5 -r 0.05 -M 1 --gene </span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">/hg38.gencode.v30.tRNA.refseqNcRNA.geneAnno.bed12 -f 1 -m 0 -s -w 20 -o </span><span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span><span class="s2">_svm_all.bed 2&gt;</span><span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span><span class="s2">_svm_all_rtsSeeker.log&quot;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_all_rtsSeeker.cmd <span class="c1"># no -c remove duplicate</span>
<span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/rtsSeeker --fa <span class="nv">$genome</span> --fai <span class="si">${</span><span class="nv">genome</span><span class="si">}</span>.fai --treat <span class="nv">$treatment</span> --input <span class="nv">$input</span> -p <span class="m">1</span>.5 -t <span class="m">5</span> -r <span class="m">0</span>.05 -M <span class="m">1</span> --gene <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38.gencode.v30.tRNA.refseqNcRNA.geneAnno.bed12 -f <span class="m">1</span> -m <span class="m">0</span> -s -w <span class="m">20</span> -o <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_all.bed <span class="m">2</span>&gt;<span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_all_rtsSeeker.log <span class="c1"># no -c remove duplicate</span>
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_all.bed &gt; <span class="nv">$out</span>

awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {if($1~/^chr[0-9|a-z|A-Z]*$/ &amp;&amp; $10==&quot;T&quot; &amp;&amp; $14&gt;10){print $0}}&#39;</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_all.bed &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_filt_totalRNA.bed
bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_filt_totalRNA.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.bed
bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_filt_totalRNA.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/rrna_chr21.bed -s &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_rrna.bed
bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_rrna.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s -v &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.bed
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.bed <span class="p">|</span>awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {print $0,&quot;1&quot;}&#39;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.txt
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.bed <span class="p">|</span>awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {print $0,&quot;0&quot;}&#39;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.txt
<span class="nb">echo</span> <span class="s2">&quot;getting roc_plot.txt&quot;</span>
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.txt <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.txt &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_plot.txt

nohup Rscript <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/svm_build_totalRNA.r -f <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_plot.txt -k <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_filt_totalRNA.bed -r <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38.psiU.SingleSites.bed  -o <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_evaluation_totalRNA.log <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
<span class="nb">wait</span>

cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_evaluation_totalRNA.log
mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_six_variables_rRNA_violinplot.pdf <span class="p">&amp;</span>&gt; /dev/null
mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_SVM_roc_test_data_plot.pdf <span class="p">&amp;</span>&gt; /dev/null
mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_evaluation.pdf <span class="p">&amp;</span>&gt; /dev/null

<span class="nb">echo</span> <span class="s2">&quot;total RNA: SVM program is done!&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;total RNA: SVM result in </span><span class="k">$(</span>dirname <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_svm_psi_prediction.bed<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">svm_build_totalRNA.r</span></code></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/env Rscript</span>

<span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;optparse&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;e1071&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;stringr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;gridExtra&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;cowplot&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;pROC&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggplot2&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggpubr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;reshape2&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;RColorBrewer&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;openxlsx&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;caTools&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;factoextra&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggpol&quot;</span><span class="p">))</span>


<span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>

<span class="n">option_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-f&quot;</span><span class="p">,</span> <span class="s">&quot;--svmfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;ROC of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-k&quot;</span><span class="p">,</span> <span class="s">&quot;--filtfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;filted file of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-r&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;rRNA of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-s&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile2&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;hg38.psiU.SingleSites.bed [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="s">&quot;--outfile_prefix&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;output file name [default= %default]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">)</span>
<span class="p">);</span>
<span class="n">opt_parser</span> <span class="o">=</span> <span class="nf">OptionParser</span><span class="p">(</span><span class="n">option_list</span><span class="o">=</span><span class="n">option_list</span><span class="p">);</span>
<span class="n">opt</span> <span class="o">=</span> <span class="nf">parse_args</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>

<span class="nf">if </span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">svmfile</span><span class="p">)</span><span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile2</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span><span class="p">)</span> <span class="p">){</span>
  <span class="nf">print_help</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>
  <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;Please provide -f svmfile, -k filtfile, -r rRNAfile, -s rRNAfile2, and -o outfile_prefix option&quot;</span><span class="p">,</span> <span class="n">call.</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">svmfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">svmfile</span>
<span class="n">filtfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span>
<span class="n">rRNAfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span>
<span class="n">rRNAfile2</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile2</span>
<span class="n">outFile_prefix</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span>

<span class="nf">print</span><span class="p">(</span><span class="n">svmfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">filtfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile2</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">)</span>


<span class="c1">#load data</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Load data to perform classification model (factor as input)=====================\n&quot;</span><span class="p">)</span>
<span class="n">SVM_data</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">svmfile</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">SVM_data</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="c1">#1</span>
  <span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="c1">#2</span>
  <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="c1">#3</span>
  <span class="s">&quot;name&quot;</span><span class="p">,</span><span class="c1">#4</span>
  <span class="s">&quot;foldChange&quot;</span><span class="p">,</span><span class="c1">#5</span>
  <span class="s">&quot;strand&quot;</span><span class="p">,</span><span class="c1">#6</span>
  <span class="s">&quot;geneName&quot;</span><span class="p">,</span><span class="c1">#7</span>
  <span class="s">&quot;geneStart&quot;</span><span class="p">,</span><span class="c1">#8</span>
  <span class="s">&quot;geneEnd&quot;</span><span class="p">,</span><span class="c1">#9</span>
  <span class="s">&quot;base&quot;</span><span class="p">,</span><span class="c1">#10</span>
  <span class="s">&quot;treatPval&quot;</span><span class="p">,</span><span class="c1">#11</span>
  <span class="s">&quot;ctrlPval&quot;</span><span class="p">,</span><span class="c1">#12</span>
  <span class="s">&quot;minusPval&quot;</span><span class="p">,</span><span class="c1">#13</span>
  <span class="s">&quot;treatStopNum&quot;</span><span class="p">,</span><span class="c1">#14</span>
  <span class="s">&quot;treatStopRPM&quot;</span><span class="p">,</span><span class="c1">#15</span>
  <span class="s">&quot;treatPreStopNum&quot;</span><span class="p">,</span><span class="c1">#16</span>
  <span class="s">&quot;treatAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#17</span>
  <span class="s">&quot;treatReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#18</span>
  <span class="s">&quot;ctrlStopNum&quot;</span><span class="p">,</span><span class="c1">#19</span>
  <span class="s">&quot;ctrlStopRPM&quot;</span><span class="p">,</span><span class="c1">#20</span>
  <span class="s">&quot;ctrlPreStopNum&quot;</span><span class="p">,</span><span class="c1">#21</span>
  <span class="s">&quot;ctrlAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#22</span>
  <span class="s">&quot;ctrlReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#23</span>
  <span class="s">&quot;stopRpmFC&quot;</span><span class="p">,</span><span class="c1">#24</span>
  <span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#25 *</span>
  <span class="s">&quot;ctrlPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#26</span>
  <span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#27 *</span>
  <span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#28 *</span>
  <span class="s">&quot;ctrlAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#29</span>
  <span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#30 *</span>
  <span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="c1">#31 *</span>
  <span class="s">&quot;ctrlStopRatio&quot;</span><span class="p">,</span><span class="c1">#32</span>
  <span class="s">&quot;stopRatioFC&quot;</span><span class="p">,</span><span class="c1">#33 *</span>
  <span class="s">&quot;treatStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#34</span>
  <span class="s">&quot;treatStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#35</span>
  <span class="s">&quot;ctrlStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#36</span>
  <span class="s">&quot;ctrlStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#37</span>
  <span class="s">&quot;treatStopMeanFoldRatio&quot;</span><span class="p">,</span><span class="c1">#38</span>
  <span class="s">&quot;extendSeq&quot;</span><span class="p">,</span><span class="c1">#39</span>
  <span class="s">&quot;class&quot;</span><span class="p">)</span><span class="c1">#40</span>
<span class="n">SVM_data</span><span class="o">$</span><span class="n">base</span><span class="o">&lt;-</span><span class="s">&quot;T&quot;</span>

<span class="c1">#rRNA-psi-non-psi visualization</span>
<span class="n">SVM_data_sel</span><span class="o">&lt;-</span><span class="n">SVM_data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span><span class="n">preRpmFoldRatio</span><span class="p">,</span><span class="n">treatAfterRpmFold</span><span class="p">,</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">stopRatioFC</span><span class="p">,</span><span class="n">class</span><span class="p">)</span>
<span class="n">SVM_data_melt</span><span class="o">&lt;-</span><span class="nf">melt</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="p">,</span><span class="n">id.vars</span> <span class="o">=</span> <span class="s">&quot;class&quot;</span><span class="p">)</span>
<span class="n">SVM_data_melt</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">SVM_data_melt</span><span class="o">$</span><span class="n">class</span><span class="p">),</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">SVM_data_melt</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">SVM_data_melt</span><span class="o">$</span><span class="n">class</span><span class="p">),</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">)</span>

<span class="n">data_summary</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">m</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">ymin</span> <span class="o">&lt;-</span> <span class="n">m</span><span class="o">-</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">ymax</span> <span class="o">&lt;-</span> <span class="n">m</span><span class="o">+</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="nf">return</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">m</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">my_comparisons</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;non-psi&quot;</span><span class="p">,</span> <span class="s">&quot;psi&quot;</span><span class="p">)</span> <span class="p">)</span>

<span class="c1">#treatPreRpmFold</span>
<span class="n">treatPreRpmFold</span><span class="o">&lt;-</span><span class="n">SVM_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatPreRpmFold$&quot;</span><span class="p">))</span>
<span class="n">treatPreRpmFold_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatPreRpmFold)&quot;</span><span class="p">)</span>
<span class="n">treatPreRpmFold_bp</span><span class="o">&lt;-</span><span class="n">treatPreRpmFold_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#treatAfterRpmFold</span>
<span class="n">treatAfterRpmFold</span><span class="o">&lt;-</span><span class="n">SVM_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatAfterRpmFold$&quot;</span><span class="p">))</span>
<span class="n">treatAfterRpmFold_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatAfterRpmFold)&quot;</span><span class="p">)</span>
<span class="n">treatAfterRpmFold_bp</span><span class="o">&lt;-</span><span class="n">treatAfterRpmFold_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#preRpmFoldRatio</span>
<span class="n">preRpmFoldRatio</span><span class="o">&lt;-</span><span class="n">SVM_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^preRpmFoldRatio$&quot;</span><span class="p">))</span>
<span class="n">preRpmFoldRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(preRpmFoldRatio)&quot;</span><span class="p">)</span>
<span class="n">preRpmFoldRatio_bp</span><span class="o">&lt;-</span><span class="n">preRpmFoldRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="c1"># theme(text=element_text(size=8), axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1),legend.position = &quot;none&quot;) + font(&quot;xy.text&quot;, size = 8)+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#afterRpmFoldRatio</span>
<span class="n">afterRpmFoldRatio</span><span class="o">&lt;-</span><span class="n">SVM_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^afterRpmFoldRatio$&quot;</span><span class="p">))</span>
<span class="n">afterRpmFoldRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(afterRpmFoldRatio)&quot;</span><span class="p">)</span>
<span class="n">afterRpmFoldRatio_bp</span><span class="o">&lt;-</span><span class="n">afterRpmFoldRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#treatStopRatio</span>
<span class="n">treatStopRatio</span><span class="o">&lt;-</span><span class="n">SVM_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatStopRatio$&quot;</span><span class="p">))</span>
<span class="n">treatStopRatio</span><span class="o">&lt;-</span><span class="n">treatStopRatio</span><span class="p">[</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="o">!=</span><span class="m">0</span><span class="p">,]</span>
<span class="n">treatStopRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatStopRatio)&quot;</span><span class="p">)</span>
<span class="n">treatStopRatio_bp</span><span class="o">&lt;-</span><span class="n">treatStopRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="n">stopRatioFC</span><span class="o">&lt;-</span><span class="n">SVM_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^stopRatioFC$&quot;</span><span class="p">))</span>
<span class="n">stopRatioFC_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(stopRatioFC)&quot;</span><span class="p">)</span>
<span class="n">stopRatioFC_bp</span><span class="o">&lt;-</span><span class="n">stopRatioFC_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>


<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_six_variables_rRNA_violinplot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">6</span><span class="p">)</span>
<span class="nf">plot_grid</span><span class="p">(</span>
  <span class="n">treatPreRpmFold_bp</span><span class="p">,</span>
  <span class="n">preRpmFoldRatio_bp</span><span class="p">,</span>
  <span class="n">treatAfterRpmFold_bp</span><span class="p">,</span>
  <span class="n">afterRpmFoldRatio_bp</span><span class="p">,</span>
  <span class="n">treatStopRatio_bp</span><span class="p">,</span>
  <span class="n">stopRatioFC_bp</span><span class="p">,</span>
  <span class="n">align</span> <span class="o">=</span> <span class="s">&quot;hv&quot;</span><span class="p">,</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">,</span><span class="s">&#39;E&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>


<span class="n">SVM_data_sel</span><span class="o">&lt;-</span><span class="n">SVM_data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span><span class="n">preRpmFoldRatio</span><span class="p">,</span><span class="n">treatAfterRpmFold</span><span class="p">,</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">stopRatioFC</span><span class="p">,</span><span class="n">class</span><span class="p">)</span>
<span class="nf">rownames</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="p">)</span><span class="o">&lt;-</span><span class="n">SVM_data</span><span class="o">$</span><span class="n">name</span>
<span class="n">cpm.of.diff.gene</span> <span class="o">&lt;-</span> <span class="nf">t</span><span class="p">(</span><span class="n">SVM_data_sel</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">class</span><span class="p">))</span>
<span class="n">pca</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">cpm.of.diff.gene</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">fviz_eig</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span><span class="n">addlabels</span> <span class="o">=</span> <span class="bp">T</span><span class="p">)</span>
<span class="n">group.list</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="s">&quot;stopRatioFC&quot;</span><span class="p">)</span>
<span class="n">group.list</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">group.list</span><span class="p">)</span>
<span class="nf">fviz_pca_ind</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span> <span class="n">geom.ind</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;point&quot;</span><span class="p">),</span> <span class="n">col.ind</span> <span class="o">=</span> <span class="n">group.list</span><span class="p">,</span>
             <span class="n">palette</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">3</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">4</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">5</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">7</span><span class="p">]),</span>
             <span class="n">legend.title</span> <span class="o">=</span> <span class="s">&quot;Groups&quot;</span><span class="p">)</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_pca.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>

<span class="n">SVM_data_sel</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">str_replace_all</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">,</span> <span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">SVM_data_sel</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">str_replace_all</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;psi&quot;</span><span class="p">)</span>
<span class="c1">#Encoding the target feature as factor</span>
<span class="n">SVM_data_sel</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">as.factor</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;total classification: &quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>

<span class="c1"># Splitting the dataset into the Training set and Test set</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">split</span> <span class="o">=</span> <span class="nf">sample.split</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">,</span> <span class="n">SplitRatio</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span>
<span class="n">training_set</span> <span class="o">=</span> <span class="nf">subset</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="p">,</span> <span class="n">split</span> <span class="o">==</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">test_set</span> <span class="o">=</span> <span class="nf">subset</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="p">,</span> <span class="n">split</span> <span class="o">==</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="n">training_set_mean</span><span class="o">&lt;-</span><span class="nf">apply</span><span class="p">(</span><span class="n">training_set</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">class</span><span class="p">),</span><span class="m">2</span><span class="p">,</span><span class="n">mean</span><span class="p">)</span><span class="c1"># training_set_sd&lt;-apply(training_set %&gt;% select(-class),2,sd)</span>
<span class="n">training_set_sd</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">0.05</span><span class="p">,</span><span class="m">10</span><span class="p">)</span>
<span class="n">training_set</span><span class="p">[</span><span class="m">-7</span><span class="p">]</span> <span class="o">=</span> <span class="nf">scale</span><span class="p">(</span><span class="n">training_set</span><span class="p">[</span><span class="m">-7</span><span class="p">],</span><span class="n">training_set_mean</span><span class="p">,</span><span class="n">training_set_sd</span><span class="p">)</span><span class="c1"># test_set[-7] = scale(test_set[-7],center=training_set_mean,scale=training_set_sd)</span>
<span class="n">training_set_origin</span> <span class="o">=</span> <span class="nf">subset</span><span class="p">(</span><span class="n">SVM_data</span><span class="p">,</span> <span class="n">split</span> <span class="o">==</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">test_set_origin</span> <span class="o">=</span> <span class="nf">subset</span><span class="p">(</span><span class="n">SVM_data</span><span class="p">,</span> <span class="n">split</span> <span class="o">==</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="s">&quot;training set classification using sample.split: &quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">training_set</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span><span class="c1">#mean equals to mymodel[[&quot;x.scale&quot;]][[&quot;scaled:center&quot;]]; sd equals to mymodel[[&quot;x.scale&quot;]][[&quot;scaled:scale&quot;]]</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="s">&quot;test set classification using sample.split: &quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">test_set</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>

<span class="c1">#evaluate contributation of each variables</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Evaluate contributation for each variables=====================\n&quot;</span><span class="p">)</span>
<span class="n">fit2</span> <span class="o">&lt;-</span> <span class="nf">svm</span><span class="p">(</span><span class="n">class</span> <span class="o">~</span> <span class="n">.</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">SVM_data_sel</span><span class="p">)</span>
<span class="n">w</span> <span class="o">&lt;-</span> <span class="nf">t</span><span class="p">(</span><span class="n">fit2</span><span class="o">$</span><span class="n">coefs</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">fit2</span><span class="o">$</span><span class="n">SV</span>                 <span class="c1"># weight vectors</span>
<span class="n">w</span> <span class="o">&lt;-</span> <span class="nf">apply</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">v</span><span class="p">){</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">v</span><span class="o">^</span><span class="m">2</span><span class="p">))})</span>  <span class="c1"># weight</span>
<span class="n">w</span> <span class="o">&lt;-</span> <span class="nf">sort</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">decreasing</span> <span class="o">=</span> <span class="bp">T</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>


<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Get best model using tune (for modeling)=====================\n&quot;</span><span class="p">)</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">100</span><span class="p">)</span>
<span class="n">tmodel</span> <span class="o">=</span> <span class="nf">tune</span><span class="p">(</span><span class="n">svm</span><span class="p">,</span>
              <span class="n">class</span><span class="o">~</span><span class="n">.</span><span class="p">,</span>
              <span class="n">data</span><span class="o">=</span><span class="n">training_set</span><span class="p">,</span>
              <span class="n">type</span><span class="o">=</span><span class="s">&quot;C-classification&quot;</span><span class="p">,</span>
              <span class="n">kernel</span><span class="o">=</span><span class="s">&quot;radial&quot;</span><span class="p">,</span>
              <span class="n">ranges</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="m">10</span><span class="o">^</span><span class="p">(</span><span class="m">-1</span><span class="o">:</span><span class="m">2</span><span class="p">),</span> <span class="n">gamma</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">.</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)),</span><span class="n">probability</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="kc">FALSE</span>
<span class="p">)</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_tmodel_plot.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">tmodel</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="nf">summary</span><span class="p">(</span><span class="n">tmodel</span><span class="p">)</span>
<span class="n">mymodel</span> <span class="o">&lt;-</span> <span class="n">tmodel</span><span class="o">$</span><span class="n">best.model</span>
<span class="n">mymodel</span><span class="o">$</span><span class="n">scaled</span><span class="o">&lt;-</span><span class="nf">as.logical</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;TRUE&quot;</span><span class="p">,</span><span class="m">6</span><span class="p">))</span>
<span class="n">mymodel</span><span class="p">[[</span><span class="s">&quot;x.scale&quot;</span><span class="p">]][[</span><span class="s">&quot;scaled:center&quot;</span><span class="p">]]</span><span class="o">&lt;-</span><span class="n">training_set_mean</span>
<span class="nf">attr</span><span class="p">(</span><span class="n">mymodel</span><span class="p">[[</span><span class="s">&quot;x.scale&quot;</span><span class="p">]][[</span><span class="s">&quot;scaled:center&quot;</span><span class="p">]],</span><span class="s">&quot;names&quot;</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">colnames</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">]</span>
<span class="n">mymodel</span><span class="p">[[</span><span class="s">&quot;x.scale&quot;</span><span class="p">]][[</span><span class="s">&quot;scaled:scale&quot;</span><span class="p">]]</span><span class="o">&lt;-</span><span class="n">training_set_sd</span>
<span class="nf">attr</span><span class="p">(</span><span class="n">mymodel</span><span class="p">[[</span><span class="s">&quot;x.scale&quot;</span><span class="p">]][[</span><span class="s">&quot;scaled:scale&quot;</span><span class="p">]],</span><span class="s">&quot;names&quot;</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">colnames</span><span class="p">(</span><span class="n">SVM_data_sel</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">]</span>

<span class="nf">summary</span><span class="p">(</span><span class="n">mymodel</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">mymodel</span><span class="p">)</span>
<span class="nf">save</span><span class="p">(</span><span class="n">mymodel</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_SVM_model.RData&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="c1">#&quot;my-svm.RData&quot;</span>
<span class="nf">saveRDS</span><span class="p">(</span><span class="n">mymodel</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_SVM_model.rds&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="c1">#&quot;my-svm.rds&quot;</span>
<span class="nf">write.svm</span><span class="p">(</span><span class="n">mymodel</span><span class="p">,</span><span class="n">scale.file</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_SVM_model.scale&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">yscale.file</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_SVM_model.yscale&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">mymodel</span><span class="p">,</span><span class="n">test_set</span><span class="p">,</span><span class="n">probability</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">decision.values</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

<span class="c1">#Visualize the prediction effect of the model</span>
<span class="n">plot_confusion_matrix</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
<span class="nf">geom_confmat</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">test_set</span><span class="o">$</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">),</span>
                        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">text.perc</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Reference&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;Prediction&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_gradient2</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="s">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="s">&quot;#ec2f2f&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_bw</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">plot.margin</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> <span class="s">&quot;cm&quot;</span><span class="p">))</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_best_test_confusion_matrix.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">plot_confusion_matrix</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="c1">#get attr</span>
<span class="n">pred.decision.values</span><span class="o">&lt;-</span><span class="nf">as.vector</span><span class="p">(</span><span class="nf">attr</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="s">&quot;decision.values&quot;</span><span class="p">))</span>
<span class="n">pred.probabilities</span><span class="o">&lt;-</span><span class="nf">attr</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="s">&quot;probabilities&quot;</span><span class="p">)</span>
<span class="n">pred.probabilities</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">pred.probabilities</span><span class="p">)</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_SVM_roc_test_data_plot.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">svm_roc_test</span><span class="o">&lt;-</span><span class="nf">roc</span><span class="p">(</span><span class="n">main</span><span class="o">=</span><span class="s">&quot;Test Data ROC&quot;</span><span class="p">,</span><span class="n">test_set</span><span class="o">$</span><span class="n">class</span><span class="p">,</span><span class="n">pred.probabilities</span><span class="o">$</span><span class="n">psi</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span><span class="o">=</span><span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;non-psi&quot;</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">),</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">auc</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="c1">#add attr to SVM_test_data</span>
<span class="n">SVM_test_data</span><span class="o">&lt;-</span><span class="n">test_set_origin</span>
<span class="n">SVM_test_data</span><span class="o">$</span><span class="n">pred.decision.values</span><span class="o">&lt;-</span><span class="n">pred.decision.values</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">svm_roc_test</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">SVM_test_data</span><span class="o">$</span><span class="n">svm_test_prob_class</span><span class="o">&lt;-</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">pred.probabilities</span><span class="o">$</span><span class="n">psi</span><span class="o">&gt;</span><span class="nf">coords</span><span class="p">(</span><span class="n">svm_roc_test</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="s">&quot;psi&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">SVM_test_data</span><span class="o">&lt;-</span><span class="nf">cbind</span><span class="p">(</span><span class="n">SVM_test_data</span><span class="p">,</span><span class="n">pred.probabilities</span><span class="p">,</span><span class="n">pred</span><span class="p">)</span>
<span class="nf">write.xlsx</span><span class="p">(</span><span class="n">SVM_test_data</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_SVM_test_data.xlsx&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">overwrite</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="c1">#output model info</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================tune best model confusion matrix (for modeling)=====================\n&quot;</span><span class="p">)</span>
<span class="n">tab</span> <span class="o">&lt;-</span> <span class="nf">table</span><span class="p">(</span><span class="n">Predicted</span> <span class="o">=</span> <span class="n">pred</span><span class="p">,</span><span class="n">Actual</span> <span class="o">=</span> <span class="n">test_set</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
<span class="n">tab</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;tune best model error rate (for modeling): &quot;</span><span class="p">,</span><span class="m">1</span><span class="o">-</span><span class="nf">sum</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;tune best model correct rate (for modeling): &quot;</span><span class="p">,</span><span class="nf">sum</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>

<span class="c1">#calculate evaluation indicators</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Calculate evaluation indicators=====================\n&quot;</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
<span class="n">SVM_TP</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="o">&amp;</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span><span class="c1">#True Positives (TP)</span>
<span class="n">SVM_FP</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="o">&amp;</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="o">==</span><span class="s">&quot;non-psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span><span class="c1">#False Positives (FP)</span>
<span class="n">SVM_TN</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="o">==</span><span class="s">&quot;non-psi&quot;</span><span class="o">&amp;</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="o">==</span><span class="s">&quot;non-psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span><span class="c1">#True Negatives (TN)</span>
<span class="n">SVM_FN</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="o">==</span><span class="s">&quot;non-psi&quot;</span><span class="o">&amp;</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span><span class="c1">#False Negatives (FN)</span>
<span class="n">SVM_TPR</span> <span class="o">&lt;-</span> <span class="n">SVM_TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">SVM_TP</span> <span class="o">+</span> <span class="n">SVM_FN</span><span class="p">)</span><span class="c1">#sensitivity (true positive rate, TPR)</span>
<span class="n">SVM_TNR</span> <span class="o">&lt;-</span> <span class="n">SVM_TN</span> <span class="o">/</span> <span class="p">(</span><span class="n">SVM_TN</span> <span class="o">+</span> <span class="n">SVM_FP</span><span class="p">)</span><span class="c1">#specifity (selectivity or true negative rate, TNR)</span>
<span class="n">SVM_FPR</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">-</span><span class="n">SVM_TNR</span><span class="c1">#False Positive Rate (FPR) (1 - specificit = FP/​N = FP/(TN + FP), FPR)</span>
<span class="n">SVM_FNR</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">-</span><span class="n">SVM_TPR</span><span class="c1">#False Negative Rate, FNR)</span>
<span class="n">SVM_Prec</span> <span class="o">&lt;-</span> <span class="n">SVM_TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">SVM_TP</span> <span class="o">+</span> <span class="n">SVM_FP</span><span class="p">)</span><span class="c1">#Precision</span>
<span class="n">SVM_Recall</span> <span class="o">&lt;-</span> <span class="n">SVM_TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">SVM_TP</span> <span class="o">+</span> <span class="n">SVM_FN</span><span class="p">)</span><span class="c1">#Recall</span>
<span class="n">SVM_ACC</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">SVM_TP</span> <span class="o">+</span> <span class="n">SVM_TN</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">SVM_TP</span> <span class="o">+</span> <span class="n">SVM_TN</span> <span class="o">+</span> <span class="n">SVM_FP</span> <span class="o">+</span> <span class="n">SVM_FN</span><span class="p">)</span><span class="c1">#accuracy</span>
<span class="n">SVM_F1_score</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">SVM_Recall</span><span class="o">*</span><span class="n">SVM_Prec</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">SVM_Recall</span> <span class="o">+</span> <span class="n">SVM_Prec</span><span class="p">)</span><span class="c1">#F1_score</span>
<span class="n">eval</span><span class="o">&lt;-</span><span class="nf">cbind</span><span class="p">(</span><span class="n">SVM_TP</span><span class="p">,</span><span class="n">SVM_FP</span><span class="p">,</span><span class="n">SVM_TN</span><span class="p">,</span><span class="n">SVM_FN</span><span class="p">,</span><span class="n">SVM_TPR</span><span class="p">,</span><span class="n">SVM_TNR</span><span class="p">,</span><span class="n">SVM_FPR</span><span class="p">,</span><span class="n">SVM_FNR</span><span class="p">,</span><span class="n">SVM_Prec</span><span class="p">,</span><span class="n">SVM_Recall</span><span class="p">,</span><span class="n">SVM_ACC</span><span class="p">,</span><span class="n">SVM_F1_score</span><span class="p">)</span>
<span class="n">eval</span><span class="o">&lt;-</span><span class="nf">round</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="n">eval</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_SVM_eval.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="c1">#show svm evaluation as pdf table</span>
<span class="n">svm_eval_t_df</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">eval</span><span class="p">)))</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">svm_eval_t_df</span><span class="p">)</span><span class="o">&lt;-</span><span class="s">&quot;value_or_percentage&quot;</span>
<span class="n">tt3</span> <span class="o">&lt;-</span> <span class="nf">ttheme_minimal</span><span class="p">(</span>
  <span class="n">core</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">bg_params</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">blues9</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="kc">NA</span><span class="p">),</span>
            <span class="n">fg_params</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">fontface</span><span class="o">=</span><span class="m">3</span><span class="p">)),</span>
  <span class="n">colhead</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">fg_params</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;navyblue&quot;</span><span class="p">,</span> <span class="n">fontface</span><span class="o">=</span><span class="m">4L</span><span class="p">)),</span>
  <span class="n">rowhead</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">fg_params</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="n">fontface</span><span class="o">=</span><span class="m">3L</span><span class="p">)))</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_evaluation.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">7</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">7</span><span class="p">)</span> <span class="c1"># Open a new pdf file</span>
<span class="nf">grid.arrange</span><span class="p">(</span>
  <span class="nf">tableGrob</span><span class="p">(</span><span class="n">svm_eval_t_df</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="n">tt3</span><span class="p">),</span>
  <span class="n">nrow</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span> <span class="c1"># Close the file</span>

<span class="c1">#filt by svm best model</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Filt by svm best model=====================\n&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;below is your input data ready to be predicted...\n&quot;</span><span class="p">)</span>
<span class="c1"># get prediction</span>
<span class="n">to_pred</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">filtfile</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">to_pred</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="c1">#1</span>
  <span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="c1">#2</span>
  <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="c1">#3</span>
  <span class="s">&quot;name&quot;</span><span class="p">,</span><span class="c1">#4</span>
  <span class="s">&quot;foldChange&quot;</span><span class="p">,</span><span class="c1">#5</span>
  <span class="s">&quot;strand&quot;</span><span class="p">,</span><span class="c1">#6</span>
  <span class="s">&quot;geneName&quot;</span><span class="p">,</span><span class="c1">#7</span>
  <span class="s">&quot;geneStart&quot;</span><span class="p">,</span><span class="c1">#8</span>
  <span class="s">&quot;geneEnd&quot;</span><span class="p">,</span><span class="c1">#9</span>
  <span class="s">&quot;base&quot;</span><span class="p">,</span><span class="c1">#10</span>
  <span class="s">&quot;treatPval&quot;</span><span class="p">,</span><span class="c1">#11</span>
  <span class="s">&quot;ctrlPval&quot;</span><span class="p">,</span><span class="c1">#12</span>
  <span class="s">&quot;minusPval&quot;</span><span class="p">,</span><span class="c1">#13</span>
  <span class="s">&quot;treatStopNum&quot;</span><span class="p">,</span><span class="c1">#14</span>
  <span class="s">&quot;treatStopRPM&quot;</span><span class="p">,</span><span class="c1">#15</span>
  <span class="s">&quot;treatPreStopNum&quot;</span><span class="p">,</span><span class="c1">#16</span>
  <span class="s">&quot;treatAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#17</span>
  <span class="s">&quot;treatReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#18</span>
  <span class="s">&quot;ctrlStopNum&quot;</span><span class="p">,</span><span class="c1">#19</span>
  <span class="s">&quot;ctrlStopRPM&quot;</span><span class="p">,</span><span class="c1">#20</span>
  <span class="s">&quot;ctrlPreStopNum&quot;</span><span class="p">,</span><span class="c1">#21</span>
  <span class="s">&quot;ctrlAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#22</span>
  <span class="s">&quot;ctrlReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#23</span>
  <span class="s">&quot;stopRpmFC&quot;</span><span class="p">,</span><span class="c1">#24</span>
  <span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#25</span>
  <span class="s">&quot;ctrlPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#26</span>
  <span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#27</span>
  <span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#28</span>
  <span class="s">&quot;ctrlAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#29</span>
  <span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#30</span>
  <span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="c1">#31</span>
  <span class="s">&quot;ctrlStopRatio&quot;</span><span class="p">,</span><span class="c1">#32</span>
  <span class="s">&quot;stopRatioFC&quot;</span><span class="p">,</span><span class="c1">#33</span>
  <span class="s">&quot;treatStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#34</span>
  <span class="s">&quot;treatStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#35</span>
  <span class="s">&quot;ctrlStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#36</span>
  <span class="s">&quot;ctrlStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#37</span>
  <span class="s">&quot;treatStopMeanFoldRatio&quot;</span><span class="p">,</span><span class="c1">#38</span>
  <span class="s">&quot;extendSeq&quot;</span><span class="p">)</span><span class="c1">#39</span>
<span class="n">to_pred</span><span class="o">$</span><span class="n">base</span><span class="o">&lt;-</span><span class="s">&quot;T&quot;</span>
<span class="n">to_pred_var</span><span class="o">&lt;-</span><span class="n">to_pred</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span><span class="n">preRpmFoldRatio</span><span class="p">,</span><span class="n">treatAfterRpmFold</span><span class="p">,</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">stopRatioFC</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">to_pred_var</span><span class="p">)</span>

<span class="c1">#get prediction</span>
<span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">mymodel</span><span class="p">,</span><span class="n">to_pred_var</span><span class="p">,</span><span class="n">decision.values</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">probability</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

<span class="c1">#get attr</span>
<span class="n">pred.decision.values</span><span class="o">&lt;-</span><span class="nf">as.vector</span><span class="p">(</span><span class="nf">attr</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="s">&quot;decision.values&quot;</span><span class="p">))</span>
<span class="n">pred.probabilities</span><span class="o">&lt;-</span><span class="nf">attr</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="s">&quot;probabilities&quot;</span><span class="p">)</span>
<span class="n">pred.probabilities</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">pred.probabilities</span><span class="p">)</span>

<span class="c1">#add attr to SVM_pred_data</span>
<span class="n">SVM_pred_data</span><span class="o">&lt;-</span><span class="n">to_pred</span>
<span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">pred.decision.values</span><span class="o">&lt;-</span><span class="n">pred.decision.values</span>
<span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">svm_pred_desc_class</span><span class="o">&lt;-</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">pred.decision.values</span><span class="o">&gt;</span><span class="m">0</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">SVM_pred_data</span><span class="o">&lt;-</span><span class="nf">cbind</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="p">,</span><span class="n">pred.probabilities</span><span class="p">,</span><span class="n">pred</span><span class="p">)</span>
<span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">svm_pred_prob_class</span><span class="o">&lt;-</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">psi</span><span class="o">&gt;=</span><span class="m">0.5</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">svm_pred_prob_class</span><span class="p">)</span>
<span class="nf">write.xlsx</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_total_prediction.xlsx&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">overwrite</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_total_prediction.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_total_prediction.bed&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="c1">#read hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed evidence</span>
<span class="n">evidence</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span><span class="c1">#&quot;hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed&quot;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="s">&quot;rRNA_anno&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">,</span><span class="s">&quot;strand&quot;</span><span class="p">)</span>
<span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>

<span class="c1">#read hg38.psiU.SingleSites.bed</span>
<span class="n">evidence2</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">rRNAfile2</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span><span class="c1">#&quot;hg38.psiU.SingleSites.bed&quot;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">evidence2</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="s">&quot;rRNA_anno&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">,</span><span class="s">&quot;strand&quot;</span><span class="p">)</span>
<span class="n">evidence2</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>

<span class="c1">#known_data miss/hit hg38_human_chr21_rRNA_known_pseudoU_SingleSites</span>
<span class="n">SVM_data</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">SVM_data</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">SVM_data</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">SVM_data</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">SVM_data</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">SVM_data_evidence</span><span class="o">&lt;-</span><span class="n">SVM_data</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">SVM_data_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">SVM_data_no_evidence</span><span class="o">&lt;-</span><span class="n">evidence</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">SVM_data</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">class</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">SVM_data_no_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">SVM_data_evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;rtsSeeker recover (hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>

<span class="c1">#known_data miss/hit hg38.psiU.SingleSites.bed</span>
<span class="n">SVM_data</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">SVM_data</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">SVM_data</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">SVM_data</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">SVM_data</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">SVM_data_evidence2</span><span class="o">&lt;-</span><span class="n">SVM_data</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence2</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">SVM_data_evidence2</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38.psiU.SingleSites.bed_rtsSeeker_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">SVM_data_no_evidence2</span><span class="o">&lt;-</span><span class="n">evidence2</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">SVM_data</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">class</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">SVM_data_no_evidence2</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38.psiU.SingleSites.bed_rtsSeeker_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">SVM_data_evidence2</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence2</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;rtsSeeker recover (hg38.psiU.SingleSites.bed.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>

<span class="c1">#final_pred miss/hit</span>
<span class="n">final_pred</span><span class="o">&lt;-</span><span class="n">SVM_pred_data</span><span class="p">[</span><span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">svm_pred_prob_class</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="p">,]</span>
<span class="n">final_pred</span><span class="o">&lt;-</span><span class="n">final_pred</span><span class="p">[</span><span class="n">final_pred</span><span class="o">$</span><span class="n">foldChange</span><span class="o">&gt;</span><span class="m">2</span><span class="p">,]</span>
<span class="n">final_pred</span><span class="o">&lt;-</span><span class="n">final_pred</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">pred.decision.values</span><span class="p">))</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_psi_prediction.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_psi_prediction.bed&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="n">final_pred</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">final_pred_evidence</span><span class="o">&lt;-</span><span class="n">final_pred</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_svm_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">final_pred_no_evidence</span><span class="o">&lt;-</span><span class="n">evidence</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_no_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_svm_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;rtsSeeker+SVM recover (hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">svm_predict_totalRNA.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$#</span> -ne <span class="m">2</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s1">&#39;Usage: &#39;</span><span class="nv">$0</span> <span class="s1">&#39; input SVM_model&#39;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nv">input</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">SVM_model</span><span class="o">=</span><span class="nv">$2</span>

awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {if($1~/^chr[0-9|a-z|A-Z]*$/ &amp;&amp; $10==&quot;T&quot; &amp;&amp; $14&gt;10){print $0}}&#39;</span> <span class="nv">$input</span> &gt; <span class="si">${</span><span class="nv">input</span><span class="p">%.bed</span><span class="si">}</span>_svm_filt.bed
nohup Rscript <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/svm_predict_totalRNA.r -f <span class="si">${</span><span class="nv">input</span><span class="p">%.bed</span><span class="si">}</span>_svm_filt.bed -k <span class="nv">$SVM_model</span> -r <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38.psiU.SingleSites.bed  -o <span class="si">${</span><span class="nv">input</span><span class="p">%.bed</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">input</span><span class="p">%.bed</span><span class="si">}</span>.log
<span class="nb">wait</span>
cat <span class="si">${</span><span class="nv">input</span><span class="p">%.bed</span><span class="si">}</span>.log

<span class="nb">echo</span> <span class="s2">&quot;total RNA: SVM predict program is done!&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;total RNA: SVM predict result in </span><span class="k">$(</span>dirname <span class="si">${</span><span class="nv">input</span><span class="si">}</span><span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">svm_predict_totalRNA.r</span></code></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/env Rscript</span>

<span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;optparse&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;stringr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;reshape2&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;openxlsx&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;e1071&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;cowplot&quot;</span><span class="p">))</span>
<span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>

<span class="n">option_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-f&quot;</span><span class="p">,</span> <span class="s">&quot;--filtfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;filted file of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-k&quot;</span><span class="p">,</span> <span class="s">&quot;--svmmodelfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;svmmodelfile [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-r&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;rRNA of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-s&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile2&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;hg38.psiU.SingleSites.bed [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="s">&quot;--outfile_prefix&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;output file name [default= %default]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">)</span>
<span class="p">);</span>
<span class="n">opt_parser</span> <span class="o">=</span> <span class="nf">OptionParser</span><span class="p">(</span><span class="n">option_list</span><span class="o">=</span><span class="n">option_list</span><span class="p">);</span>
<span class="n">opt</span> <span class="o">=</span> <span class="nf">parse_args</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>

<span class="nf">if </span><span class="p">(</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">svmmodelfile</span><span class="p">)</span><span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile2</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span><span class="p">)</span> <span class="p">){</span>
  <span class="nf">print_help</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>
  <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;Please provide -f svmmodelfile, -k filtfile, -r rRNAfile, -s rRNAfile2, and -o outfile_prefix option&quot;</span><span class="p">,</span> <span class="n">call.</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">filtfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span>
<span class="n">svmmodelfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">svmmodelfile</span>
<span class="n">rRNAfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span>
<span class="n">rRNAfile2</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile2</span>
<span class="n">outFile_prefix</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span>

<span class="nf">print</span><span class="p">(</span><span class="n">filtfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">svmmodelfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile2</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">)</span>



<span class="c1"># mymodel&lt;-readRDS(file = svmmodelfile)#&quot;my-svm.RData&quot;</span>
<span class="nf">load</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">svmmodelfile</span><span class="p">)</span><span class="c1">#&quot;my-svm.RData&quot;</span>

<span class="c1">#filt by svm best model</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Filt by svm best model=====================\n&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;below is your input data ready to be predicted...\n&quot;</span><span class="p">)</span>
<span class="c1"># get prediction</span>
<span class="n">to_pred</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">filtfile</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">to_pred</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="c1">#1</span>
  <span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="c1">#2</span>
  <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="c1">#3</span>
  <span class="s">&quot;name&quot;</span><span class="p">,</span><span class="c1">#4</span>
  <span class="s">&quot;foldChange&quot;</span><span class="p">,</span><span class="c1">#5</span>
  <span class="s">&quot;strand&quot;</span><span class="p">,</span><span class="c1">#6</span>
  <span class="s">&quot;geneName&quot;</span><span class="p">,</span><span class="c1">#7</span>
  <span class="s">&quot;geneStart&quot;</span><span class="p">,</span><span class="c1">#8</span>
  <span class="s">&quot;geneEnd&quot;</span><span class="p">,</span><span class="c1">#9</span>
  <span class="s">&quot;base&quot;</span><span class="p">,</span><span class="c1">#10</span>
  <span class="s">&quot;treatPval&quot;</span><span class="p">,</span><span class="c1">#11</span>
  <span class="s">&quot;ctrlPval&quot;</span><span class="p">,</span><span class="c1">#12</span>
  <span class="s">&quot;minusPval&quot;</span><span class="p">,</span><span class="c1">#13</span>
  <span class="s">&quot;treatStopNum&quot;</span><span class="p">,</span><span class="c1">#14</span>
  <span class="s">&quot;treatStopRPM&quot;</span><span class="p">,</span><span class="c1">#15</span>
  <span class="s">&quot;treatPreStopNum&quot;</span><span class="p">,</span><span class="c1">#16</span>
  <span class="s">&quot;treatAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#17</span>
  <span class="s">&quot;treatReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#18</span>
  <span class="s">&quot;ctrlStopNum&quot;</span><span class="p">,</span><span class="c1">#19</span>
  <span class="s">&quot;ctrlStopRPM&quot;</span><span class="p">,</span><span class="c1">#20</span>
  <span class="s">&quot;ctrlPreStopNum&quot;</span><span class="p">,</span><span class="c1">#21</span>
  <span class="s">&quot;ctrlAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#22</span>
  <span class="s">&quot;ctrlReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#23</span>
  <span class="s">&quot;stopRpmFC&quot;</span><span class="p">,</span><span class="c1">#24</span>
  <span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#25</span>
  <span class="s">&quot;ctrlPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#26</span>
  <span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#27</span>
  <span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#28</span>
  <span class="s">&quot;ctrlAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#29</span>
  <span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#30</span>
  <span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="c1">#31</span>
  <span class="s">&quot;ctrlStopRatio&quot;</span><span class="p">,</span><span class="c1">#32</span>
  <span class="s">&quot;stopRatioFC&quot;</span><span class="p">,</span><span class="c1">#33</span>
  <span class="s">&quot;treatStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#34</span>
  <span class="s">&quot;treatStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#35</span>
  <span class="s">&quot;ctrlStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#36</span>
  <span class="s">&quot;ctrlStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#37</span>
  <span class="s">&quot;treatStopMeanFoldRatio&quot;</span><span class="p">,</span><span class="c1">#38</span>
  <span class="s">&quot;extendSeq&quot;</span><span class="p">)</span><span class="c1">#39</span>
<span class="n">to_pred</span><span class="o">$</span><span class="n">base</span><span class="o">&lt;-</span><span class="s">&quot;T&quot;</span>
<span class="n">to_pred_var</span><span class="o">&lt;-</span><span class="n">to_pred</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span> <span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="n">treatAfterRpmFold</span><span class="p">,</span> <span class="n">afterRpmFoldRatio</span><span class="p">,</span> <span class="n">treatStopRatio</span><span class="p">,</span> <span class="n">stopRatioFC</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">to_pred_var</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">mymodel</span><span class="p">,</span><span class="n">to_pred_var</span><span class="p">,</span><span class="n">decision.values</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">probability</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

<span class="c1">#get attr</span>
<span class="n">pred.decision.values</span><span class="o">&lt;-</span><span class="nf">as.vector</span><span class="p">(</span><span class="nf">attr</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="s">&quot;decision.values&quot;</span><span class="p">))</span>
<span class="n">pred.probabilities</span><span class="o">&lt;-</span><span class="nf">attr</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="s">&quot;probabilities&quot;</span><span class="p">)</span>
<span class="n">pred.probabilities</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">pred.probabilities</span><span class="p">)</span>

<span class="c1">#add attr to SVM_pred_data</span>
<span class="n">SVM_pred_data</span><span class="o">&lt;-</span><span class="n">to_pred</span>
<span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">pred.decision.values</span><span class="o">&lt;-</span><span class="n">pred.decision.values</span>
<span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">svm_pred_desc_class</span><span class="o">&lt;-</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">pred.decision.values</span><span class="o">&gt;</span><span class="m">0</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">SVM_pred_data</span><span class="o">&lt;-</span><span class="nf">cbind</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="p">,</span><span class="n">pred.probabilities</span><span class="p">,</span><span class="n">pred</span><span class="p">)</span>
<span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">svm_pred_prob_class</span><span class="o">&lt;-</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">psi</span><span class="o">&gt;=</span><span class="m">0.5</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;Psi predicted by SVM model:&quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">svm_pred_prob_class</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;Psi predicted by SVM model and fold change (stopRatioFC) &gt;2:&quot;</span><span class="p">)</span>
<span class="n">SVM_pred_data</span><span class="o">&lt;-</span><span class="n">SVM_pred_data</span><span class="p">[</span><span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">foldChange</span><span class="o">&gt;</span><span class="m">2</span><span class="p">,]</span>
<span class="nf">write.xlsx</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_total_prediction.xlsx&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">overwrite</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_total_prediction.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">SVM_pred_data</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_total_prediction.bed&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="c1">#read hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed evidence</span>
<span class="n">evidence</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span><span class="c1">#&quot;hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed&quot;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="s">&quot;rRNA_anno&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">,</span><span class="s">&quot;strand&quot;</span><span class="p">)</span>
<span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>

<span class="c1">#read hg38.psiU.SingleSites.bed</span>
<span class="n">evidence2</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">rRNAfile2</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span><span class="c1">#&quot;hg38.psiU.SingleSites.bed&quot;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">evidence2</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="s">&quot;rRNA_anno&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">,</span><span class="s">&quot;strand&quot;</span><span class="p">)</span>
<span class="n">evidence2</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>


<span class="n">final_pred</span><span class="o">&lt;-</span><span class="n">SVM_pred_data</span><span class="p">[</span><span class="n">SVM_pred_data</span><span class="o">$</span><span class="n">svm_pred_prob_class</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="p">,]</span>
<span class="n">final_pred</span><span class="o">&lt;-</span><span class="n">final_pred</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">pred.decision.values</span><span class="p">))</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_psi_prediction.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_svm_psi_prediction.bed&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="n">final_pred</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">final_pred_evidence</span><span class="o">&lt;-</span><span class="n">final_pred</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_svm_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">final_pred_no_evidence</span><span class="o">&lt;-</span><span class="n">evidence</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_no_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_svm_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;rtsSeeker+SVM recover (hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All user input will be recorded in a plain text file with suffixes <code class="docutils literal notranslate"><span class="pre">_svm_totalRNA_build.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">_svm_totalRNA_predict.txt</span></code> in psiFinder/config and help users to easily reload the previous config (by simply clicking <code class="docutils literal notranslate"><span class="pre">CONFIG</span></code> button).</p>
</div>
</section>
<section id="ann-artificial-neural-network">
<h3><a class="toc-backref" href="#id13">(2) ANN: Artificial Neural Network</a><a class="headerlink" href="#ann-artificial-neural-network" title="Permalink to this heading">¶</a></h3>
<p>If <code class="docutils literal notranslate"><span class="pre">ANN</span></code> QT wideget is clicked and popouped:</p>
<ul class="simple">
<li><p>press <code class="docutils literal notranslate"><span class="pre">Build</span></code> buttor will run <code class="docutils literal notranslate"><span class="pre">ann.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">ann_build_totalRNA.r</span></code> to generate file with <code class="docutils literal notranslate"><span class="pre">_ANN_model.RData</span></code> suffix, which is the artifical neuralnet model (resilient backpropagation with weight backtracking, two layers, each 12 neuron).</p></li>
<li><p>press <code class="docutils literal notranslate"><span class="pre">PREDICT</span></code> buttor will run <code class="docutils literal notranslate"><span class="pre">ann_predict_totalRNA.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">ann_predict_totalRNA.r</span></code> to generate file with <code class="docutils literal notranslate"><span class="pre">_ann_psi_prediction.bed</span></code> suffix, which is the candidate Ψ-sites predicted by ANN algorithm.</p></li>
</ul>
<img alt="../_images/ANN.png" src="../_images/ANN.png" />
<p><code class="docutils literal notranslate"><span class="pre">ann.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$#</span> -ne <span class="m">4</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s1">&#39;Usage: &#39;</span><span class="nv">$0</span> <span class="s1">&#39; input.bam treatment.bam genome.fa out.bed&#39;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nv">input</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">treatment</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">genome</span><span class="o">=</span><span class="nv">$3</span>
<span class="nv">out</span><span class="o">=</span><span class="nv">$4</span>
<span class="nv">outFileName</span><span class="o">=</span><span class="si">${</span><span class="nv">out</span><span class="p">%.bed</span><span class="si">}</span>

<span class="nb">echo</span> <span class="s2">&quot;rtsSeeker ANN mode: rtsSeeker start...&quot;</span>
<span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&quot;</span><span class="si">${</span><span class="nv">genome</span><span class="si">}</span><span class="s2">.fai&quot;</span>  <span class="o">]</span>
<span class="k">then</span>
<span class="nb">echo</span> <span class="s2">&quot;generate faifile&quot;</span>
samtools faidx <span class="nv">$genome</span>
<span class="k">else</span>
<span class="nb">echo</span> <span class="s2">&quot;faifile exist&quot;</span>
<span class="k">fi</span>

<span class="nb">echo</span> <span class="s2">&quot;</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">/rtsSeeker --fa </span><span class="nv">$genome</span><span class="s2"> --fai </span><span class="si">${</span><span class="nv">genome</span><span class="si">}</span><span class="s2">.fai --treat </span><span class="nv">$treatment</span><span class="s2"> --input </span><span class="nv">$input</span><span class="s2"> -p 1.5 -t 5 -r 0.05 -M 1 --gene </span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">/hg38.gencode.v30.tRNA.refseqNcRNA.geneAnno.bed12 -f 1 -m 0 -s -w 20 -o </span><span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span><span class="s2">_ann_all.bed 2&gt;</span><span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span><span class="s2">_ann_all_rtsSeeker.log&quot;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_all_rtsSeeker.cmd <span class="c1"># no -c remove duplicate</span>
<span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/rtsSeeker --fa <span class="nv">$genome</span> --fai <span class="si">${</span><span class="nv">genome</span><span class="si">}</span>.fai --treat <span class="nv">$treatment</span> --input <span class="nv">$input</span> -p <span class="m">1</span>.5 -t <span class="m">5</span> -r <span class="m">0</span>.05 -M <span class="m">1</span> --gene <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38.gencode.v30.tRNA.refseqNcRNA.geneAnno.bed12 -f <span class="m">1</span> -m <span class="m">0</span> -s -w <span class="m">20</span> -o <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_all.bed <span class="m">2</span>&gt;<span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_all_rtsSeeker.log <span class="c1"># no -c remove duplicate</span>
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_all.bed &gt; <span class="nv">$out</span>

awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {if($1~/^chr[0-9|a-z|A-Z]*$/ &amp;&amp; $10==&quot;T&quot; &amp;&amp; $14&gt;10){print $0}}&#39;</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_all.bed &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_filt_totalRNA.bed
bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_filt_totalRNA.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.bed
bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_filt_totalRNA.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/rrna_chr21.bed -s &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_rrna.bed
bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_rrna.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s -v &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.bed
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.bed <span class="p">|</span>awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {print $0,&quot;1&quot;}&#39;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.txt
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.bed <span class="p">|</span>awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {print $0,&quot;0&quot;}&#39;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.txt
<span class="nb">echo</span> <span class="s2">&quot;getting roc_plot.txt&quot;</span>
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.txt <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.txt &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_plot.txt

nohup Rscript <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/ann_build_totalRNA.r -f <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_plot.txt -k <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_filt_totalRNA.bed -r <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38.psiU.SingleSites.bed  -o <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_evaluation_totalRNA.log <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
<span class="nb">wait</span>

cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_evaluation_totalRNA.log
mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_six_variables_rRNA_violinplot.pdf <span class="p">&amp;</span>&gt; /dev/null
mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_roc_test_data_plot.pdf <span class="p">&amp;</span>&gt; /dev/null
mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_evaluation.pdf <span class="p">&amp;</span>&gt; /dev/null

<span class="nb">echo</span> <span class="s2">&quot;total RNA: ann program is done!&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;total RNA: ann result in </span><span class="k">$(</span>dirname <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_ann_psi_prediction.bed<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ann_build_totalRNA.r</span></code></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/env Rscript</span>

<span class="nf">options</span><span class="p">(</span><span class="n">warn</span> <span class="o">=</span> <span class="m">-1</span><span class="p">)</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;optparse&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;devtools&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;caTools&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;neuralnet&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;NeuralNetTools&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;stringr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;gridExtra&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;cowplot&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;pROC&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggplot2&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggpol&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggpubr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;RColorBrewer&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;openxlsx&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;reshape2&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;factoextra&quot;</span><span class="p">))</span>

<span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>

<span class="n">option_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-f&quot;</span><span class="p">,</span> <span class="s">&quot;--annfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;ROC of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-k&quot;</span><span class="p">,</span> <span class="s">&quot;--filtfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;filted file of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-r&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;rRNA of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-s&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile2&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;hg38.psiU.SingleSites.bed [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="s">&quot;--outfile_prefix&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;output file name [default= %default]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">)</span>
<span class="p">);</span>
<span class="n">opt_parser</span> <span class="o">=</span> <span class="nf">OptionParser</span><span class="p">(</span><span class="n">option_list</span><span class="o">=</span><span class="n">option_list</span><span class="p">);</span>
<span class="n">opt</span> <span class="o">=</span> <span class="nf">parse_args</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>

<span class="nf">if </span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">annfile</span><span class="p">)</span><span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile2</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span><span class="p">)</span> <span class="p">){</span>
  <span class="nf">print_help</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>
  <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;Please provide -f annfile, -k filtfile, -r rRNAfile, -s rRNAfile2, and -o outfile_prefix option&quot;</span><span class="p">,</span> <span class="n">call.</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">annfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">annfile</span>
<span class="n">filtfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span>
<span class="n">rRNAfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span>
<span class="n">rRNAfile2</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile2</span>
<span class="n">outFile_prefix</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span>

<span class="nf">print</span><span class="p">(</span><span class="n">annfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">filtfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile2</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">)</span>


<span class="c1">#load data</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Load data to perform classification model (factor as input)=====================\n&quot;</span><span class="p">)</span>
<span class="n">ann_data</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">annfile</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">ann_data</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="c1">#1</span>
  <span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="c1">#2</span>
  <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="c1">#3</span>
  <span class="s">&quot;name&quot;</span><span class="p">,</span><span class="c1">#4</span>
  <span class="s">&quot;foldChange&quot;</span><span class="p">,</span><span class="c1">#5</span>
  <span class="s">&quot;strand&quot;</span><span class="p">,</span><span class="c1">#6</span>
  <span class="s">&quot;geneName&quot;</span><span class="p">,</span><span class="c1">#7</span>
  <span class="s">&quot;geneStart&quot;</span><span class="p">,</span><span class="c1">#8</span>
  <span class="s">&quot;geneEnd&quot;</span><span class="p">,</span><span class="c1">#9</span>
  <span class="s">&quot;base&quot;</span><span class="p">,</span><span class="c1">#10</span>
  <span class="s">&quot;treatPval&quot;</span><span class="p">,</span><span class="c1">#11</span>
  <span class="s">&quot;ctrlPval&quot;</span><span class="p">,</span><span class="c1">#12</span>
  <span class="s">&quot;minusPval&quot;</span><span class="p">,</span><span class="c1">#13</span>
  <span class="s">&quot;treatStopNum&quot;</span><span class="p">,</span><span class="c1">#14</span>
  <span class="s">&quot;treatStopRPM&quot;</span><span class="p">,</span><span class="c1">#15</span>
  <span class="s">&quot;treatPreStopNum&quot;</span><span class="p">,</span><span class="c1">#16</span>
  <span class="s">&quot;treatAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#17</span>
  <span class="s">&quot;treatReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#18</span>
  <span class="s">&quot;ctrlStopNum&quot;</span><span class="p">,</span><span class="c1">#19</span>
  <span class="s">&quot;ctrlStopRPM&quot;</span><span class="p">,</span><span class="c1">#20</span>
  <span class="s">&quot;ctrlPreStopNum&quot;</span><span class="p">,</span><span class="c1">#21</span>
  <span class="s">&quot;ctrlAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#22</span>
  <span class="s">&quot;ctrlReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#23</span>
  <span class="s">&quot;stopRpmFC&quot;</span><span class="p">,</span><span class="c1">#24</span>
  <span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#25 *</span>
  <span class="s">&quot;ctrlPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#26</span>
  <span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#27 *</span>
  <span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#28 *</span>
  <span class="s">&quot;ctrlAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#29</span>
  <span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#30 *</span>
  <span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="c1">#31 *</span>
  <span class="s">&quot;ctrlStopRatio&quot;</span><span class="p">,</span><span class="c1">#32</span>
  <span class="s">&quot;stopRatioFC&quot;</span><span class="p">,</span><span class="c1">#33 *</span>
  <span class="s">&quot;treatStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#34</span>
  <span class="s">&quot;treatStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#35</span>
  <span class="s">&quot;ctrlStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#36</span>
  <span class="s">&quot;ctrlStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#37</span>
  <span class="s">&quot;treatStopMeanFoldRatio&quot;</span><span class="p">,</span><span class="c1">#38</span>
  <span class="s">&quot;extendSeq&quot;</span><span class="p">,</span><span class="c1">#39</span>
  <span class="s">&quot;class&quot;</span><span class="p">)</span><span class="c1">#40</span>
<span class="n">ann_data</span><span class="o">$</span><span class="n">base</span><span class="o">&lt;-</span><span class="s">&quot;T&quot;</span>

<span class="c1">#rRNA-psi-non_psi visualization</span>
<span class="n">ann_data_sel</span><span class="o">&lt;-</span><span class="n">ann_data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span><span class="n">preRpmFoldRatio</span><span class="p">,</span><span class="n">treatAfterRpmFold</span><span class="p">,</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">stopRatioFC</span><span class="p">,</span><span class="n">class</span><span class="p">)</span>
<span class="n">ann_data_melt</span><span class="o">&lt;-</span><span class="nf">melt</span><span class="p">(</span><span class="n">ann_data_sel</span><span class="p">,</span><span class="n">id.vars</span> <span class="o">=</span> <span class="s">&quot;class&quot;</span><span class="p">)</span>
<span class="n">ann_data_melt</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">ann_data_melt</span><span class="o">$</span><span class="n">class</span><span class="p">),</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="s">&quot;non_psi&quot;</span><span class="p">)</span>
<span class="n">ann_data_melt</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">ann_data_melt</span><span class="o">$</span><span class="n">class</span><span class="p">),</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">)</span>

<span class="n">data_summary</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">m</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">ymin</span> <span class="o">&lt;-</span> <span class="n">m</span><span class="o">-</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">ymax</span> <span class="o">&lt;-</span> <span class="n">m</span><span class="o">+</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="nf">return</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">m</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">my_comparisons</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;non_psi&quot;</span><span class="p">,</span> <span class="s">&quot;psi&quot;</span><span class="p">)</span> <span class="p">)</span>

<span class="c1">#treatPreRpmFold</span>
<span class="n">treatPreRpmFold</span><span class="o">&lt;-</span><span class="n">ann_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatPreRpmFold$&quot;</span><span class="p">))</span>
<span class="n">treatPreRpmFold_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatPreRpmFold)&quot;</span><span class="p">)</span>
<span class="n">treatPreRpmFold_bp</span><span class="o">&lt;-</span><span class="n">treatPreRpmFold_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#treatAfterRpmFold</span>
<span class="n">treatAfterRpmFold</span><span class="o">&lt;-</span><span class="n">ann_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatAfterRpmFold$&quot;</span><span class="p">))</span>
<span class="n">treatAfterRpmFold_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatAfterRpmFold)&quot;</span><span class="p">)</span>
<span class="n">treatAfterRpmFold_bp</span><span class="o">&lt;-</span><span class="n">treatAfterRpmFold_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#preRpmFoldRatio</span>
<span class="n">preRpmFoldRatio</span><span class="o">&lt;-</span><span class="n">ann_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^preRpmFoldRatio$&quot;</span><span class="p">))</span>
<span class="n">preRpmFoldRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(preRpmFoldRatio)&quot;</span><span class="p">)</span>
<span class="n">preRpmFoldRatio_bp</span><span class="o">&lt;-</span><span class="n">preRpmFoldRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#afterRpmFoldRatio</span>
<span class="n">afterRpmFoldRatio</span><span class="o">&lt;-</span><span class="n">ann_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^afterRpmFoldRatio$&quot;</span><span class="p">))</span>
<span class="n">afterRpmFoldRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(afterRpmFoldRatio)&quot;</span><span class="p">)</span>
<span class="n">afterRpmFoldRatio_bp</span><span class="o">&lt;-</span><span class="n">afterRpmFoldRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#treatStopRatio</span>
<span class="n">treatStopRatio</span><span class="o">&lt;-</span><span class="n">ann_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatStopRatio$&quot;</span><span class="p">))</span>
<span class="n">treatStopRatio</span><span class="o">&lt;-</span><span class="n">treatStopRatio</span><span class="p">[</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="o">!=</span><span class="m">0</span><span class="p">,]</span>
<span class="n">treatStopRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatStopRatio)&quot;</span><span class="p">)</span>
<span class="n">treatStopRatio_bp</span><span class="o">&lt;-</span><span class="n">treatStopRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="n">stopRatioFC</span><span class="o">&lt;-</span><span class="n">ann_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^stopRatioFC$&quot;</span><span class="p">))</span>
<span class="n">stopRatioFC_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(stopRatioFC)&quot;</span><span class="p">)</span>
<span class="n">stopRatioFC_bp</span><span class="o">&lt;-</span><span class="n">stopRatioFC_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_six_variables_rRNA_violinplot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">6</span><span class="p">)</span>
<span class="nf">plot_grid</span><span class="p">(</span>
  <span class="n">treatPreRpmFold_bp</span><span class="p">,</span>
  <span class="n">preRpmFoldRatio_bp</span><span class="p">,</span>
  <span class="n">treatAfterRpmFold_bp</span><span class="p">,</span>
  <span class="n">afterRpmFoldRatio_bp</span><span class="p">,</span>
  <span class="n">treatStopRatio_bp</span><span class="p">,</span>
  <span class="n">stopRatioFC_bp</span><span class="p">,</span>
  <span class="n">align</span> <span class="o">=</span> <span class="s">&quot;hv&quot;</span><span class="p">,</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">,</span><span class="s">&#39;E&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="n">ann_data_sel</span><span class="o">&lt;-</span><span class="n">ann_data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span><span class="n">preRpmFoldRatio</span><span class="p">,</span><span class="n">treatAfterRpmFold</span><span class="p">,</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">stopRatioFC</span><span class="p">,</span><span class="n">class</span><span class="p">)</span>
<span class="nf">rownames</span><span class="p">(</span><span class="n">ann_data_sel</span><span class="p">)</span><span class="o">&lt;-</span><span class="n">ann_data</span><span class="o">$</span><span class="n">name</span>
<span class="n">cpm.of.diff.gene</span> <span class="o">&lt;-</span> <span class="nf">t</span><span class="p">(</span><span class="n">ann_data_sel</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">class</span><span class="p">))</span>
<span class="n">pca</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">cpm.of.diff.gene</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">fviz_eig</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span><span class="n">addlabels</span> <span class="o">=</span> <span class="bp">T</span><span class="p">)</span>
<span class="n">group.list</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="s">&quot;stopRatioFC&quot;</span><span class="p">)</span>
<span class="n">group.list</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">group.list</span><span class="p">)</span>
<span class="nf">fviz_pca_ind</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span> <span class="n">geom.ind</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;point&quot;</span><span class="p">),</span> <span class="n">col.ind</span> <span class="o">=</span> <span class="n">group.list</span><span class="p">,</span>
             <span class="n">palette</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">3</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">4</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">5</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">7</span><span class="p">]),</span>
             <span class="n">legend.title</span> <span class="o">=</span> <span class="s">&quot;Groups&quot;</span><span class="p">)</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_pca.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>

<span class="n">ann_data_sel</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">str_replace_all</span><span class="p">(</span><span class="n">ann_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">,</span> <span class="s">&quot;non_psi&quot;</span><span class="p">)</span>
<span class="n">ann_data_sel</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">str_replace_all</span><span class="p">(</span><span class="n">ann_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;psi&quot;</span><span class="p">)</span>
<span class="c1">#Encoding the target feature as factor</span>
<span class="n">ann_data_sel</span><span class="o">$</span><span class="n">class</span><span class="o">&lt;-</span><span class="nf">as.factor</span><span class="p">(</span><span class="n">ann_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;total classification: &quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">ann_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>

<span class="c1"># Splitting the dataset into the Training set and Test set</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">ann_data_sel</span><span class="o">$</span><span class="n">psi</span> <span class="o">&lt;-</span> <span class="n">ann_data_sel</span><span class="o">$</span><span class="n">class</span> <span class="o">==</span> <span class="s">&quot;psi&quot;</span>
<span class="n">ann_data_sel</span><span class="o">$</span><span class="n">non_psi</span> <span class="o">&lt;-</span> <span class="n">ann_data_sel</span><span class="o">$</span><span class="n">class</span> <span class="o">==</span> <span class="s">&quot;non_psi&quot;</span>
<span class="n">split</span> <span class="o">=</span> <span class="nf">sample.split</span><span class="p">(</span><span class="n">ann_data_sel</span><span class="o">$</span><span class="n">class</span><span class="p">,</span> <span class="n">SplitRatio</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span>
<span class="n">training_set</span> <span class="o">=</span> <span class="nf">subset</span><span class="p">(</span><span class="n">ann_data_sel</span><span class="p">,</span> <span class="n">split</span> <span class="o">==</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">test_set</span> <span class="o">=</span> <span class="nf">subset</span><span class="p">(</span><span class="n">ann_data_sel</span><span class="p">,</span> <span class="n">split</span> <span class="o">==</span> <span class="kc">FALSE</span><span class="p">)</span>

<span class="c1"># feature scaling</span>
<span class="n">training_set_mean</span> <span class="o">&lt;-</span> <span class="nf">apply</span><span class="p">(</span><span class="n">training_set</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">class</span><span class="p">,</span> <span class="o">-</span><span class="n">psi</span><span class="p">,</span> <span class="o">-</span><span class="n">non_psi</span><span class="p">),</span> <span class="m">2</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span>
<span class="n">training_set_sd</span> <span class="o">&lt;-</span> <span class="nf">apply</span><span class="p">(</span><span class="n">training_set</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">class</span><span class="p">,</span> <span class="o">-</span><span class="n">psi</span><span class="p">,</span> <span class="o">-</span><span class="n">non_psi</span><span class="p">),</span> <span class="m">2</span><span class="p">,</span> <span class="n">sd</span><span class="p">)</span>
<span class="n">training_set</span><span class="p">[,</span> <span class="nf">c</span><span class="p">(</span><span class="m">-7</span><span class="p">,</span> <span class="m">-8</span><span class="p">,</span> <span class="m">-9</span><span class="p">)]</span> <span class="o">=</span> <span class="nf">scale</span><span class="p">(</span><span class="n">training_set</span><span class="p">[,</span> <span class="nf">c</span><span class="p">(</span><span class="m">-7</span><span class="p">,</span> <span class="m">-8</span><span class="p">,</span> <span class="m">-9</span><span class="p">)],</span> <span class="n">center</span> <span class="o">=</span> <span class="n">training_set_mean</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">training_set_sd</span><span class="p">)</span>
<span class="n">test_set</span><span class="p">[,</span> <span class="nf">c</span><span class="p">(</span><span class="m">-7</span><span class="p">,</span> <span class="m">-8</span><span class="p">,</span> <span class="m">-9</span><span class="p">)]</span> <span class="o">=</span> <span class="nf">scale</span><span class="p">(</span><span class="n">test_set</span><span class="p">[,</span> <span class="nf">c</span><span class="p">(</span><span class="m">-7</span><span class="p">,</span> <span class="m">-8</span><span class="p">,</span> <span class="m">-9</span><span class="p">)],</span> <span class="n">center</span> <span class="o">=</span> <span class="n">training_set_mean</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">training_set_sd</span><span class="p">)</span>

<span class="n">training_set_origin</span> <span class="o">=</span> <span class="nf">subset</span><span class="p">(</span><span class="n">ann_data</span><span class="p">,</span> <span class="n">split</span> <span class="o">==</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">test_set_origin</span> <span class="o">=</span> <span class="nf">subset</span><span class="p">(</span><span class="n">ann_data</span><span class="p">,</span> <span class="n">split</span> <span class="o">==</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="s">&quot;training set classification using sample.split: &quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">training_set</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="s">&quot;test set classification using sample.split: &quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">test_set</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>

<span class="c1">#Network Aplication</span>
<span class="n">ann_data_sel.net</span> <span class="o">&lt;-</span> <span class="nf">neuralnet</span><span class="p">(</span><span class="n">psi</span> <span class="o">+</span> <span class="n">non_psi</span> <span class="o">~</span>
                      <span class="n">treatPreRpmFold</span> <span class="o">+</span> <span class="n">preRpmFoldRatio</span> <span class="o">+</span> <span class="n">treatAfterRpmFold</span> <span class="o">+</span> <span class="n">afterRpmFoldRatio</span> <span class="o">+</span> <span class="n">treatStopRatio</span> <span class="o">+</span> <span class="n">stopRatioFC</span><span class="p">,</span>
                      <span class="n">data</span> <span class="o">=</span> <span class="n">training_set</span><span class="p">,</span> <span class="n">hidden</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">),</span> <span class="n">rep</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">err.fct</span> <span class="o">=</span> <span class="s">&quot;ce&quot;</span><span class="p">,</span>
                      <span class="n">linear.output</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">lifesign</span> <span class="o">=</span> <span class="s">&quot;minimal&quot;</span><span class="p">,</span> <span class="n">stepmax</span> <span class="o">=</span> <span class="m">1000000</span><span class="p">,</span>
                      <span class="n">threshold</span> <span class="o">=</span> <span class="m">0.001</span><span class="p">)</span>

<span class="c1">#Get weights for a neural network in an organized list by extracting values from a neural network object</span>
<span class="nf">neuralweights</span><span class="p">(</span><span class="n">ann_data_sel.net</span><span class="p">)</span>

<span class="c1">#import the function from Github</span>
<span class="nf">source_url</span><span class="p">(</span><span class="s">&#39;https://gist.githubusercontent.com/fawda123/7471137/raw/466c1474d0a505ff044412703516c34f1a4684a5/nnet_plot_update.r&#39;</span><span class="p">)</span>
<span class="c1">#plot each model</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_nnet_train_data_plot.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span><span class="o">=</span><span class="m">16</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">8</span><span class="p">)</span>
<span class="nf">plot.nnet</span><span class="p">(</span><span class="n">ann_data_sel.net</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="c1">#Visualize the network structure of the fully connected model</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_best_train_data_plot.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">ann_data_sel.net</span><span class="p">,</span> <span class="n">rep</span> <span class="o">=</span> <span class="s">&quot;best&quot;</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="c1">#Visualize the prediction effect of the model</span>
<span class="n">mlppre</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">ann_data_sel.net</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">mlppre</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;psi&quot;</span><span class="p">,</span><span class="s">&quot;non_psi&quot;</span><span class="p">)</span>
<span class="n">mlpprelab</span> <span class="o">&lt;-</span> <span class="nf">apply</span><span class="p">(</span><span class="n">mlppre</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">which.max</span><span class="p">)</span>
<span class="n">mlpprelab</span><span class="o">&lt;-</span><span class="nf">sub</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">,</span><span class="nf">as.character</span><span class="p">(</span><span class="n">mlpprelab</span><span class="p">))</span>
<span class="n">mlpprelab</span><span class="o">&lt;-</span><span class="nf">sub</span><span class="p">(</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="s">&quot;non_psi&quot;</span><span class="p">,</span><span class="nf">as.character</span><span class="p">(</span><span class="n">mlpprelab</span><span class="p">))</span>
<span class="n">plot_confusion_matrix</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
<span class="nf">geom_confmat</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">test_set</span><span class="o">$</span><span class="n">class</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mlpprelab</span><span class="p">),</span>
                        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">text.perc</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&quot;Reference&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;Prediction&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_gradient2</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="s">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="s">&quot;#ec2f2f&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_bw</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">plot.margin</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> <span class="s">&quot;cm&quot;</span><span class="p">))</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_best_test_confusion_matrix.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">plot_confusion_matrix</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="c1"># Predicting Result</span>
<span class="n">ann_data_sel.prediction</span> <span class="o">&lt;-</span> <span class="n">neuralnet</span><span class="o">::</span><span class="nf">compute</span><span class="p">(</span><span class="n">ann_data_sel.net</span><span class="p">,</span> <span class="n">test_set</span><span class="p">[</span><span class="m">-7</span><span class="o">:</span><span class="m">-9</span><span class="p">])</span>
<span class="n">idx</span> <span class="o">&lt;-</span> <span class="nf">apply</span><span class="p">(</span><span class="n">ann_data_sel.prediction</span><span class="o">$</span><span class="n">net.result</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">which.max</span><span class="p">)</span>
<span class="n">net.result</span> <span class="o">&lt;-</span> <span class="nf">as.data.frame</span><span class="p">(</span><span class="n">ann_data_sel.prediction</span><span class="o">$</span><span class="n">net.result</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">net.result</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;psi&#39;</span><span class="p">,</span> <span class="s">&#39;non_psi&#39;</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;psi&#39;</span><span class="p">,</span> <span class="s">&#39;non_psi&#39;</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>
<span class="nf">table</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_roc_test_data_plot.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">ann_roc_test</span> <span class="o">&lt;-</span> <span class="nf">roc</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s">&quot;Test Data ROC&quot;</span><span class="p">,</span> <span class="n">test_set</span><span class="o">$</span><span class="n">class</span><span class="p">,</span> <span class="n">net.result</span><span class="o">$</span><span class="n">psi</span><span class="p">,</span> <span class="n">smooth</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">print.auc</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;#e41a1c&quot;</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.thres</span> <span class="o">=</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">print.thres.best.method</span> <span class="o">=</span> <span class="s">&quot;youden&quot;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;non_psi&quot;</span><span class="p">,</span> <span class="s">&quot;psi&quot;</span><span class="p">),</span> <span class="n">direction</span> <span class="o">=</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">auc</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span> <span class="n">ci</span> <span class="o">=</span> <span class="bp">T</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;best roc threshold: &quot;</span><span class="p">)</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">ann_roc_test</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span>

<span class="nf">summary</span><span class="p">(</span><span class="n">ann_data_sel.net</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">ann_data_sel.net</span><span class="p">)</span>
<span class="nf">save</span><span class="p">(</span><span class="n">ann_data_sel.net</span><span class="p">,</span> <span class="n">ann_roc_test</span><span class="p">,</span> <span class="n">training_set_mean</span><span class="p">,</span> <span class="n">training_set_sd</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ANN_model.RData&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">))</span> <span class="c1">#&quot;my-nn.RData&quot;</span>
<span class="c1"># saveRDS(mymodel, file = paste(outFile_prefix, &#39;_ann_model.rds&#39;, sep=&quot;&quot;))#&quot;my-nn.rds&quot;</span>

<span class="c1">#add attr to ann_test_data</span>
<span class="n">ann_test_data</span> <span class="o">&lt;-</span> <span class="n">test_set_origin</span>
<span class="c1"># ann_test_data$ann_test_prob_class &lt;- ifelse(net.result$psi &gt;= coords(ann_roc_test, &quot;best&quot;, ret = &quot;all&quot;, transpose = TRUE)[1], &quot;psi&quot;, &quot;non_psi&quot;)</span>
<span class="n">ann_test_data</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">ann_test_data</span><span class="p">,</span> <span class="n">net.result</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="nf">write.xlsx</span><span class="p">(</span><span class="n">ann_test_data</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_test_data.xlsx&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="c1">#output model info</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================tune best model confusion matrix (for modeling)=====================\n&quot;</span><span class="p">)</span>
<span class="n">tab</span> <span class="o">&lt;-</span> <span class="nf">table</span><span class="p">(</span><span class="n">Predicted</span> <span class="o">=</span> <span class="n">pred</span><span class="p">,</span> <span class="n">Actual</span> <span class="o">=</span> <span class="n">test_set</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
<span class="n">tab</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;tune best model error rate (for modeling): &quot;</span><span class="p">,</span> <span class="m">1</span> <span class="o">-</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;tune best model correct rate (for modeling): &quot;</span><span class="p">,</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="n">tab</span><span class="p">))</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>

<span class="c1">#calculate evaluation indicators</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Calculate evaluation indicators=====================\n&quot;</span><span class="p">)</span>
<span class="n">confusion_matrix</span> <span class="o">&lt;-</span> <span class="nf">as.data.frame</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
<span class="n">ann_TP</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span> <span class="o">==</span> <span class="s">&quot;psi&quot;</span> <span class="o">&amp;</span> <span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span> <span class="o">==</span> <span class="s">&quot;psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span> <span class="c1">#True Positives (TP)</span>
<span class="n">ann_FP</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span> <span class="o">==</span> <span class="s">&quot;psi&quot;</span> <span class="o">&amp;</span> <span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span> <span class="o">==</span> <span class="s">&quot;non_psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span> <span class="c1">#False Positives (FP)</span>
<span class="n">ann_TN</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span> <span class="o">==</span> <span class="s">&quot;non_psi&quot;</span> <span class="o">&amp;</span> <span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span> <span class="o">==</span> <span class="s">&quot;non_psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span> <span class="c1">#True Negatives (TN)</span>
<span class="n">ann_FN</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span> <span class="o">==</span> <span class="s">&quot;non_psi&quot;</span> <span class="o">&amp;</span> <span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span> <span class="o">==</span> <span class="s">&quot;psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span> <span class="c1">#False Negatives (FN)</span>
<span class="n">ann_TPR</span> <span class="o">&lt;-</span> <span class="n">ann_TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">ann_TP</span> <span class="o">+</span> <span class="n">ann_FN</span><span class="p">)</span> <span class="c1">#sensitivity (true positive rate, TPR)</span>
<span class="n">ann_TNR</span> <span class="o">&lt;-</span> <span class="n">ann_TN</span> <span class="o">/</span> <span class="p">(</span><span class="n">ann_TN</span> <span class="o">+</span> <span class="n">ann_FP</span><span class="p">)</span> <span class="c1">#specifity (selectivity or true negative rate, TNR)</span>
<span class="n">ann_FPR</span> <span class="o">&lt;-</span> <span class="m">1</span> <span class="o">-</span> <span class="n">ann_TNR</span> <span class="c1">#False Positive Rate (FPR) (1 - specificit = FP/​N = FP/(TN + FP), FPR)</span>
<span class="n">ann_FNR</span> <span class="o">&lt;-</span> <span class="m">1</span> <span class="o">-</span> <span class="n">ann_TPR</span> <span class="c1">#False Negative Rate, FNR)</span>
<span class="n">ann_Prec</span> <span class="o">&lt;-</span> <span class="n">ann_TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">ann_TP</span> <span class="o">+</span> <span class="n">ann_FP</span><span class="p">)</span> <span class="c1">#Precision</span>
<span class="n">ann_Recall</span> <span class="o">&lt;-</span> <span class="n">ann_TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">ann_TP</span> <span class="o">+</span> <span class="n">ann_FN</span><span class="p">)</span> <span class="c1">#Recall</span>
<span class="n">ann_ACC</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">ann_TP</span> <span class="o">+</span> <span class="n">ann_TN</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ann_TP</span> <span class="o">+</span> <span class="n">ann_TN</span> <span class="o">+</span> <span class="n">ann_FP</span> <span class="o">+</span> <span class="n">ann_FN</span><span class="p">)</span> <span class="c1">#accuracy</span>
<span class="n">ann_F1_score</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">2</span> <span class="o">*</span> <span class="n">ann_Recall</span> <span class="o">*</span> <span class="n">ann_Prec</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ann_Recall</span> <span class="o">+</span> <span class="n">ann_Prec</span><span class="p">)</span> <span class="c1">#F1_score</span>
<span class="n">eval</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">ann_TP</span><span class="p">,</span> <span class="n">ann_FP</span><span class="p">,</span> <span class="n">ann_TN</span><span class="p">,</span> <span class="n">ann_FN</span><span class="p">,</span> <span class="n">ann_TPR</span><span class="p">,</span> <span class="n">ann_TNR</span><span class="p">,</span> <span class="n">ann_FPR</span><span class="p">,</span> <span class="n">ann_FNR</span><span class="p">,</span> <span class="n">ann_Prec</span><span class="p">,</span> <span class="n">ann_Recall</span><span class="p">,</span> <span class="n">ann_ACC</span><span class="p">,</span> <span class="n">ann_F1_score</span><span class="p">)</span>
<span class="n">eval</span> <span class="o">&lt;-</span> <span class="nf">round</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">eval</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_eval.txt&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;\t&quot;</span><span class="p">,</span> <span class="n">row.names</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>

<span class="c1">#show nn evaluation as pdf table</span>
<span class="n">ann_eval_t_df</span> <span class="o">&lt;-</span> <span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">eval</span><span class="p">)))</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">ann_eval_t_df</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="s">&quot;value_or_percentage&quot;</span>
<span class="n">tt3</span> <span class="o">&lt;-</span> <span class="nf">ttheme_minimal</span><span class="p">(</span>
  <span class="n">core</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">bg_params</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">blues9</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">],</span> <span class="n">col</span> <span class="o">=</span> <span class="kc">NA</span><span class="p">),</span>
            <span class="n">fg_params</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">fontface</span> <span class="o">=</span> <span class="m">3</span><span class="p">)),</span>
  <span class="n">colhead</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">fg_params</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">col</span> <span class="o">=</span> <span class="s">&quot;navyblue&quot;</span><span class="p">,</span> <span class="n">fontface</span> <span class="o">=</span> <span class="m">4L</span><span class="p">)),</span>
  <span class="n">rowhead</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">fg_params</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">col</span> <span class="o">=</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="n">fontface</span> <span class="o">=</span> <span class="m">3L</span><span class="p">)))</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_evaluation.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">7</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">7</span><span class="p">)</span> <span class="c1"># Open a new pdf file</span>
<span class="nf">grid.arrange</span><span class="p">(</span>
  <span class="nf">tableGrob</span><span class="p">(</span><span class="n">ann_eval_t_df</span><span class="p">,</span> <span class="n">theme</span> <span class="o">=</span> <span class="n">tt3</span><span class="p">),</span>
  <span class="n">nrow</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span> <span class="c1"># Close the file</span>


<span class="c1">#filt by nn best model</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Filt by nn best model=====================\n&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;below is your input data ready to be predicted...\n&quot;</span><span class="p">)</span>
<span class="c1"># get prediction</span>
<span class="n">to_pred</span> <span class="o">&lt;-</span> <span class="nf">read.table</span><span class="p">(</span><span class="n">filtfile</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">to_pred</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="c1">#1</span>
  <span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="c1">#2</span>
  <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="c1">#3</span>
  <span class="s">&quot;name&quot;</span><span class="p">,</span><span class="c1">#4</span>
  <span class="s">&quot;foldChange&quot;</span><span class="p">,</span><span class="c1">#5</span>
  <span class="s">&quot;strand&quot;</span><span class="p">,</span><span class="c1">#6</span>
  <span class="s">&quot;geneName&quot;</span><span class="p">,</span><span class="c1">#7</span>
  <span class="s">&quot;geneStart&quot;</span><span class="p">,</span><span class="c1">#8</span>
  <span class="s">&quot;geneEnd&quot;</span><span class="p">,</span><span class="c1">#9</span>
  <span class="s">&quot;base&quot;</span><span class="p">,</span><span class="c1">#10</span>
  <span class="s">&quot;treatPval&quot;</span><span class="p">,</span><span class="c1">#11</span>
  <span class="s">&quot;ctrlPval&quot;</span><span class="p">,</span><span class="c1">#12</span>
  <span class="s">&quot;minusPval&quot;</span><span class="p">,</span><span class="c1">#13</span>
  <span class="s">&quot;treatStopNum&quot;</span><span class="p">,</span><span class="c1">#14</span>
  <span class="s">&quot;treatStopRPM&quot;</span><span class="p">,</span><span class="c1">#15</span>
  <span class="s">&quot;treatPreStopNum&quot;</span><span class="p">,</span><span class="c1">#16</span>
  <span class="s">&quot;treatAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#17</span>
  <span class="s">&quot;treatReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#18</span>
  <span class="s">&quot;ctrlStopNum&quot;</span><span class="p">,</span><span class="c1">#19</span>
  <span class="s">&quot;ctrlStopRPM&quot;</span><span class="p">,</span><span class="c1">#20</span>
  <span class="s">&quot;ctrlPreStopNum&quot;</span><span class="p">,</span><span class="c1">#21</span>
  <span class="s">&quot;ctrlAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#22</span>
  <span class="s">&quot;ctrlReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#23</span>
  <span class="s">&quot;stopRpmFC&quot;</span><span class="p">,</span><span class="c1">#24</span>
  <span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#25</span>
  <span class="s">&quot;ctrlPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#26</span>
  <span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#27</span>
  <span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#28</span>
  <span class="s">&quot;ctrlAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#29</span>
  <span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#30</span>
  <span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="c1">#31</span>
  <span class="s">&quot;ctrlStopRatio&quot;</span><span class="p">,</span><span class="c1">#32</span>
  <span class="s">&quot;stopRatioFC&quot;</span><span class="p">,</span><span class="c1">#33</span>
  <span class="s">&quot;treatStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#34</span>
  <span class="s">&quot;treatStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#35</span>
  <span class="s">&quot;ctrlStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#36</span>
  <span class="s">&quot;ctrlStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#37</span>
  <span class="s">&quot;treatStopMeanFoldRatio&quot;</span><span class="p">,</span><span class="c1">#38</span>
  <span class="s">&quot;extendSeq&quot;</span><span class="p">)</span><span class="c1">#39</span>
<span class="c1"># to_pred$ann_class&lt;-&quot;1&quot;</span>
<span class="n">to_pred</span><span class="o">$</span><span class="n">base</span><span class="o">&lt;-</span><span class="s">&quot;T&quot;</span>

<span class="n">to_pred_var</span> <span class="o">&lt;-</span> <span class="n">to_pred</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span><span class="n">preRpmFoldRatio</span><span class="p">,</span><span class="n">treatAfterRpmFold</span><span class="p">,</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">stopRatioFC</span><span class="p">)</span>
<span class="n">to_pred_var</span> <span class="o">=</span> <span class="nf">scale</span><span class="p">(</span><span class="n">to_pred_var</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="n">training_set_mean</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">training_set_sd</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">to_pred_var</span><span class="p">)</span>

<span class="c1"># Predicting Result</span>
<span class="n">ann_data_sel.prediction</span> <span class="o">&lt;-</span> <span class="n">neuralnet</span><span class="o">::</span><span class="nf">compute</span><span class="p">(</span><span class="n">ann_data_sel.net</span><span class="p">,</span> <span class="n">to_pred_var</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">&lt;-</span> <span class="nf">apply</span><span class="p">(</span><span class="n">ann_data_sel.prediction</span><span class="o">$</span><span class="n">net.result</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">which.max</span><span class="p">)</span>
<span class="n">net.result</span> <span class="o">&lt;-</span> <span class="nf">as.data.frame</span><span class="p">(</span><span class="n">ann_data_sel.prediction</span><span class="o">$</span><span class="n">net.result</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">net.result</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;psi&#39;</span><span class="p">,</span> <span class="s">&#39;non_psi&#39;</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;psi&#39;</span><span class="p">,</span> <span class="s">&#39;non_psi&#39;</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>
<span class="nf">table</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>


<span class="c1">#add attr to ann_pred_data</span>
<span class="n">ann_pred_data</span> <span class="o">&lt;-</span> <span class="n">to_pred</span>
<span class="n">ann_pred_data</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">ann_pred_data</span><span class="p">,</span> <span class="n">net.result</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="nf">write.xlsx</span><span class="p">(</span><span class="n">ann_pred_data</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_total_prediction.xlsx&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="c1">#read hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed evidence</span>
<span class="n">evidence</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span><span class="c1">#&quot;hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed&quot;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="s">&quot;rRNA_anno&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">,</span><span class="s">&quot;strand&quot;</span><span class="p">)</span>
<span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>

<span class="c1">#read hg38.psiU.SingleSites.bed</span>
<span class="n">evidence2</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">rRNAfile2</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span><span class="c1">#&quot;hg38.psiU.SingleSites.bed&quot;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">evidence2</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="s">&quot;rRNA_anno&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">,</span><span class="s">&quot;strand&quot;</span><span class="p">)</span>
<span class="n">evidence2</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">evidence2</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>

<span class="c1">#known_data miss/hit hg38_human_chr21_rRNA_known_pseudoU_SingleSites</span>
<span class="n">ann_data</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">ann_data</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">ann_data</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">ann_data</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">ann_data</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">ann_data_evidence</span><span class="o">&lt;-</span><span class="n">ann_data</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">ann_data_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_psiFinder_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">ann_data_no_evidence</span><span class="o">&lt;-</span><span class="n">evidence</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">ann_data</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">class</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">ann_data_no_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_psiFinder_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">ann_data_evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;psiFinder recover (hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>

<span class="c1">#known_data miss/hit hg38.psiU.SingleSites.bed</span>
<span class="n">ann_data</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">ann_data</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">ann_data</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">ann_data</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">ann_data</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">ann_data_evidence2</span><span class="o">&lt;-</span><span class="n">ann_data</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence2</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">ann_data_evidence2</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38.psiU.SingleSites.bed_psiFinder_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">ann_data_no_evidence2</span><span class="o">&lt;-</span><span class="n">evidence2</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">ann_data</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">class</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">ann_data_no_evidence2</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38.psiU.SingleSites.bed_psiFinder_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">ann_data_evidence2</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence2</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;psiFinder recover (hg38.psiU.SingleSites.bed.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>

<span class="c1">#final_pred miss/hit</span>
<span class="n">final_pred</span><span class="o">&lt;-</span><span class="n">ann_pred_data</span><span class="p">[</span><span class="n">ann_pred_data</span><span class="o">$</span><span class="n">pred</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="p">,]</span>
<span class="n">final_pred</span><span class="o">&lt;-</span><span class="n">final_pred</span><span class="p">[</span><span class="n">final_pred</span><span class="o">$</span><span class="n">foldChange</span><span class="o">&gt;</span><span class="m">2</span><span class="p">,]</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_psi_prediction.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_psi_prediction.bed&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="n">final_pred</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">final_pred_evidence</span><span class="o">&lt;-</span><span class="n">final_pred</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_psiFinder_ann_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">final_pred_no_evidence</span><span class="o">&lt;-</span><span class="n">evidence</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_no_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_psiFinder_ann_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;psiFinder+ANN recover (hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ann_predict_totalRNA.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$#</span> -ne <span class="m">2</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s1">&#39;Usage: &#39;</span><span class="nv">$0</span> <span class="s1">&#39; input ANN_model&#39;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nv">input</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">ANN_model</span><span class="o">=</span><span class="nv">$2</span>

awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {if($1~/^chr[0-9|a-z|A-Z]*$/ &amp;&amp; $10==&quot;T&quot; &amp;&amp; $14&gt;10){print $0}}&#39;</span> <span class="nv">$input</span> &gt; <span class="si">${</span><span class="nv">input</span><span class="p">%.bed</span><span class="si">}</span>_ann_filt.bed
nohup Rscript <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/ann_predict_totalRNA.r -f <span class="si">${</span><span class="nv">input</span><span class="p">%.bed</span><span class="si">}</span>_ann_filt.bed -k <span class="nv">$ANN_model</span> -r <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -o <span class="si">${</span><span class="nv">input</span><span class="p">%.bed</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">input</span><span class="p">%.bed</span><span class="si">}</span>.log
<span class="nb">wait</span>
cat <span class="si">${</span><span class="nv">input</span><span class="p">%.bed</span><span class="si">}</span>.log

<span class="nb">echo</span> <span class="s2">&quot;total RNA: ANN predict program is done!&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;total RNA: ANN predict result in </span><span class="k">$(</span>dirname <span class="si">${</span><span class="nv">input</span><span class="si">}</span><span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ann_predict_totalRNA.r</span></code></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/env Rscript</span>

<span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;optparse&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;stringr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;reshape2&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;openxlsx&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;neuralnet&quot;</span><span class="p">))</span>
<span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>

<span class="n">option_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-f&quot;</span><span class="p">,</span> <span class="s">&quot;--filtfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;filted file of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-k&quot;</span><span class="p">,</span> <span class="s">&quot;--anpsiodelfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;anpsiodelfile [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-r&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;rRNA of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="s">&quot;--outfile_prefix&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;output file name [default= %default]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">)</span>
<span class="p">);</span>
<span class="n">opt_parser</span> <span class="o">=</span> <span class="nf">OptionParser</span><span class="p">(</span><span class="n">option_list</span><span class="o">=</span><span class="n">option_list</span><span class="p">);</span>
<span class="n">opt</span> <span class="o">=</span> <span class="nf">parse_args</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>

<span class="nf">if </span><span class="p">(</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">anpsiodelfile</span><span class="p">)</span><span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span><span class="p">)</span> <span class="p">){</span>
  <span class="nf">print_help</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>
  <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;Please provide -f anpsiodelfile, -k filtfile, -r rRNAfile, and -o outfile_prefix option&quot;</span><span class="p">,</span> <span class="n">call.</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">filtfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span>
<span class="n">anpsiodelfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">anpsiodelfile</span>
<span class="n">rRNAfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span>
<span class="n">outFile_prefix</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span>

<span class="nf">print</span><span class="p">(</span><span class="n">filtfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">anpsiodelfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">)</span>

<span class="nf">load</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">anpsiodelfile</span><span class="p">)</span><span class="c1">#&quot;my-ann.RData&quot;</span>

<span class="c1">#filt by ann best model</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Filt by ann best model=====================\n&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;below is your input data ready to be predicted...\n&quot;</span><span class="p">)</span>
<span class="c1"># get prediction</span>
<span class="n">to_pred</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">filtfile</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">to_pred</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="c1">#1</span>
  <span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="c1">#2</span>
  <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="c1">#3</span>
  <span class="s">&quot;name&quot;</span><span class="p">,</span><span class="c1">#4</span>
  <span class="s">&quot;foldChange&quot;</span><span class="p">,</span><span class="c1">#5</span>
  <span class="s">&quot;strand&quot;</span><span class="p">,</span><span class="c1">#6</span>
  <span class="s">&quot;geneName&quot;</span><span class="p">,</span><span class="c1">#7</span>
  <span class="s">&quot;geneStart&quot;</span><span class="p">,</span><span class="c1">#8</span>
  <span class="s">&quot;geneEnd&quot;</span><span class="p">,</span><span class="c1">#9</span>
  <span class="s">&quot;base&quot;</span><span class="p">,</span><span class="c1">#10</span>
  <span class="s">&quot;treatPval&quot;</span><span class="p">,</span><span class="c1">#11</span>
  <span class="s">&quot;ctrlPval&quot;</span><span class="p">,</span><span class="c1">#12</span>
  <span class="s">&quot;minusPval&quot;</span><span class="p">,</span><span class="c1">#13</span>
  <span class="s">&quot;treatStopNum&quot;</span><span class="p">,</span><span class="c1">#14</span>
  <span class="s">&quot;treatStopRPM&quot;</span><span class="p">,</span><span class="c1">#15</span>
  <span class="s">&quot;treatPreStopNum&quot;</span><span class="p">,</span><span class="c1">#16</span>
  <span class="s">&quot;treatAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#17</span>
  <span class="s">&quot;treatReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#18</span>
  <span class="s">&quot;ctrlStopNum&quot;</span><span class="p">,</span><span class="c1">#19</span>
  <span class="s">&quot;ctrlStopRPM&quot;</span><span class="p">,</span><span class="c1">#20</span>
  <span class="s">&quot;ctrlPreStopNum&quot;</span><span class="p">,</span><span class="c1">#21</span>
  <span class="s">&quot;ctrlAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#22</span>
  <span class="s">&quot;ctrlReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#23</span>
  <span class="s">&quot;stopRpmFC&quot;</span><span class="p">,</span><span class="c1">#24</span>
  <span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#25</span>
  <span class="s">&quot;ctrlPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#26</span>
  <span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#27</span>
  <span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#28</span>
  <span class="s">&quot;ctrlAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#29</span>
  <span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#30</span>
  <span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="c1">#31</span>
  <span class="s">&quot;ctrlStopRatio&quot;</span><span class="p">,</span><span class="c1">#32</span>
  <span class="s">&quot;stopRatioFC&quot;</span><span class="p">,</span><span class="c1">#33</span>
  <span class="s">&quot;treatStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#34</span>
  <span class="s">&quot;treatStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#35</span>
  <span class="s">&quot;ctrlStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#36</span>
  <span class="s">&quot;ctrlStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#37</span>
  <span class="s">&quot;treatStopMeanFoldRatio&quot;</span><span class="p">,</span><span class="c1">#38</span>
  <span class="s">&quot;extendSeq&quot;</span><span class="p">)</span><span class="c1">#39</span>
<span class="n">to_pred</span><span class="o">$</span><span class="n">base</span><span class="o">&lt;-</span><span class="s">&quot;T&quot;</span>
<span class="n">to_pred_var</span><span class="o">&lt;-</span><span class="n">to_pred</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span> <span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="n">treatAfterRpmFold</span><span class="p">,</span> <span class="n">afterRpmFoldRatio</span><span class="p">,</span> <span class="n">treatStopRatio</span><span class="p">,</span> <span class="n">stopRatioFC</span><span class="p">)</span>
<span class="n">to_pred_var</span> <span class="o">=</span> <span class="nf">scale</span><span class="p">(</span><span class="n">to_pred_var</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="n">training_set_mean</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">training_set_sd</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">to_pred_var</span><span class="p">)</span>

<span class="c1"># Predicting Result</span>
<span class="n">ann_data_sel.prediction</span> <span class="o">&lt;-</span> <span class="n">neuralnet</span><span class="o">::</span><span class="nf">compute</span><span class="p">(</span><span class="n">ann_data_sel.net</span><span class="p">,</span> <span class="n">to_pred_var</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">&lt;-</span> <span class="nf">apply</span><span class="p">(</span><span class="n">ann_data_sel.prediction</span><span class="o">$</span><span class="n">net.result</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">which.max</span><span class="p">)</span>
<span class="n">net.result</span> <span class="o">&lt;-</span> <span class="nf">as.data.frame</span><span class="p">(</span><span class="n">ann_data_sel.prediction</span><span class="o">$</span><span class="n">net.result</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">net.result</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;psi&#39;</span><span class="p">,</span> <span class="s">&#39;non_psi&#39;</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;psi&#39;</span><span class="p">,</span> <span class="s">&#39;non_psi&#39;</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>
<span class="nf">table</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

<span class="c1">#add attr to ann_pred_data</span>
<span class="n">ann_pred_data</span> <span class="o">&lt;-</span> <span class="n">to_pred</span>
<span class="n">ann_pred_data</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">ann_pred_data</span><span class="p">,</span> <span class="n">net.result</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="nf">write.xlsx</span><span class="p">(</span><span class="n">ann_pred_data</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_total_prediction.xlsx&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="n">final_pred</span> <span class="o">&lt;-</span> <span class="n">ann_pred_data</span><span class="p">[</span><span class="n">ann_pred_data</span><span class="o">$</span><span class="n">pred</span> <span class="o">==</span> <span class="s">&quot;psi&quot;</span><span class="p">,]</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;psi predicted by nn model and fold change (foldChange) &gt;2:&quot;</span><span class="p">)</span>
<span class="n">final_pred</span> <span class="o">&lt;-</span> <span class="n">final_pred</span><span class="p">[</span><span class="n">final_pred</span><span class="o">$</span><span class="n">foldChange</span> <span class="o">&gt;</span> <span class="m">2</span><span class="p">,]</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;Final psi prediction:&quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">final_pred</span><span class="o">$</span><span class="n">pred</span><span class="p">)</span>
<span class="nf">write.xlsx</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_psi_prediction.xlsx&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_psi_prediction.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ann_psi_prediction.bed&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="c1">#known evidence</span>
<span class="n">evidence</span> <span class="o">&lt;-</span> <span class="nf">read.table</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span> <span class="s">&quot;chromStart&quot;</span><span class="p">,</span> <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span> <span class="s">&quot;rRNA_anno&quot;</span><span class="p">,</span> <span class="s">&quot;score&quot;</span><span class="p">,</span> <span class="s">&quot;strand&quot;</span><span class="p">)</span>
<span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span> <span class="o">&lt;-</span> <span class="nf">paste</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span> <span class="n">evidence</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span> <span class="n">evidence</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span> <span class="n">evidence</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">final_pred</span><span class="o">$</span><span class="n">rRNA_uniq_id</span> <span class="o">&lt;-</span> <span class="nf">paste</span><span class="p">(</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span> <span class="n">final_pred</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span> <span class="n">final_pred</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span> <span class="n">final_pred</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">final_pred_evidence</span> <span class="o">&lt;-</span> <span class="n">final_pred</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span> <span class="o">=</span> <span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&quot;_rtsSeeker_ann_hit.csv&quot;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">final_pred_no_evidence</span> <span class="o">&lt;-</span> <span class="n">evidence</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span> <span class="o">=</span> <span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_no_evidence</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&quot;_rtsSeeker_ann_miss.csv&quot;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span> <span class="o">&lt;-</span> <span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span> <span class="o">*</span> <span class="m">100</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="s">&quot;%&quot;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;rtsSeeker+ANN recover (hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed)&quot;</span><span class="p">,</span> <span class="n">recovery</span><span class="p">,</span> <span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All user input will be recorded in a plain text file with suffixes <code class="docutils literal notranslate"><span class="pre">_ann_totalRNA_build.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">_ann_totalRNA_predict.txt</span></code> in psiFinder/config and help users to easily reload the previous config (by simply clicking <code class="docutils literal notranslate"><span class="pre">CONFIG</span></code> button).</p>
</div>
</section>
<section id="roc-receiver-operating-characteristic">
<h3><a class="toc-backref" href="#id14">(3) ROC: Receiver Operating Characteristic</a><a class="headerlink" href="#roc-receiver-operating-characteristic" title="Permalink to this heading">¶</a></h3>
<p>If <code class="docutils literal notranslate"><span class="pre">plot</span> <span class="pre">ROC</span></code> option is checked,  <code class="docutils literal notranslate"><span class="pre">3.1_rtsSeeker_roc.sh</span></code> will run <code class="docutils literal notranslate"><span class="pre">roc.r</span></code> to generate file with <code class="docutils literal notranslate"><span class="pre">_roc_psi_prediction.bed</span></code> suffix, which is the candidate Ψ-sites gained by ROC best threshold (determined by one of the six variables with the highest F1 score).</p>
</section>
<section id="user-defined-customize-key-thresholds">
<h3><a class="toc-backref" href="#id15">(4) User-defined: Customize key thresholds</a><a class="headerlink" href="#user-defined-customize-key-thresholds" title="Permalink to this heading">¶</a></h3>
<p>By user-defined thresholds with stringent statistical controls, psiFinder allows users to filter and preserve highly reliable true positive Ψ sites (expertise of threshold determination is needed).</p>
<p>Once click <code class="docutils literal notranslate"><span class="pre">FILT</span></code>, <code class="docutils literal notranslate"><span class="pre">User-defined</span></code> QT widget will run <code class="docutils literal notranslate"><span class="pre">user_defined.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">user_defined_evaluation.r</span></code></p>
<img alt="../_images/User-defined.png" src="../_images/User-defined.png" />
<p><code class="docutils literal notranslate"><span class="pre">user_defined.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$#</span> -ne <span class="m">7</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s1">&#39;Usage: &#39;</span><span class="nv">$0</span> <span class="s1">&#39; input.bed treatPreRpmFold preRpmFoldRatio treatAfterRpmFold afterRpmFoldRatio treatStopRatio stopRatioFC&#39;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nv">out</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">treatPreRpmFold</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">preRpmFoldRatio</span><span class="o">=</span><span class="nv">$3</span>
<span class="nv">treatAfterRpmFold</span><span class="o">=</span><span class="nv">$4</span>
<span class="nv">afterRpmFoldRatio</span><span class="o">=</span><span class="nv">$5</span>
<span class="nv">treatStopRatio</span><span class="o">=</span><span class="nv">$6</span>
<span class="nv">stopRatioFC</span><span class="o">=</span><span class="nv">$7</span>
<span class="nv">outFileName</span><span class="o">=</span><span class="si">${</span><span class="nv">out</span><span class="p">%.bed</span><span class="si">}</span>

<span class="nb">echo</span> <span class="s2">&quot;rtsSeeker User-defined mode: rtsSeeker start...&quot;</span>

awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {if($1~/^chr[0-9|a-z|A-Z]*$/ &amp;&amp; $10==&quot;T&quot; &amp;&amp; $14&gt;10){print $0}}&#39;</span> <span class="nv">$out</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_filt.bed
<span class="nb">echo</span> -e <span class="s2">&quot;treatPreRpmFold\tpreRpmFoldRatio\ttreatAfterRpmFold\tafterRpmFoldRatio\ttreatStopRatio\tstopRatioFC\n</span><span class="nv">$treatPreRpmFold</span><span class="s2">\t</span><span class="nv">$preRpmFoldRatio</span><span class="s2">\t</span><span class="nv">$treatAfterRpmFold</span><span class="s2">\t</span><span class="nv">$afterRpmFoldRatio</span><span class="s2">\t</span><span class="nv">$treatStopRatio</span><span class="s2">\t</span><span class="nv">$stopRatioFC</span><span class="s2">&quot;</span> &gt;<span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres_colname.txt
<span class="nb">echo</span> -e <span class="s2">&quot;</span><span class="nv">$treatPreRpmFold</span><span class="s2">\t</span><span class="nv">$preRpmFoldRatio</span><span class="s2">\t</span><span class="nv">$treatAfterRpmFold</span><span class="s2">\t</span><span class="nv">$afterRpmFoldRatio</span><span class="s2">\t</span><span class="nv">$treatStopRatio</span><span class="s2">\t</span><span class="nv">$stopRatioFC</span><span class="s2">&quot;</span> &gt;<span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt

cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_filt.bed <span class="p">|</span>awk -v <span class="nv">sample</span><span class="o">=</span><span class="k">$(</span>basename <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span><span class="k">)</span> -v <span class="nv">treatpre</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">1</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> -v <span class="nv">preFoldFC</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">2</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> -v <span class="nv">treataft</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">3</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> -v <span class="nv">aftFoldFC</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">4</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> -v <span class="nv">treatstoprate</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">5</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> -v <span class="nv">stoprateFC</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">6</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> <span class="s1">&#39;FS=OFS=&quot;\t&quot; {if( $25&gt;=treatpre &amp;&amp; $27&gt;=preFoldFC &amp;&amp; $28&gt;=treataft &amp;&amp; $30&gt;=aftFoldFC &amp;&amp; $31&gt;= treatstoprate &amp;&amp; $33&gt;=stoprateFC ) {print $0,sample}}&#39;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_psi_prediction.bed
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_filt.bed <span class="p">|</span>awk -v <span class="nv">treatPreRpmFold</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">1</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> -v <span class="nv">preRpmFoldRatio</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">2</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> -v <span class="nv">treatAfterRpmFold</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">3</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> -v <span class="nv">afterRpmFoldRatio</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">4</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> -v <span class="nv">treatStopRatio</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">5</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> -v <span class="nv">stopRatioFC</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>cut -f <span class="m">6</span> <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_thres.txt<span class="o">)</span><span class="sb">`</span> <span class="s1">&#39;FS=OFS=&quot;\t&quot; {if( $25&gt;=treatPreRpmFold &amp;&amp; $27&gt;=preRpmFoldRatio &amp;&amp; $28&gt;=treatAfterRpmFold &amp;&amp; $30&gt;=afterRpmFoldRatio &amp;&amp; $31&gt;= treatStopRatio &amp;&amp; $33&gt;=stopRatioFC) {print $0,&quot;1&quot;} else{ print $0,&quot;0&quot;} }&#39;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_prediction_total.bed

bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_prediction_total.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s &gt;<span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.bed
bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_prediction_total.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/rrna_chr21.bed -s &gt;<span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_rrna.bed

bedtools intersect -a <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_rrna.bed -b <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s -v &gt;<span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.bed
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.bed <span class="p">|</span>awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {print $0,&quot;1&quot;}&#39;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.txt
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.bed <span class="p">|</span>awk <span class="s1">&#39;FS=OFS=&quot;\t&quot; {print $0,&quot;0&quot;}&#39;</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.txt

<span class="nb">echo</span> <span class="s2">&quot;getting roc_plot.txt&quot;</span>
cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_knowpse.txt <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_notpse.txt &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_plot.txt

<span class="nb">echo</span> <span class="s2">&quot;generate ROC plot...&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;user-defined ROC ploting preparating&quot;</span>
nohup Rscript <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/user_defined_evaluation.r -f <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_plot.txt -r <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed -s <span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>/hg38.psiU.SingleSites.bed -t <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_prediction_total.bed -o <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_bestthres.log <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
<span class="nb">wait</span>

cat <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_roc_bestthres.log
mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_six_variables_rRNA_violinplot.pdf <span class="p">&amp;</span>&gt; /dev/null
mupdf-x11 <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_evaluation.pdf <span class="p">&amp;</span>&gt; /dev/null

<span class="nb">echo</span> <span class="s2">&quot;User-defined program is done!&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;User-defined: User-defined result in </span><span class="k">$(</span>dirname <span class="si">${</span><span class="nv">outFileName</span><span class="si">}</span>_user_defined_psi_prediction.bed<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">user_defined_evaluation.r</span></code></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/env Rscript</span>

<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;optparse&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggplot2&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggpubr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;cowplot&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;gridExtra&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;reshape2&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;stringr&quot;</span><span class="p">))</span>
<span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;RColorBrewer&quot;</span><span class="p">))</span>

<span class="n">option_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-f&quot;</span><span class="p">,</span> <span class="s">&quot;--rocfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;ROC of single sites [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-r&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-s&quot;</span><span class="p">,</span> <span class="s">&quot;--rRNAfile2&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;hg38.psiU.SingleSites.bed [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-t&quot;</span><span class="p">,</span> <span class="s">&quot;--filtfile&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;filt file [file]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">),</span>
  <span class="nf">make_option</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="s">&quot;--outfile_prefix&quot;</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s">&quot;output file name [default= %default]&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">)</span>
<span class="p">);</span>
<span class="n">opt_parser</span> <span class="o">=</span> <span class="nf">OptionParser</span><span class="p">(</span><span class="n">option_list</span><span class="o">=</span><span class="n">option_list</span><span class="p">);</span>
<span class="n">opt</span> <span class="o">=</span> <span class="nf">parse_args</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>

<span class="nf">if </span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rocfile</span><span class="p">)</span><span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile2</span><span class="p">)</span> <span class="o">||</span> <span class="nf">is.null</span><span class="p">(</span><span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span><span class="p">)</span> <span class="p">){</span>
  <span class="nf">print_help</span><span class="p">(</span><span class="n">opt_parser</span><span class="p">);</span>
  <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;Please provide -f rocfile, -r rRNAfile, -s rRNAfile2, -t filtfile  and -o outfile_prefix option&quot;</span><span class="p">,</span> <span class="n">call.</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ROCfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rocfile</span>
<span class="n">rRNAfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile</span>
<span class="n">rRNAfile2</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">rRNAfile2</span>
<span class="n">filtfile</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">filtfile</span>
<span class="n">outFile_prefix</span> <span class="o">=</span> <span class="n">opt</span><span class="o">$</span><span class="n">outfile_prefix</span>

<span class="nf">print</span><span class="p">(</span><span class="n">ROCfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rRNAfile2</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">filtfile</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">)</span>

<span class="c1"># roc_plot.txt</span>
<span class="n">ROC_data</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">ROCfile</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">ROC_data</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="c1">#1</span>
  <span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="c1">#2</span>
  <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="c1">#3</span>
  <span class="s">&quot;name&quot;</span><span class="p">,</span><span class="c1">#4</span>
  <span class="s">&quot;foldChange&quot;</span><span class="p">,</span><span class="c1">#5</span>
  <span class="s">&quot;strand&quot;</span><span class="p">,</span><span class="c1">#6</span>
  <span class="s">&quot;geneName&quot;</span><span class="p">,</span><span class="c1">#7</span>
  <span class="s">&quot;geneStart&quot;</span><span class="p">,</span><span class="c1">#8</span>
  <span class="s">&quot;geneEnd&quot;</span><span class="p">,</span><span class="c1">#9</span>
  <span class="s">&quot;base&quot;</span><span class="p">,</span><span class="c1">#10</span>
  <span class="s">&quot;treatPval&quot;</span><span class="p">,</span><span class="c1">#11</span>
  <span class="s">&quot;ctrlPval&quot;</span><span class="p">,</span><span class="c1">#12</span>
  <span class="s">&quot;minusPval&quot;</span><span class="p">,</span><span class="c1">#13</span>
  <span class="s">&quot;treatStopNum&quot;</span><span class="p">,</span><span class="c1">#14</span>
  <span class="s">&quot;treatStopRPM&quot;</span><span class="p">,</span><span class="c1">#15</span>
  <span class="s">&quot;treatPreStopNum&quot;</span><span class="p">,</span><span class="c1">#16</span>
  <span class="s">&quot;treatAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#17</span>
  <span class="s">&quot;treatReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#18</span>
  <span class="s">&quot;ctrlStopNum&quot;</span><span class="p">,</span><span class="c1">#19</span>
  <span class="s">&quot;ctrlStopRPM&quot;</span><span class="p">,</span><span class="c1">#20</span>
  <span class="s">&quot;ctrlPreStopNum&quot;</span><span class="p">,</span><span class="c1">#21</span>
  <span class="s">&quot;ctrlAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#22</span>
  <span class="s">&quot;ctrlReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#23</span>
  <span class="s">&quot;stopRpmFC&quot;</span><span class="p">,</span><span class="c1">#24</span>
  <span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#25</span>
  <span class="s">&quot;ctrlPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#26</span>
  <span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#27</span>
  <span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#28</span>
  <span class="s">&quot;ctrlAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#29</span>
  <span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#30</span>
  <span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="c1">#31</span>
  <span class="s">&quot;ctrlStopRatio&quot;</span><span class="p">,</span><span class="c1">#32</span>
  <span class="s">&quot;stopRatioFC&quot;</span><span class="p">,</span><span class="c1">#33</span>
  <span class="s">&quot;treatStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#34</span>
  <span class="s">&quot;treatStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#35</span>
  <span class="s">&quot;ctrlStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#36</span>
  <span class="s">&quot;ctrlStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#37</span>
  <span class="s">&quot;treatStopMeanFoldRatio&quot;</span><span class="p">,</span><span class="c1">#38</span>
  <span class="s">&quot;extendSeq&quot;</span><span class="p">,</span><span class="c1">#39</span>
  <span class="s">&quot;pred_class&quot;</span><span class="p">,</span><span class="c1">#40</span>
  <span class="s">&quot;real_class&quot;</span><span class="p">)</span><span class="c1">#41</span>
<span class="n">ROC_data</span><span class="o">$</span><span class="n">base</span><span class="o">&lt;-</span><span class="s">&quot;T&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;real class:\n&quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">real_class</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;prediction class:\n&quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">pred_class</span><span class="p">)</span>

<span class="n">tab</span> <span class="o">&lt;-</span> <span class="nf">table</span><span class="p">(</span><span class="n">Predicted</span> <span class="o">=</span> <span class="n">ROC_data</span><span class="o">$</span><span class="n">pred_class</span><span class="p">,</span><span class="n">Actual</span> <span class="o">=</span> <span class="n">ROC_data</span><span class="o">$</span><span class="n">real_class</span><span class="p">)</span>
<span class="n">tab</span>

<span class="nf">confusionMatrix</span><span class="p">(</span><span class="nf">factor</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">pred_class</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">)),</span><span class="nf">factor</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">real_class</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">)))</span>
<span class="n">ROC_data_sel</span><span class="o">&lt;-</span><span class="n">ROC_data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span><span class="n">treatAfterRpmFold</span><span class="p">,</span><span class="n">treatStopMeanFold</span><span class="p">,</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="n">afterRpmFoldRatio</span><span class="p">,</span> <span class="n">stopRatioFC</span><span class="p">,</span><span class="n">treatStopMeanFoldRatio</span><span class="p">,</span><span class="n">real_class</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;total summary (rRNA psi and rRNA non-psi)&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">ROC_data_sel</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;psi summary (all real rRNA psi)&quot;</span><span class="p">)</span>
<span class="n">real_rRNA_psi</span><span class="o">&lt;-</span><span class="n">ROC_data_sel</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">real_class</span><span class="o">==</span><span class="s">&quot;1&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">real_rRNA_psi</span><span class="p">)</span>
<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_real_rRNA_psi_datadensity.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="nf">datadensity</span><span class="p">(</span><span class="n">real_rRNA_psi</span><span class="p">,</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="nf">cut2</span><span class="p">(</span><span class="n">real_rRNA_psi</span><span class="o">$</span><span class="n">treatStopRatio</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="m">2</span><span class="p">))</span><span class="c1">#cut tretRtsRatio into 2 color group</span>
<span class="nf">dev.off</span><span class="p">()</span>

<span class="c1">#rRNA-psi-non-psi visualization</span>
<span class="n">ROC_data_melt</span><span class="o">&lt;-</span><span class="nf">melt</span><span class="p">(</span><span class="n">ROC_data</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="o">:</span><span class="m">38</span><span class="p">,</span><span class="m">41</span><span class="p">)],</span><span class="n">id.vars</span> <span class="o">=</span> <span class="s">&quot;real_class&quot;</span><span class="p">)</span>
<span class="n">ROC_data_melt</span><span class="o">$</span><span class="n">real_class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">ROC_data_melt</span><span class="o">$</span><span class="n">real_class</span><span class="p">),</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">ROC_data_melt</span><span class="o">$</span><span class="n">real_class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">ROC_data_melt</span><span class="o">$</span><span class="n">real_class</span><span class="p">),</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">)</span>

<span class="n">data_summary</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">m</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">ymin</span> <span class="o">&lt;-</span> <span class="n">m</span><span class="o">-</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">ymax</span> <span class="o">&lt;-</span> <span class="n">m</span><span class="o">+</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="nf">return</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">m</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">my_comparisons</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;non-psi&quot;</span><span class="p">,</span> <span class="s">&quot;psi&quot;</span><span class="p">)</span> <span class="p">)</span>

<span class="c1">#treatPreRpmFold</span>
<span class="n">treatPreRpmFold</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatPreRpmFold$&quot;</span><span class="p">))</span>
<span class="n">treatPreRpmFold_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">real_class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">real_class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatPreRpmFold)&quot;</span><span class="p">)</span>
<span class="n">treatPreRpmFold_bp</span><span class="o">&lt;-</span><span class="n">treatPreRpmFold_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatPreRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#treatAfterRpmFold</span>
<span class="n">treatAfterRpmFold</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatAfterRpmFold$&quot;</span><span class="p">))</span>
<span class="n">treatAfterRpmFold_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">real_class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">real_class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatAfterRpmFold)&quot;</span><span class="p">)</span>
<span class="n">treatAfterRpmFold_bp</span><span class="o">&lt;-</span><span class="n">treatAfterRpmFold_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatAfterRpmFold</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#preRpmFoldRatio</span>
<span class="n">preRpmFoldRatio</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^preRpmFoldRatio$&quot;</span><span class="p">))</span>
<span class="n">preRpmFoldRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">real_class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">real_class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(preRpmFoldRatio)&quot;</span><span class="p">)</span>
<span class="n">preRpmFoldRatio_bp</span><span class="o">&lt;-</span><span class="n">preRpmFoldRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">preRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#afterRpmFoldRatio</span>
<span class="n">afterRpmFoldRatio</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^afterRpmFoldRatio$&quot;</span><span class="p">))</span>
<span class="n">afterRpmFoldRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">real_class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">real_class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(afterRpmFoldRatio)&quot;</span><span class="p">)</span>
<span class="n">afterRpmFoldRatio_bp</span><span class="o">&lt;-</span><span class="n">afterRpmFoldRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">afterRpmFoldRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="c1">#treatStopRatio</span>
<span class="n">treatStopRatio</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^treatStopRatio$&quot;</span><span class="p">))</span>
<span class="n">treatStopRatio</span><span class="o">&lt;-</span><span class="n">treatStopRatio</span><span class="p">[</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="o">!=</span><span class="m">0</span><span class="p">,]</span>
<span class="n">treatStopRatio_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">real_class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">real_class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(treatStopRatio)&quot;</span><span class="p">)</span>
<span class="n">treatStopRatio_bp</span><span class="o">&lt;-</span><span class="n">treatStopRatio_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">treatStopRatio</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="n">stopRatioFC</span><span class="o">&lt;-</span><span class="n">ROC_data_melt</span><span class="o">%&gt;%</span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&quot;^stopRatioFC$&quot;</span><span class="p">))</span>
<span class="n">stopRatioFC_bp</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">real_class</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">log2</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">real_class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">stat_boxplot</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;errorbar&quot;</span><span class="p">,</span>
               <span class="n">width</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_violin</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="o">=</span><span class="n">data_summary</span><span class="p">,</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;crossbar&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;log2(stopRatioFC)&quot;</span><span class="p">)</span>
<span class="n">stopRatioFC_bp</span><span class="o">&lt;-</span><span class="n">stopRatioFC_bp</span> <span class="o">+</span> <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&quot;Set1&quot;</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span> <span class="o">+</span> <span class="nf">theme_classic</span><span class="p">()</span><span class="o">+</span>
<span class="nf">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">),</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">font</span><span class="p">(</span><span class="s">&quot;xy.text&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">)</span><span class="o">+</span>
<span class="nf">stat_compare_means</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;t.test&quot;</span><span class="p">,</span><span class="n">comparisons</span> <span class="o">=</span> <span class="n">my_comparisons</span><span class="p">,</span><span class="n">label.y</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="o">$</span><span class="n">value</span><span class="p">))</span><span class="o">+</span><span class="nf">abs</span><span class="p">(</span><span class="nf">quantile</span><span class="p">(</span><span class="nf">log2</span><span class="p">(</span><span class="n">stopRatioFC</span><span class="o">$</span><span class="n">value</span><span class="p">))[</span><span class="m">1</span><span class="p">]))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">))</span><span class="o">+</span>
<span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">expansion</span><span class="p">(</span><span class="n">mult</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)))</span><span class="o">+</span>
<span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;#129a92&quot;</span><span class="p">,</span><span class="s">&quot;#1e95d4&quot;</span><span class="p">))</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_six_variables_rRNA_violinplot.pdf&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">width</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">6</span><span class="p">)</span>
<span class="nf">plot_grid</span><span class="p">(</span>
  <span class="n">treatPreRpmFold_bp</span><span class="p">,</span>
  <span class="n">preRpmFoldRatio_bp</span><span class="p">,</span>
  <span class="n">treatAfterRpmFold_bp</span><span class="p">,</span>
  <span class="n">afterRpmFoldRatio_bp</span><span class="p">,</span>
  <span class="n">treatStopRatio_bp</span><span class="p">,</span>
  <span class="n">stopRatioFC_bp</span><span class="p">,</span>
  <span class="n">align</span> <span class="o">=</span> <span class="s">&quot;hv&quot;</span><span class="p">,</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">,</span><span class="s">&#39;E&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span>

<span class="c1">#calculate evaluation indicators</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;\n\n=====================Calculate evaluation indicators=====================\n&quot;</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">ud_TP</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="o">&amp;</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span><span class="c1">#True Positives (TP)</span>
<span class="n">ud_FP</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="o">&amp;</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="o">==</span><span class="s">&quot;non-psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span><span class="c1">#False Positives (FP)</span>
<span class="n">ud_TN</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="o">==</span><span class="s">&quot;non-psi&quot;</span><span class="o">&amp;</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="o">==</span><span class="s">&quot;non-psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span><span class="c1">#True Negatives (TN)</span>
<span class="n">ud_FN</span> <span class="o">&lt;-</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Predicted</span><span class="o">==</span><span class="s">&quot;non-psi&quot;</span><span class="o">&amp;</span><span class="n">confusion_matrix</span><span class="o">$</span><span class="n">Actual</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">Freq</span><span class="c1">#False Negatives (FN)</span>
<span class="n">ud_TPR</span> <span class="o">&lt;-</span> <span class="n">ud_TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">ud_TP</span> <span class="o">+</span> <span class="n">ud_FN</span><span class="p">)</span><span class="c1">#sensitivity (true positive rate, TPR)</span>
<span class="n">ud_TNR</span> <span class="o">&lt;-</span> <span class="n">ud_TN</span> <span class="o">/</span> <span class="p">(</span><span class="n">ud_TN</span> <span class="o">+</span> <span class="n">ud_FP</span><span class="p">)</span><span class="c1">#specifity (selectivity or true negative rate, TNR)</span>
<span class="n">ud_FPR</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">-</span><span class="n">ud_TNR</span><span class="c1">#False Positive Rate (FPR) (1 - specificit = FP/​N = FP/(TN + FP), FPR)</span>
<span class="n">ud_FNR</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">-</span><span class="n">ud_TPR</span><span class="c1">#False Negative Rate, FNR)</span>
<span class="n">ud_Prec</span> <span class="o">&lt;-</span> <span class="n">ud_TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">ud_TP</span> <span class="o">+</span> <span class="n">ud_FP</span><span class="p">)</span><span class="c1">#Precision</span>
<span class="n">ud_Recall</span> <span class="o">&lt;-</span> <span class="n">ud_TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">ud_TP</span> <span class="o">+</span> <span class="n">ud_FN</span><span class="p">)</span><span class="c1">#Recall</span>
<span class="n">ud_ACC</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">ud_TP</span> <span class="o">+</span> <span class="n">ud_TN</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ud_TP</span> <span class="o">+</span> <span class="n">ud_TN</span> <span class="o">+</span> <span class="n">ud_FP</span> <span class="o">+</span> <span class="n">ud_FN</span><span class="p">)</span><span class="c1">#accuracy</span>
<span class="n">ud_F1_score</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">ud_Recall</span><span class="o">*</span><span class="n">ud_Prec</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ud_Recall</span> <span class="o">+</span> <span class="n">ud_Prec</span><span class="p">)</span><span class="c1">#F1_score</span>
<span class="n">eval</span><span class="o">&lt;-</span><span class="nf">cbind</span><span class="p">(</span><span class="n">ud_TP</span><span class="p">,</span><span class="n">ud_FP</span><span class="p">,</span><span class="n">ud_TN</span><span class="p">,</span><span class="n">ud_FN</span><span class="p">,</span><span class="n">ud_TPR</span><span class="p">,</span><span class="n">ud_TNR</span><span class="p">,</span><span class="n">ud_FPR</span><span class="p">,</span><span class="n">ud_FNR</span><span class="p">,</span><span class="n">ud_Prec</span><span class="p">,</span><span class="n">ud_Recall</span><span class="p">,</span><span class="n">ud_ACC</span><span class="p">,</span><span class="n">ud_F1_score</span><span class="p">)</span>
<span class="n">eval</span><span class="o">&lt;-</span><span class="nf">round</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="n">eval</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">eval</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ud_eval.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="c1">#show ud evaluation as pdf table</span>
<span class="n">ud_eval_t_df</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">eval</span><span class="p">)))</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">ud_eval_t_df</span><span class="p">)</span><span class="o">&lt;-</span><span class="s">&quot;value_or_percentage&quot;</span>
<span class="n">tt3</span> <span class="o">&lt;-</span> <span class="nf">ttheme_minimal</span><span class="p">(</span>
  <span class="n">core</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">bg_params</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">blues9</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="kc">NA</span><span class="p">),</span>
            <span class="n">fg_params</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">fontface</span><span class="o">=</span><span class="m">3</span><span class="p">)),</span>
  <span class="n">colhead</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">fg_params</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;navyblue&quot;</span><span class="p">,</span> <span class="n">fontface</span><span class="o">=</span><span class="m">4L</span><span class="p">)),</span>
  <span class="n">rowhead</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">fg_params</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="n">fontface</span><span class="o">=</span><span class="m">3L</span><span class="p">)))</span>

<span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_user_defined_evaluation.pdf&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">7</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">7</span><span class="p">)</span> <span class="c1"># Open a new pdf file</span>
<span class="nf">grid.arrange</span><span class="p">(</span>
  <span class="nf">tableGrob</span><span class="p">(</span><span class="n">ud_eval_t_df</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="n">tt3</span><span class="p">),</span>
  <span class="n">nrow</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">dev.off</span><span class="p">())</span> <span class="c1"># Close the file</span>

<span class="c1">#filt by best F1 score threshold</span>
<span class="n">to_filt</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">filtfile</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">to_filt</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span>
  <span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="c1">#1</span>
  <span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="c1">#2</span>
  <span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="c1">#3</span>
  <span class="s">&quot;name&quot;</span><span class="p">,</span><span class="c1">#4</span>
  <span class="s">&quot;foldChange&quot;</span><span class="p">,</span><span class="c1">#5</span>
  <span class="s">&quot;strand&quot;</span><span class="p">,</span><span class="c1">#6</span>
  <span class="s">&quot;geneName&quot;</span><span class="p">,</span><span class="c1">#7</span>
  <span class="s">&quot;geneStart&quot;</span><span class="p">,</span><span class="c1">#8</span>
  <span class="s">&quot;geneEnd&quot;</span><span class="p">,</span><span class="c1">#9</span>
  <span class="s">&quot;base&quot;</span><span class="p">,</span><span class="c1">#10</span>
  <span class="s">&quot;treatPval&quot;</span><span class="p">,</span><span class="c1">#11</span>
  <span class="s">&quot;ctrlPval&quot;</span><span class="p">,</span><span class="c1">#12</span>
  <span class="s">&quot;minusPval&quot;</span><span class="p">,</span><span class="c1">#13</span>
  <span class="s">&quot;treatStopNum&quot;</span><span class="p">,</span><span class="c1">#14</span>
  <span class="s">&quot;treatStopRPM&quot;</span><span class="p">,</span><span class="c1">#15</span>
  <span class="s">&quot;treatPreStopNum&quot;</span><span class="p">,</span><span class="c1">#16</span>
  <span class="s">&quot;treatAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#17</span>
  <span class="s">&quot;treatReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#18</span>
  <span class="s">&quot;ctrlStopNum&quot;</span><span class="p">,</span><span class="c1">#19</span>
  <span class="s">&quot;ctrlStopRPM&quot;</span><span class="p">,</span><span class="c1">#20</span>
  <span class="s">&quot;ctrlPreStopNum&quot;</span><span class="p">,</span><span class="c1">#21</span>
  <span class="s">&quot;ctrlAfterStopNum&quot;</span><span class="p">,</span><span class="c1">#22</span>
  <span class="s">&quot;ctrlReadthroughNum&quot;</span><span class="p">,</span><span class="c1">#23</span>
  <span class="s">&quot;stopRpmFC&quot;</span><span class="p">,</span><span class="c1">#24</span>
  <span class="s">&quot;treatPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#25</span>
  <span class="s">&quot;ctrlPreRpmFold&quot;</span><span class="p">,</span><span class="c1">#26</span>
  <span class="s">&quot;preRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#27</span>
  <span class="s">&quot;treatAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#28</span>
  <span class="s">&quot;ctrlAfterRpmFold&quot;</span><span class="p">,</span><span class="c1">#29</span>
  <span class="s">&quot;afterRpmFoldRatio&quot;</span><span class="p">,</span><span class="c1">#30</span>
  <span class="s">&quot;treatStopRatio&quot;</span><span class="p">,</span><span class="c1">#31</span>
  <span class="s">&quot;ctrlStopRatio&quot;</span><span class="p">,</span><span class="c1">#32</span>
  <span class="s">&quot;stopRatioFC&quot;</span><span class="p">,</span><span class="c1">#33</span>
  <span class="s">&quot;treatStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#34</span>
  <span class="s">&quot;treatStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#35</span>
  <span class="s">&quot;ctrlStopMeanNum&quot;</span><span class="p">,</span><span class="c1">#36</span>
  <span class="s">&quot;ctrlStopMeanFold&quot;</span><span class="p">,</span><span class="c1">#37</span>
  <span class="s">&quot;treatStopMeanFoldRatio&quot;</span><span class="p">,</span><span class="c1">#38</span>
  <span class="s">&quot;extendSeq&quot;</span><span class="p">,</span><span class="c1">#39</span>
  <span class="s">&quot;pred_class&quot;</span><span class="p">)</span><span class="c1">#40</span>
<span class="n">to_filt</span><span class="o">$</span><span class="n">base</span><span class="o">&lt;-</span><span class="s">&quot;T&quot;</span>
<span class="n">to_filt</span><span class="o">$</span><span class="n">pred_class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">to_filt</span><span class="o">$</span><span class="n">pred_class</span><span class="p">),</span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="s">&quot;non-psi&quot;</span><span class="p">)</span>
<span class="n">to_filt</span><span class="o">$</span><span class="n">pred_class</span><span class="o">&lt;-</span><span class="nf">str_replace</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">to_filt</span><span class="o">$</span><span class="n">pred_class</span><span class="p">),</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;psi&quot;</span><span class="p">)</span>

<span class="nf">table</span><span class="p">(</span><span class="n">to_filt</span><span class="o">$</span><span class="n">pred_class</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">to_filt</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_user_defined_total_prediction.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="n">final_pred</span><span class="o">&lt;-</span><span class="n">to_filt</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">pred_class</span><span class="o">==</span><span class="s">&quot;psi&quot;</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ud_psi_prediction.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">write.table</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span> <span class="s">&#39;_ud_psi_prediction.bed&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">col.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="c1">#read hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed evidence</span>
<span class="n">evidence</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="n">rRNAfile</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;chrom&quot;</span><span class="p">,</span><span class="s">&quot;chromStart&quot;</span><span class="p">,</span><span class="s">&quot;chromEnd&quot;</span><span class="p">,</span><span class="s">&quot;rRNA_anno&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">,</span><span class="s">&quot;strand&quot;</span><span class="p">)</span>
<span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">evidence</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">ROC_data</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">ROC_data</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">ROC_data_evidence</span><span class="o">&lt;-</span><span class="n">ROC_data</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">ROC_data_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">ROC_data_no_evidence</span><span class="o">&lt;-</span><span class="n">evidence</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">ROC_data</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">class</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">ROC_data_no_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">ROC_data_evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;rtsSeeker recover (hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>

<span class="c1">#final_pred miss/hit</span>
<span class="n">final_pred</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chrom</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chromStart</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">chromEnd</span><span class="p">,</span><span class="n">final_pred</span><span class="o">$</span><span class="n">strand</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
<span class="n">final_pred_evidence</span><span class="o">&lt;-</span><span class="n">final_pred</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">evidence</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rRNA_anno</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_ud_thres_hit.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">final_pred_no_evidence</span><span class="o">&lt;-</span><span class="n">evidence</span> <span class="o">%&gt;%</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">final_pred</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="o">=</span><span class="s">&quot;rRNA_uniq_id&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">final_pred_no_evidence</span><span class="p">,</span><span class="nf">paste</span><span class="p">(</span><span class="n">outFile_prefix</span><span class="p">,</span><span class="s">&quot;_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_ud_thres_miss.csv&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="n">recovery</span><span class="o">&lt;-</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">final_pred_evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">evidence</span><span class="o">$</span><span class="n">rRNA_uniq_id</span><span class="p">))</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;rtsSeeker+ud recover (hg38_human_chr21_rRNA_known_pseudoU_SingleSites.bed)&quot;</span><span class="p">,</span><span class="n">recovery</span><span class="p">,</span><span class="s">&quot;rRNA psi sites in all known chrom21\n&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Schematic overview of the six key metrics:</p>
<img alt="../_images/principle.png" src="../_images/principle.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All user input will be recorded in a plain text file with suffixes <code class="docutils literal notranslate"><span class="pre">_user_defined_predict.txt</span></code> in psiFinder/config and help users to easily reload the previous config (by simply clicking <code class="docutils literal notranslate"><span class="pre">CONFIG</span></code> button).</p>
</div>
</section>
</section>
<section id="output">
<h2><a class="toc-backref" href="#id16">Output</a><a class="headerlink" href="#output" title="Permalink to this heading">¶</a></h2>
<section id="rtsseeker-result">
<h3><a class="toc-backref" href="#id17">rtsSeeker result</a><a class="headerlink" href="#rtsseeker-result" title="Permalink to this heading">¶</a></h3>
<p>rtsSeeker result will be well-organized as a bed file with 36 <code class="docutils literal notranslate"><span class="pre">(-M</span> <span class="pre">0)</span></code> or 39 <code class="docutils literal notranslate"><span class="pre">(-M</span> <span class="pre">1)</span></code> column.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#run with -M 0, rtsSeeker will output below file information</span>
<span class="c1">##column description</span>
<span class="c1"># 1 #chrom  chr3</span>
<span class="c1"># 2 chromStart      132621249</span>
<span class="c1"># 3 chromEnd        132621250</span>
<span class="c1"># 4 name    rtsSeeker-1</span>
<span class="c1"># 5 foldChange      1</span>
<span class="c1"># 6 strand  +</span>
<span class="c1"># 7 base    G</span>
<span class="c1"># 8 treatPval       -5.01125</span>
<span class="c1"># 9 ctrlPval        -3.06332</span>
<span class="c1"># 10        minusPval       -1.94793</span>
<span class="c1"># 11        treatStopNum    22</span>
<span class="c1"># 12        treatStopRPM    2.62337</span>
<span class="c1"># 13        treatPreStopNum 1</span>
<span class="c1"># 14        treatAfterStopNum       21</span>
<span class="c1"># 15        treatReadthroughNum     22</span>
<span class="c1"># 16        ctrlStopNum     14.33333</span>
<span class="c1"># 17        ctrlStopRPM     2.21748</span>
<span class="c1"># 18        ctrlPreStopNum  1</span>
<span class="c1"># 19        ctrlAfterStopNum        13.6</span>
<span class="c1"># 20        ctrlReadthroughNum      14.33333</span>
<span class="c1"># 21        stopRpmFC       1.18304</span>
<span class="c1"># 22        treatPreRpmFold 22</span>
<span class="c1"># 23        ctrlPreRpmFold  14.33333</span>
<span class="c1"># 24        preRpmFoldRatio 1.53488</span>
<span class="c1"># 25        treatAfterRpmFold       1.04762</span>
<span class="c1"># 26        ctrlAfterRpmFold        1.05392</span>
<span class="c1"># 27        afterRpmFoldRatio       0.99402</span>
<span class="c1"># 28        treatStopRatio  1</span>
<span class="c1"># 29        ctrlStopRatio   1</span>
<span class="c1"># 30        stopRatioFC     1</span>
<span class="c1"># 31        treatStopMeanNum        14</span>
<span class="c1"># 32        treatStopMeanFold       1.57143</span>
<span class="c1"># 33        ctrlStopMeanNum 8.97778</span>
<span class="c1"># 34        ctrlStopMeanFold        1.59653</span>
<span class="c1"># 35        treatStopMeanFoldRatio  0.98427</span>
<span class="c1"># 36        extendSeq       TCTTAGAAAGAGGAGYTTGCCTCCTTAGCGC</span>

<span class="c1">#run with -M 1 --gene $(dirname &quot;$0&quot;)/hg38.gencode.v30.tRNA.refseqNcRNA.geneAnno.bed12, rtsSeeker will output below file information</span>
<span class="c1">##column description</span>
<span class="c1"># 1 #chrom  chr14</span>
<span class="c1"># 2 chromStart      49586636</span>
<span class="c1"># 3 chromEnd        49586637</span>
<span class="c1"># 4 name    rtsSeeker-1</span>
<span class="c1"># 5 foldChange      0.04179</span>
<span class="c1"># 6 strand  +</span>
<span class="c1"># 7 geneName        ENST00000618786.1|RN7SL1-201|ENSG00000276168.1|RN7SL1|misc_RNA</span>
<span class="c1"># 8 geneStart       57</span>
<span class="c1"># 9 geneEnd 58</span>
<span class="c1"># 10        base    G</span>
<span class="c1"># 11        treatPval       0</span>
<span class="c1"># 12        ctrlPval        -2.67E-09</span>
<span class="c1"># 13        minusPval       2.67E-09</span>
<span class="c1"># 14        treatStopNum    2.91439</span>
<span class="c1"># 15        treatStopRPM    0.07151</span>
<span class="c1"># 16        treatPreStopNum 8.32692</span>
<span class="c1"># 17        treatAfterStopNum       6.92437</span>
<span class="c1"># 18        treatReadthroughNum     10574.08742</span>
<span class="c1"># 19        ctrlStopNum     20.62316</span>
<span class="c1"># 20        ctrlStopRPM     0.52566</span>
<span class="c1"># 21        ctrlPreStopNum  17.01255</span>
<span class="c1"># 22        ctrlAfterStopNum        36.85115</span>
<span class="c1"># 23        ctrlReadthroughNum      3126.84178</span>
<span class="c1"># 24        stopRpmFC       0.13604</span>
<span class="c1"># 25        treatPreRpmFold 0.35</span>
<span class="c1"># 26        ctrlPreRpmFold  1.21223</span>
<span class="c1"># 27        preRpmFoldRatio 0.28872</span>
<span class="c1"># 28        treatAfterRpmFold       0.42089</span>
<span class="c1"># 29        ctrlAfterRpmFold        0.55963</span>
<span class="c1"># 30        afterRpmFoldRatio       0.75208</span>
<span class="c1"># 31        treatStopRatio  0.00028</span>
<span class="c1"># 32        ctrlStopRatio   0.0066</span>
<span class="c1"># 33        stopRatioFC     0.04179</span>
<span class="c1"># 34        treatStopMeanNum        186.30904</span>
<span class="c1"># 35        treatStopMeanFold       0.01564</span>
<span class="c1"># 36        ctrlStopMeanNum 117.26259</span>
<span class="c1"># 37        ctrlStopMeanFold        0.17587</span>
<span class="c1"># 38        treatStopMeanFoldRatio  0.08894</span>
<span class="c1"># 39        extendSeq       AGGCTGAGGCTGGAGYATCGCTTGAGTCCAG</span>
</pre></div>
</div>
</section>
<section id="roc-evaluation">
<h3><a class="toc-backref" href="#id18">ROC evaluation</a><a class="headerlink" href="#roc-evaluation" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">plot</span> <span class="pre">ROC</span></code> function return information and plot for ROC evaluation. File with <code class="docutils literal notranslate"><span class="pre">_roc_psi_prediction.bed</span></code> suffix is the filter result by the best ROC threshold (with best F1 score). Running Information will be recorded in a log file, e.g. <code class="docutils literal notranslate"><span class="pre">A1_A2_roc_bestthres.log</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /the/directory/of/out_file_dir
$ tree -L <span class="m">1</span>
.
├── A1_A2_aft_plot.pdf
├── A1_A2_aft_plot.png
├── A1_A2.bed
├── A1_A2_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_hit.csv
├── A1_A2_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_miss.csv
├── A1_A2_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_roc_stopRatioFC_thres_hit.csv
├── A1_A2_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_roc_stopRatioFC_thres_miss.csv
├── A1_A2_hg38.psiU.SingleSites.bed_rtsSeeker_hit.csv
├── A1_A2_hg38.psiU.SingleSites.bed_rtsSeeker_miss.csv
├── A1_A2_knowpse.bed
├── A1_A2_knowpse.txt
├── A1_A2_notpse.bed
├── A1_A2_notpse.txt
├── A1_A2_pre_plot.pdf
├── A1_A2_pre_plot.png
├── A1_A2_ratio_plot.pdf
├── A1_A2_ratio_plot.png
├── A1_A2_roc_afterRpmFoldRatio.pdf
├── A1_A2_roc_all.bed
├── A1_A2_roc_best_evaluation.pdf
├── A1_A2_roc_bestthres_colname.txt
├── A1_A2_roc_bestthres.log
├── A1_A2_roc_bestthres.txt
├── A1_A2_roc_confusion_matrix_and_indicators_arrange.txt
├── A1_A2_roc_confusion_matrix_and_indicators.txt
├── A1_A2_roc_filt.bed
├── A1_A2_roc_plot.txt
├── A1_A2_roc_preRpmFoldRatio.pdf
├── A1_A2_roc_psi_prediction.bed
├── A1_A2_roc_psi_prediction.txt
├── A1_A2_roc_stopRatioFC.pdf
├── A1_A2_roc_summary.pdf
├── A1_A2_roc_total_prediction.txt
├── A1_A2_roc_treatAfterRpmFold.pdf
├── A1_A2_roc_treatPreRpmFold.pdf
├── A1_A2_roc_treatStopMeanFold.pdf
├── A1_A2_roc_treatStopMeanFoldRatio.pdf
├── A1_A2_roc_treatStopRatio.pdf
├── A1_A2_rrna.bed
├── A1_A2_rtsSeeker_cmd.log
├── A1_A2_six_variables_plot.pdf
├── A1_A2_six_variables_rRNA_violinplot.pdf
├── A1_A2_StopMeanFold_plot.pdf
├── A1_A2_StopMeanFold_plot.png
├── A1_A2_stopratio_plot.pdf
└── A1_A2_stopratio_plot.png

<span class="m">0</span> directories, <span class="m">46</span> files
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">A1_A2_roc_bestthres_colname.txt</span></code> record the best ROC thresholds of the six key metrics, users can apply them to <code class="docutils literal notranslate"><span class="pre">User-defined</span></code> QT widget.</p>
</div>
<img alt="../_images/ROC_violinplot.png" src="../_images/ROC_violinplot.png" />
<img alt="../_images/ROC_summary.png" src="../_images/ROC_summary.png" />
<img alt="../_images/ROC_best_threshold.png" src="../_images/ROC_best_threshold.png" />
</section>
<section id="model-building">
<h3><a class="toc-backref" href="#id19">Model Building</a><a class="headerlink" href="#model-building" title="Permalink to this heading">¶</a></h3>
<p>Different identification approaches bring different sensitivity and specificity. For <code class="docutils literal notranslate"><span class="pre">SVM/ANN/ROC/User-defined</span></code>, ROC evaluation running information will be recorded in a log file, e.g. <code class="docutils literal notranslate"><span class="pre">A1_A2_svm_evaluation_totalRNA.log</span></code> and corresponding ROC plot will popup if your input is validated by programs.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">SVM</span></code> QT widget model building result example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /the/directory/of/out_file_dir
$ tree -L <span class="m">1</span>
.
├── A1_A2.bed
├── A1_A2_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_hit.csv
├── A1_A2_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_miss.csv
├── A1_A2_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_svm_hit.csv
├── A1_A2_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_svm_miss.csv
├── A1_A2_hg38.psiU.SingleSites.bed_rtsSeeker_hit.csv
├── A1_A2_hg38.psiU.SingleSites.bed_rtsSeeker_miss.csv
├── A1_A2_knowpse.bed
├── A1_A2_knowpse.txt
├── A1_A2_notpse.bed
├── A1_A2_notpse.txt
├── A1_A2_pca.pdf
├── A1_A2_rrna.bed
├── A1_A2_six_variables_rRNA_violinplot.pdf
├── A1_A2_svm_all.bed
├── A1_A2_svm_all_rtsSeeker.cmd
├── A1_A2_SVM_eval.txt
├── A1_A2_svm_evaluation.pdf
├── A1_A2_svm_evaluation_totalRNA.log
├── A1_A2_svm_filt_totalRNA.bed
├── A1_A2_SVM_model.RData
├── A1_A2_SVM_model.rds
├── A1_A2_SVM_model.scale
├── A1_A2_svm_plot.txt
├── A1_A2_svm_psi_prediction.bed
├── A1_A2_svm_psi_prediction.txt
├── A1_A2_SVM_roc_test_data_plot.pdf
├── A1_A2_SVM_test_data.xlsx
├── A1_A2_svm_total_prediction.bed
├── A1_A2_svm_total_prediction.txt
└── A1_A2_svm_total_prediction.xlsx

<span class="m">0</span> directory, <span class="m">31</span> files
</pre></div>
</div>
<img alt="../_images/SVM_roc.png" src="../_images/SVM_roc.png" />
<img alt="../_images/SVM_evaluation.png" src="../_images/SVM_evaluation.png" />
</section>
<section id="model-prediction">
<h3><a class="toc-backref" href="#id20">Model Prediction</a><a class="headerlink" href="#model-prediction" title="Permalink to this heading">¶</a></h3>
<p>After <code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">Building</span></code>, users can use <code class="docutils literal notranslate"><span class="pre">PREDICT</span></code> in <code class="docutils literal notranslate"><span class="pre">SVM/ANN</span></code> QT widget to predict Ψ-sites by a built <code class="docutils literal notranslate"><span class="pre">SVM/ANN</span> <span class="pre">model</span></code>.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">SVM</span></code> QT widget model prediction result example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /the/directory/of/out_file_dir
$ tree -L <span class="m">1</span>
.
├── A1_A2_svm_filt_totalRNA.bed
├── A1_A2_svm_filt_totalRNA_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_svm_hit.csv
├── A1_A2_svm_filt_totalRNA_hg38_human_chr21_rRNA_known_pseudoU_SingleSites_rtsSeeker_svm_miss.csv
├── A1_A2_svm_filt_totalRNA.log
├── A1_A2_svm_filt_totalRNA_svm_filt.bed
├── A1_A2_svm_filt_totalRNA_svm_psi_prediction.bed
├── A1_A2_svm_filt_totalRNA_svm_psi_prediction.txt
├── A1_A2_svm_filt_totalRNA_svm_total_prediction.bed
├── A1_A2_svm_filt_totalRNA_svm_total_prediction.txt
└── A1_A2_svm_filt_totalRNA_svm_total_prediction.xlsx

<span class="m">0</span> directory, <span class="m">10</span> files
</pre></div>
</div>
</section>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="Transcripts%20Alignment.html">Transcripts Alignment</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="%CE%A8-sites%20Annotation.html">Ψ-sites Annotation</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, chenzhr23.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
    </div>
  </body>
</html>